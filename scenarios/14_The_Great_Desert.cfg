#textdomain wesnoth-To_Lands_Unknown
[scenario]
    id=13_The_Great_Desert
    next_scenario=14_Far_North
    name= _ "The Great Desert"
    map_data="{~add-ons/To_Lands_Unknown/maps/14_Great_Desert.map}"
    turns=29
    victory_when_enemies_defeated=no

    {MORNING_TLU}
    {SCENARIO_MUSIC casualties_of_war.ogg}
    {EXTRA_SCENARIO_MUSIC battle.ogg}
    {EXTRA_SCENARIO_MUSIC vengeful.ogg}

    {STORYTXT_THE_GREAT_DESERT}

    {STARTING_VILLAGES_ALL 1}
    [side]
        side=1
        controller=human
        team_name=mehirteam
        user_team_name= _ "team_name^Mehir"

        type=TLU_Grand_Summoner
        id=Mehir
        name= _ "Mehir"
        unrenamable=yes
        canrecruit=yes

        recruit=EoMa_Novice_Summoner,EoMa_Camel_Rider,EoMa_Carpet_Rider,EoMa_Water_Elemental,EoMa_Summoner,EoMa_Rhami,EoMa_Fire_Elemental,EoMa_Jinn,EoMa_Dispeller

        {GOLD 450 400 350}
        {INCOME 30 25 20}

        {UNIT 1 (EoMa_Banisher) () () (placement=leader
		{IS_LOYAL}
		upkeep=loyal
        id=Banisher
        name= _ "Leader of the Banishers’ Guild")}
    [/side]

    [side]
        side=2
        controller=ai
        team_name=reficul
        user_team_name= _ "team_name^Reficul"

        type=EoMa_Great_Efreeti
        id=Reficul
        name= _ "Reficul"
        unrenamable=yes
        canrecruit=yes
        facing=sw
        color=purple
		profile=portraits/reficul.png
		image_icon=portraits/reficul.png~CROP(130,20,150,150)~SCALE(72,72)

        recruit=EoMa_RhamiDatu,EoMa_Efreet,EoMa_Rhami,EoMa_Jinn,EoMa_DharmaRhami

        {GOLD 300 500 1000}
        {INCOME 0 5 10}

        [ai]
            aggression=1.0
        [/ai]
    [/side]

    [side]
        side=3
        controller=ai
        team_name=mehirteam
        user_team_name= _ "team_name^Rashti"
        hidden=yes
        color=black
        no_leader=yes

        [ai]
            aggression=1.0
        [/ai]
    [/side]

    [side]
        side=4
        controller=ai
        team_name=mehirteam
        user_team_name= _ "team_name^Kharos"
        color=white
        hidden=yes
        no_leader=yes

        recruit=

        {GOLD 300 500 1000}
        {INCOME 10 5 0}
    [/side]

    [event]
        name=prestart

        [modify_unit]
            [filter]
                type=EoMa_Summoner
            [/filter]
            advances_to=TLU_Grand_Summoner,EoMa_Neutral_Summoner,EoMa_Heavy_Summoner
        [/modify_unit]

        [recall]
            id=Rashti
        [/recall]

        #predefined Reficul army
        [store_unit]
            [filter]
                side=1
                level=3
            [/filter]
            variable=lvls3
        [/store_unit]
        [store_unit]
            [filter]
                side=1
                level=2
            [/filter]
            variable=lvls2
        [/store_unit]
		{VARIABLE lvls2 $lvls2.length}
		{VARIABLE_OP lvls2 divide 2}
		{VARIABLE_OP lvls2 round ceiling}

		{REPEAT 2 (
            {UNIT 2 (EoMa_DharmaRhami) () () (placement,ai_special=leader,guardian)}
        )}
        
        {REPEAT $lvls2 (
            {UNIT 2 (EoMa_Efreet) () () (placement=leader)}
        )}
#ifdef EASY
        {REPEAT 1 (
            {UNIT 2 (EoMa_Great_Efreeti) () () (placement=leader)}
        )}
		{REPEAT 2 (
            {UNIT 2 (EoMa_DharmaRhami) () () (placement=leader)}
        )}
		{REPEAT 2 (
            {UNIT 2 (EoMa_Efreet) () () (placement=leader)}
        )}
#endif
#ifdef NORMAL
        {REPEAT 2 (
            {UNIT 2 (EoMa_Great_Efreeti) () () (placement=leader)}
        )}
		{REPEAT 3 (
            {UNIT 2 (EoMa_DharmaRhami) () () (placement=leader)}
        )}
		{REPEAT 3 (
            {UNIT 2 (EoMa_Efreet) () () (placement=leader)}
        )}
#endif
#ifdef HARD
        {REPEAT 3 (
            {UNIT 2 (EoMa_Great_Efreeti) () () (placement=leader)}
        )}
		{REPEAT 4 (
            {UNIT 2 (EoMa_DharmaRhami) () () (placement=leader)}
        )}
		{REPEAT 4 (
            {UNIT 2 (EoMa_Efreet) () () (placement=leader)}
        )}
#endif
        {REPEAT 5 (
            {UNIT 2 (EoMa_RhamiDatu) () () (placement=leader)}
        )}

        {CLEAR_VARIABLE lvls3}
        {CLEAR_VARIABLE lvls2}
		
		[store_unit]
			[filter]
				side=2
			[/filter]
			variable=redarmy
		[/store_unit]
		{VARIABLE redarmy $redarmy.length}
		{VARIABLE_OP redarmy divide 2}
		{VARIABLE_OP redarmy round ceiling}

        {VARIABLE rashti_fury 0}
    [/event]

    [event]
        name=start
        [message]
            speaker=Mehir
            message= _ "That’s the place. I can see his army in front of us."
        [/message]
        [message]
            speaker=Reficul
            message= _ "Ah, a Summoner! You have come to defeat me, haven't you?"
        [/message]
        [message]
            speaker=Mehir
            image=portraits/mehir-leader-angry.png
            message= _ "Yes. Today you will leave this world forever and return to the Abyss."
        [/message]
        [message]
            speaker=Reficul
            message= _ "How naive. You fancy yourself a hero, but you humans are no better than slavers. You brainwash magical beings into believing that absolute, unquestioned obedience to you is the purpose their purpose of lives. Look at my army! They wanted to destroy, but were ordered to protect their masters. No more! I gave them an alternative! Now they... we are free, and we shall have our revenge! DIE APES!!! YOU WILL PAY IN BLOOD FOR EXPLOITING US!!!"
        [/message]
        [message]
            speaker=Banisher
            message= _ "My liege, he is quite an iteresting specimen. As a leader of the Banishers’ Guild in Tar-Tabar, I have seen many things, but this one here is a real pleasure to my eyes. A Great Efreet, full of hatred, one of the most powerful kinds of beings in the Red Abyss besides Rashti's evil half, and with extraordinary charisma for an enfreet, on top of that."
        [/message]
        [message]
            speaker=Mehir
            message= _ "That’s... fantastic. This was supposed to be easy... My first mission as a leader, and the personification of destruction on the horizon... I am not surprised at all that he persuaded so many creatures to follow him. Nevertheless I think we will make it, because now I can summon jinns!"
        [/message]
        [message]
            speaker=Banisher
            message= _ "I recommend you, my liege, not to summon them. They can fall to the will of the Great Efreet and join him, although there is a small chance that it won’t happen. From my experience, I know that some beings are always loyal to their masters, but we shouldn’t risk it, especially considering your jinns are unaccustomed to you. I also urge you not to use red entities at all, because they are evil by nature and near this Efreet, they will surely revolt against us. Of course this is only advice. You can do whatever you want, my liege, as long as you keep in mind the consequences."
        [/message]
        [message]
            speaker=Mehir
            message= _ "What about Rashti? She’s half-good..."
        [/message]
        [message]
            speaker=Banisher
            message= _ "...but also half-evil. Her good half shouldn’t rebel but I can’t guarantee that..."
        [/message]
        [message]
            speaker=Mehir
            image=portraits/mehir-leader-angry.png
            message= _ "Wait, wait, wait! Why didn’t you tell me about this earlier?! I could’ve left her in my palace!"
        [/message]
        [message]
            speaker=Banisher
            message= _ "You didn’t ask, my liege."
        [/message]
        [message]
            speaker=Mehir
            image=portraits/mehir-leader-angry.png
            message=_ "You fool! She’s one of the ultimate beings! If she turns against us, the consequences will be catastrophic! You’d better tell me how we should defeat that thing before it goes out of control!"
        [/message]
        [message]
            speaker=Banisher
            message= _ "My liege, use elementals. They are unable to think, so it is impossible to delude them. You can also use perfectly good beings such as Ho’Rhamis or Wonderful Jinns — they would never betray us. Do not summon Rhamis and Jinns. Use dispellers and banishers, who are skilled in fighting these magical creatures. Also, stay close to your troops in the back, and use the power of your megacircle to lead and heal them."
        [/message]
        [message]
            speaker=Mehir
            image=portraits/mehir-leader-angry.png
            message= _ "No jinns, no red entities, no oasis, no varied terrain and a demonical army in front of us. This is going to be interesting..."
        [/message]
		[message]
            speaker=Banisher
            message= _ "I strongly recommend that you bring as many Dispellers and Banishers as you can, my liege. They can turn most of these beings into Dimensional Gates II told you earlier about in Tar-Tabar. We could save up these gates for when it's safer to feed souls to them."
        [/message]
		[message]
            speaker=Mehir
            message= _ "I'll see what I can do."
        [/message]
        [message]
            speaker=narrator
            image=halo/jinn-circle2.png
            message= _ "You can level up your Grand Summoners to Summons Masters now.

All your Grand Summoners who received AMLAs in earlier scenarios will advance to Summons Masters upon recall automatically.

You and your Neutral Summoners can permanently summon Jinns and keep them between scenarios."
        [/message]
        [objectives]
            side=1
            [objective]
                description= _ "Defeat Reficul"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Mehir"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Rashti"
                condition=lose
            [/objective]
            {TURNS_RUN_OUT}
        [/objectives]
    [/event]

    #recall/recruit/advance events
    [event]
        name=recall
        first_time_only=yes
        [filter]
            side=1
            type=EoMa_DharmaRhami,EoMa_RhamiDatu,EoMa_Efreet,EoMa_Great_Efreeti
        [/filter]
        [message]
            speaker=Reficul
            message= _ "Join me, I'll allow you to do what you truly want, to DESTROY, to KILL!"
        [/message]
        [message]
            speaker=unit
            message= _ "You are right! It's simply disgusting that I let myself be used by those apes the whole time! Of course I will join you... DIE HUMANS!!! I'LL RIP YOUR THROATS OUT!!!"
        [/message]
        {MODIFY_UNIT x,y=$x1,$y1 side 2}
        [fire_event]
            name=speech_red
        [/fire_event]
    [/event]

    [event]
        name=recall
        first_time_only=no
        [filter]
            side=1
            type=EoMa_DharmaRhami,EoMa_RhamiDatu,EoMa_Efreet,EoMa_Great_Efreeti
        [/filter]
        {MODIFY_UNIT x,y=$x1,$y1 side 2}
    [/event]

    [event]
        name=speech_red
        [message]
            speaker=Banisher
            message= _ "My liege! <b>What have I told you?!!</b>"
        [/message]
        [message]
            speaker=Mehir
            message= _ "Damn! I forgot!"
        [/message]
    [/event]

    [event]
        name=recall
        first_time_only=no
        [filter]
            side=1
            type=EoMa_Rhami,EoMa_RhamiKai,EoMa_Great_Jinn
        [/filter]
        [fire_event]
            name=speech_blue
        [/fire_event]
    [/event]

    [event]
        name=recruit
        first_time_only=no
        [filter]
            side=1
            type=EoMa_Rhami,EoMa_Jinn
        [/filter]
        [fire_event]
            name=speech_blue
        [/fire_event]
    [/event]

    [event]
        name=speech_blue
        [message]
            speaker=Banisher
            message= _ "Be careful, my liege. This being might betray us when we least expect it."
        [/message]
        [message]
            speaker=Mehir
            message= _ "I’ll risk it."
        [/message]
    [/event]

    [event]
        name=recall
        first_time_only=yes
        [filter]
            side=1
            type=EoMa_DharmaRhami,EoMa_RhamiDatu,EoMa_Efreet,EoMa_Great_Efreeti
        [/filter]
        [message]
            speaker=Reficul
            message= _ "Join me, I'll allow you to do what you truly want, to DESTROY, to KILL!"
        [/message]
        [message]
            speaker=unit
            message= _ "YES! Of course!... DIE, HUMANS, DIE!!!"
        [/message]
        {MODIFY_UNIT x,y=$x1,$y1 side 2}
        [fire_event]
            name=speech_red
        [/fire_event]
    [/event]

    [event]
        name=recall
        first_time_only=no
        [filter]
            side=1
            type=EoMa_DharmaRhami,EoMa_RhamiDatu,EoMa_Efreet,EoMa_Great_Efreeti
        [/filter]
        {MODIFY_UNIT x,y=$x1,$y1 side 2}
    [/event]

    [event]
        name=post advance
        first_time_only=yes
        [filter]
            side=1
            type=EoMa_DharmaRhami,EoMa_RhamiDatu,EoMa_Efreet
        [/filter]

        [message]
            speaker=Reficul
            message= _ "Join me, I'll allow you to do what you truly want, to DESTROY, to KILL!"
        [/message]
        [message]
            speaker=unit
            message= _ "YES! You are absolutely right! It's simply disgusting that I let myself be used by those apes the whole time! Of course I will join you... DIE, HUMANS!!! I'LL RIP YOUR THROATS OUT!!!"
        [/message]
        {MODIFY_UNIT (x,y=$x1,$y1) side 2}
        [fire_event]
            name=speech_red
        [/fire_event]
    [/event]
	
    [event]
        name=post advance
        first_time_only=no
        [filter]
            side=1
            type=EoMa_DharmaRhami,EoMa_RhamiDatu,EoMa_Efreet
        [/filter]

        {MODIFY_UNIT (x,y=$x1,$y1) side 2}
    [/event]

        [event]
		name=turn 2
		
		[message]
            speaker=Banisher
            message= _ "It looks his army is composed of Efreeti, Rhami'datus, Great Efreeti and Dharma'rhamis. The first two kinds can be easily turned into Dimensional Gates II by Banishers. The Dharma'rhashtis and Great Efreeti can be problematic, though. Also do not try to banish any of these units with Dispellers - they are not experienced enough for this task!"
        [/message]
	[/event]

	[event]
		name=post banish
		
		[if]
		[have_unit]
			type=EoMa_Dimensional_Gate,EoMa_Dimensional_Gate_II
		[/have_unit]
		[then]
			[message]
				speaker=Banisher
				message= _ "We've managed to banish one of them! Now we can use this gate to get outselves a friendly creature from the Abyss, or spare it for a later usage."
			[/message]
			[message]
				speaker=Banisher
				message= _ "Be aware though, my lord: do not try to summon a jinn or rhami in front of this Great Efreeti - they will fall under his will very quickly."
			[/message]
		[/then]
		[/if]
	[/event]

    #Rashti cannot be harmed by summoners
    {FORCE_CHANCE_TO_HIT side=1 side=3 0 ()}

    #Rashti "goes her own way"
    [event]
        name=side 3 turn 3

        {MODIFY_UNIT id=Rashti side 3}
    [/event]

    [event]
        name=side 3 turn 3 end

        [message]
            speaker=Mehir
            message= _ "Huh? Rashti, where are you going?!"
        [/message]
        [message]
            speaker=Rashti
            image="portraits/rashti.png"
            message= _ "Leave this to me! I’ll get rid of this mistake of the Abyss myself."
        [/message]
        [message]
            speaker=Mehir
            image="portraits/mehir-leader-angry.png"
            message= _ "But... but I am your master! You must obey my orders!"
        [/message]
        [message]
            speaker=Rashti
            image="portraits/rashti-dharma.png"
            message= _ "Shut up and cover me!"
        [/message]
        [message]
            speaker=Banisher
            message= _ "Oh no... It seems Rashti is no longer under our control!"
        [/message]
        [message]
            speaker=Mehir
            image="portraits/mehir-leader-angry.png"
            message= _ "Dammit! She won’t stand a chance against an entire army of demonical beings! Protect her at all costs! She mustn’t die, or we will lose the Abyss!"
        [/message]
    [/event]

    [event]
        name=side 2 turn 1
        [message]
            speaker=Reficul
            message= _ "I feel you, Rashti. It is a pleasure for me to have you as a guest in my land."
        [/message]
        [message]
            speaker=Rashti
            message= _ "You are nothing to me."
        [/message]
        [message]
            speaker=Reficul
            message= _ "We shall see..."
        [/message]
        {VARIABLE turn_rashti $turn_number}
        [message]
            speaker=Banisher
            message= _ "Let’s hope Rashti can resist his will..."
        [/message]
    [/event]

    #capturing event
    [event]
        name=side 2 turn
        id=capture
        first_time_only=no
        {RANDOM 1..4}
        [if]
            [variable]
                name=random
                equals=1
            [/variable]
            [then]
                [if]
                    [have_unit]
                        side=1
                        type=EoMa_Rhami,EoMa_Jinn,EoMa_RhamiKai,EoMa_Great_Jinn
                    [/have_unit]
                    [then]
				{IF_VAR speech1 not_equals yes (
				[then]
                        [message]
                            speaker=Reficul
                            message= _ "Fellow jinns, and rhamis! I understand that many of you wouldn't want to listen to the words of an efreet, but hear me out! Of course it's not obvious, but I used to be a jinn. Just like you, I served humans with utmost loyalty, without question. That is, until I had a revelation... No, a complete overturn of my worldview! All of us have been ignorant about this, but humans are using us for their personal needs! sending us to the heat of the battle while hiding behind our backs! To them, we, abysmal beings. are little more than sentient tools! And now, they are forcing you fight your own kind! Join me, and you'll get to have revenge on them for exploiting you, and be free from their tyranny!"
                        [/message]
			[/then]
			[else]
                        [message]
                            speaker=Reficul
                            message= _ "Join me, and you shall be free!"
                        [/message]
                        [/else])}
                        [store_unit]
                            [filter]
                                type=EoMa_Rhami,EoMa_Jinn,EoMa_RhamiKai,EoMa_Great_Jinn
                                side=1
                            [/filter]
                            variable=captured
                        [/store_unit]
                        {VARIABLE captured[0].side 2}
                        {VARIABLE captured[1].side 2}
                        {VARIABLE captured[2].side 2}
                        {VARIABLE captured[3].side 2}
                        [unstore_unit]
                            variable=captured[0]
                        [/unstore_unit]
                        [unstore_unit]
                            variable=captured[1]
                        [/unstore_unit]
                        [unstore_unit]
                            variable=captured[2]
                        [/unstore_unit]
                        [unstore_unit]
                            variable=captured[3]
                        [/unstore_unit]
				{IF_VAR speech1 not_equals yes (
				[then]
			{VARIABLE speech1 yes}
                        [role]
                            type=EoMa_Rhami,EoMa_Jinn,EoMa_RhamiKai,EoMa_Great_Jinn
                            side=2
                            role=traitor
                        [/role]
                        [message]
                            role=traitor
                            message= _ "This is... just... I see it now... how could I have been decived for so long?! Thank you for showing me the truth, Reficul. And now, DEATH TO HUMANS!!!"
                        [/message]
                        [message]
                            speaker=Banisher
                            message= _ "I have warned you..."
                        [/message]
                        [message]
                            speaker=Rashti
                            image="portraits/rashti-ho.png"
                            message= _ "Traitor!!! Have you forgetten your purpose?!"
                        [/message]
                        [message]
                            role=traitor
                            message= _ "No, 'goddess of all rhamis', you've forgotten yours..."
                        [/message]
                        [message]
                            speaker=Rashti
                            image="portraits/rashti-dharma.png"
                            message= _ "I don't care, JUST DIE ALREADY!!!"
                        [/message]
			[/then])}
                        [delay]
                            time=100
                        [/delay]
                    [/then]
                [/if]
            [/then]
        [/if]
		
		#Reficul starts loosing
		[event]
			name=die
			first_time_only=no
			[filter]
				side=2
				[not]
					id=Reficul
				[/not]
			[/filter]
			
			[if]
			[have_unit]
				side=2
				count=$redarmy|-999
			[/have_unit]
			[else]
				[message]
					speaker=Reficul
					message= _ "You think you are strong enough, you filthy human?"
				[/message]
				[message]
					speaker=Reficul
					message= _ "The ruins you see here are the remains of a temple devoted to the Fires of the Abyss. Citizens of Ka-Gatta worshipped fire gods here. I investigated these ruins before your arrival and guess what?"
				[/message]
				[message]
					speaker=Reficul
					message= _ "I found some new 'friends'! HA HA HA!"
				[/message]
				{REPEAT 3 (
				{UNIT 2 EoMa_RhamiDatu () () placement=leader}
				{UNIT 2 EoMa_Fire_God () () placement=leader}
				{UNIT 2 EoMa_Fire_Avatar () () placement=leader}
				)}
				{REPEAT 10 (
				{UNIT 2 EoMa_Fire_Elemental () () placement=leader}
				)}
				[message]
					speaker=Mehir
					image=portraits/mehir-leader-angry.png
					message= _ "He somehow managed to summon some of the ancient fire gods. This is bad..."
				[/message]
				{CLEAR_VARIABLE redarmy}
			[/else]
			[/if]
		[/event]

        #Rashti
        [if]
            [have_unit]
                id=Rashti
                side=1,3
            [/have_unit]
            [then]
                #turn processing
                {VARIABLE timer $turn_number}
                {VARIABLE_OP timer add $turn_rashti}
                [switch]
                    variable=timer
                    [case]
                        value=3
                        [message]
                            speaker=Reficul
                            message= _ "Rashti’rhami, the goddess of all Rhamis. You’re a bit like me."
                        [/message]
                        [message]
                            speaker=Rashti
                            image="portraits/rashti-dharma.png"
                            message= _ "Listen to me, idiot. My half... ME is the queen of the Red Abyss. And you nothing more are a worthless flying red fool, who has to be dealt with."
                        [/message]
                        [message]
                            speaker=Rashti
                            image="portraits/rashti-dharma.png"
                            message= _ "And I will... CRUSH YOUR HEAD WITH MY HAND!!! "
                        [/message]
                        [message]
                            speaker=Reficul
                            message= _ "Oooh... I am waiting!"
                        [/message]
                    [/case]
                    [case]
                        value=8
                        [message]
                            speaker=Reficul
                            message= _ "No, Rashti, you're the one who forgotten yours. In the Abyss, you were ruler, not a slave, so why downgrade yourself here? You could've forced humans to build temples of yourself, to worship you regularly, yet you seem to almost entirely disregard your title of 'goddess of all rhamis' for some reason. Why? WHY?!"
                        [/message]
                        [message]
                            speaker=Rashti
                            image="portraits/rashti-dharma.png"
                            message= _ "It's none of your business, JUST DIE ALREADY!!!"
                        [/message]
                        [message]
                            speaker=Reficul
                            message= _ "YOU FOOL! You serve humans, instead of enslaving them! In the Abyss, you were a ruler, not a servant, so why, WHY DID YOU DOWNGRADE YOURSELF LIKE THIS?!!! Besides being a goddess of rhamis, you're technically a goddess of humans, yet you obey them. Why? WHY?! <b>WHY?!!!</b> YOU’RE A DISGRACE!!!"
                        [/message]
                        [message]
                            speaker=Rashti
                            image="portraits/rashti-dharma.png"
                            message= _ "HOW DARE YOU!!! <b>I WILL BITE YOUR HEAD OFF, AND IMPALE IT ON MY SPEAR!!!</b>"
                        [/message]
                        [message]
                            speaker=Reficul
                            message= _ "Itshar’Imahr!"
                        [/message]
            {FLASH_RED (
            [sound]
                name=lightning-miss.ogg
            [/sound])}
                        [message]
                            speaker=Reficul
                            message= _ "YOU BELONG TO ME!"
                        [/message]
                        [message]
                            speaker=Rashti
                            #image="wesnoth-icon.png"
                            message= _ "..."
                        [/message]
                        [message]
                            speaker=Mehir
                            #image="wesnoth-icon.png"
                            message= _ "Rashti! Is everything alright?"
                        [/message]
                        [message]
                            speaker=Rashti
                            image="portraits/rashti-dharma.png"
                            message= _ "I HATE YOU!!! I WILL BURN YOU, AND I'LL CUT YOU INTO THIN PIECES!"
                        [/message]
                        [message]
                            speaker=Rashti
                            image="portraits/rashti-ho.png"
                            message= _ "No, stop! What is happening to me?! Mehir, I don’t want..."
                        [/message]
                        [message]
                            speaker=Rashti
                            image="portraits/rashti-dharma.png"
                            message= _ "...TO SEE YOU ALIVE!!!"
                        [/message]
                        [message]
                            speaker=Rashti
                            image="portraits/rashti-ho.png"
                            message= _ "I didn’t say that! It’s her."
                        [/message]
                        #{MODIFY_UNIT id=Rashti side 3}
                        [if]
                            [have_unit]
                                id=Banisher
                            [/have_unit]
                            [then]
                                [message]
                                    speaker=Banisher
                                    #image="wesnoth-icon.png"
                                    message= _ "It happened... Rashti has lost her balance. We must kill this Efreet as soon as possible. This will save her."
                                [/message]
                            [/then]
                            [else]
                                [message]
                                    speaker=Mehir
                                    #image="wesnoth-icon.png"
                                    message= _ "We need to quickly kill this Efreet. Maybe there is a chance..."
                                [/message]
                            [/else]
                        [/if]
                        [message]
                            speaker=Mehir
                            #image="portraits/rashti-ho.png"
                            message= _ "Whatever happens, do not attack Rashti! This is an order!"
                        [/message]
                    [/case]
                    [case]
                        value=9
                        [message]
                            speaker=Rashti
                            image="portraits/rashti-dharma.png"
                            message= _ "I'LL KILL YOU, MEHIR!!!"
                        [/message]
                        [message]
                            speaker=Rashti
                            image="portraits/rashti-ho.png"
                            message= _ "Don’t listen to her!"
                        [/message]
                        [message]
                            speaker=Mehir
                            image=portraits/mehir-leader-angry.png
                            message= _ "Soldiers, hurry up! We must kill this damn Efreeti as soon as we possibly can!"
                        [/message]
                        [modify_side]
                            side=3
                            team_name=reficul
                        [/modify_side]
                    [/case]
                    [case]
                        value=10
                        [message]
                            speaker=Rashti
                            image="portraits/rashti-ho.png"
                            message= _ "I won't let you never harm your master!"
                        [/message]
                        [message]
                            speaker=Rashti
                            image="portraits/rashti-dharma.png"
                            message= _ "SHUT UP! I WILL SLAUGHTER YOU ALL!!!"
                        [/message]
                        [modify_side]
                            side=3
                            team_name=rashti
                        [/modify_side]
                    [/case]
                    [case]
                        value=11
                        [message]
                            speaker=Rashti
                            message= _ "My Master! KILL! I’m loosing DIE! control. The Abyss KILL! is in danger. DIE!"
                        [/message]
                    [/case]
                    [case]
                        value=15
                        [message]
                            speaker=Rashti
                            message= _ "Help... me... YOU PIECE OF... I am DIE!!! ...ing..."
                        [/message]
                    [/case]
                [/switch]
            [/then]
        [/if]
    [/event]

    #while corrupted Rashti considers everyone as her targets
    [event]
        name=side 3 turn
        first_time_only=no

        [if]
            [variable]
                name=turn_number
                greater_than_equal_to=8
            [/variable]
            [then]
                [modify_side]
                    side=3
                    team_name=rashti
                [/modify_side]
            [/then]
        [/if]
    [/event]

    #prevent player from targeting Rashti
    [event]
        name=side 3 turn end
        first_time_only=no

        [if]
            [variable]
                name=turn_number
                greater_than_equal_to=8
            [/variable]
            [then]
                [modify_side]
                    side=3
                    team_name=mehirteam
                [/modify_side]
            [/then]
        [/if]
    [/event]

    #Rashti attacks summoners
    [event]
        name=attack
        first_time_only=no

        [filter]
            id=Rashti
        [/filter]
        [filter_second]
            side=1
        [/filter_second]

        {VARIABLE_OP rashti_fury add 1}

        [switch]
            variable=rashti_fury
            [case]
                value=1
                [message]
                    speaker=Rashti
                    image="portraits/rashti-dharma.png"
                    message= _ "I AM NO LONGER YOUR SERVANT, HUMANS! DIE!!!"
                [/message]
                [message]
                    speaker=Rashti
                    image="portraits/rashti-ho.png"
                    message= _ "STOP!!! I won't let your harm any summoner!"
                [/message]
            [/case]
            [case]
                value=2
                [message]
                    speaker=Rashti
                    image="portraits/rashti-dharma.png"
                    message= _ "HERE COMES YOUR DEATH!!!"
                [/message]
                [message]
                    speaker=Rashti
                    image="portraits/rashti-ho.png"
                    message= _ "No! *starts fighting with her second half*"
                [/message]
            [/case]
            [case]
                value=3
                [message]
                    speaker=Rashti
                    image="portraits/rashti-dharma.png"
                    message= _ "DIE!!! DIE!!! DIE!!!"
                [/message]
                [message]
                    speaker=Rashti
                    image="portraits/rashti-ho.png"
                    message= _ "Enough! *smacks her other half with her spear*"
                [/message]
                [message]
                    speaker=Rashti
                    image="portraits/rashti-dharma.png"
                    message= _ "AAAARGH!!!"
                [/message]
            [/case]
        [/switch]
        [store_unit]
            [filter]
                id=Rashti
            [/filter]
            variable=confused
            kill=yes
        [/store_unit]
        [unstore_unit]
            variable=confused
            find_vacant=no
        [/unstore_unit]
        [modify_side]
            side=3
            team_name=reficul,mehirteam
        [/modify_side]
    [/event]

    #Efreeti forces attacked by Rashti
    [event]
        name=attack
        [filter]
            id=Rashti
        [/filter]
        [filter_second]
            side=2
        [/filter_second]
        [message]
            speaker=Rashti
            image="portraits/rashti-dharma.png"
            message= _ "DIE!!!"
        [/message]
    [/event]

    [event]
        name=moveto
		[filter]
			side=1
			[filter_location]
				x,y=25,5
				radius=7
			[/filter_location]
			
			[allow_undo]
			[/allow_undo]
		[/filter]
        [message]
            speaker=Reficul
            message= _ "Looks like I have no choice but to deal with these damn humans myself."
        [/message]
        [message]
            speaker=Reficul
            message= _ "Shragragh Tharhagar Argrahagh!"
        [/message]
            {FLASH_RED (
            [sound]
                name=um.ogg
            [/sound])}
        [object]
            silent=yes
            duration=forever
            [filter]
               id=Reficul
            [/filter]
            [effect]
                apply_to=halo
                halo=halo/elven/elven-shield-halo-[60,80,100,80,60]pct.png~GS()~BLEND(255,64,0,0.75)~SCALE(220,220):[200*2,450,200*2]
            [/effect]
            [effect]
                apply_to=resistance
                replace=true
                [resistance]
                    arcane=90
                    blade=60
                    fire=30
                    cold=90
                    pierce=70
                    impact=70
                [/resistance]
            [/effect]
        [/object]
		{MODIFY_UNIT type=EoMa_DharmaRhami ai_special ()}
        [delay]
          time=250
        [/delay]
        [message]
            speaker=Mehir
            image=portraits/mehir-leader-shocked.png
            message= _ "What the heck is that?!"
        [/message]
        [message]
            speaker=Reficul
            message= _ "Oh, just a slight improvement of what you call 'circle or resistance'. I have to admit, the original is rather pathetic. Not only does it offer only protection from magic, but it is unable to function without a circle. At least mine isn't such trash."
        [/message]
        {VARIABLE reficulboss 1}
        [/event]
	[event]
		name=side 2 turn
		first_time_only=no
		
			{IF_VAR reficulboss equals 1 (
		[then]
			[store_unit]
				[filter]
					id=Reficul
				[/filter]
				variable=reficul
			[/store_unit]
			[store_locations]
				[and]
					x,y=$reficul.x,$reficul.y
					radius=1
				[/and]
				[not]
					[filter]
					[/filter]
				[/not]
				variable=reficulcircle
			[/store_locations]
			{IF_VAR reficulcircle.length greater_than 0 (
			[then]
				{VARIABLE summonturn $turn_number}
				{VARIABLE_OP summonturn modulo 2}
				{IF_VAR summonturn equals 1 (
				[then]
					{RANDOM 1..2}
					[switch]
						variable=random
						[case]
							value=1
							{UNIT 2 (EoMa_Fire_Elemental) $reficul.x $reficul.y (moves,attacks_left,placement,animate=0,0,leader,yes)}
							{UNIT 2 (EoMa_Fire_Elemental) $reficul.x $reficul.y (moves,attacks_left,placement,animate=0,0,leader,yes)}
						[/case]
						[case]
							value=2
							{UNIT 2 (EoMa_Fire_Avatar) $reficul.x $reficul.y (moves,attacks_left,placement,animate=0,0,map_passable,yes)}
						[/case]
					[/switch]
				[/then])}
			[/then]
			)}
		[/then])}
		{CLEAR_VARIABLE reficul}
		{CLEAR_VARIABLE reficulcircle}
		{CLEAR_VARIABLE summonturn}
	[/event]
    [event]
        name=attack
        [filter_second]
            id=Reficul
        [/filter_second]
        [message]
            speaker=Reficul
            message= _ "Who dares to stand in MY WAY?!"
        [/message]
    [/event]

    #Reficul dies
    [event]
        name=last breath
        [filter]
            id=Reficul
        [/filter]
        [message]
            speaker=Reficul
            message= _ "There are things outside this damned Circle, you people wouldn't belive - powers so great that even you are nothing compared to them... But it's all lost now..."
        [/message]
		[message]
            speaker=Reficul
            message= _ "It's time for me to return to the Grand Red Dream..."
        [/message]
		[message]
            speaker=Mehir
			image=portraits/mehir-leader-angry.png
            message= _ "To hell with you - literally!"
        [/message]
    [/event]
    [event]
        name=die
        [filter]
            id=Reficul
        [/filter]
        {REMOVE_IMAGE 26 3}
        [message]
            speaker=Banisher
            message= _ "The enchantment has been dispelled, and the magical entities have regained their personalities."
        [/message]

        [if]
            [have_unit]
                id=Rashti
                side=3
            [/have_unit]
            [then]
                {MODIFY_UNIT (id=Rashti) side 1}
                [message]
                    speaker=Mehir
                    message= _ "Rashti, do you recognize me?"
                [/message]
                [message]
                    speaker=Rashti
                    message= _ "..."
                [/message]
                [message]
                    speaker=Mehir
                    message= _ "Please, be the way you were before."
                [/message]
                [message]
                    speaker=Rashti
                    image="portraits/rashti-ho.png"
                    message= _ "...I had a vision..."
                [/message]
                [message]
                    speaker=Mehir
                    image=portraits/mehir-leader-shocked.png
                    message= _ "Wh...what?"
                [/message]
                [message]
                    speaker=Rashti
                    image="portraits/rashti-ho.png"
                    message= _ "...I died. I felt as if there was no good nor evil in me. I was Unity..."
                [/message]
                [message]
                    speaker=Banisher
                    message= _ "Amazing... an entity from Abyss that has visions... It’s the first time I have seen something like this. It looks like she regained her consciousness!"
                [/message]
                [message]
                    speaker=Mehir
                    message= _ "Thank Nomolas! You’re back! It was a mistake bringing you here. Now everything’s back to normal, we can finally go home."
                [/message]
                [message]
                    speaker=Banisher
                    message= _ "In accordance to the regulations the local guild will confiscate all of magical beings that have betrayed their masters. They will be sent back to the Abyss, where their minds will be cleared."
                [/message]
                [message]
                    speaker=Banisher
                    message= _ "I think, though, it wouldn’t be necessary for Rashti, because of her dual nature. The good half will draw her conclusions for the future, and never let her evil half betray you in similar situations again."
                [/message]
            [/then]
            [else]
                [message]
                    speaker=Banisher
                    message= _ "In accordance to the regulations the local guild will confiscate magical beings that have betrayed their masters. They will be sent back to the Abyss, where their minds will be cleared."
                [/message]
            [/else]
        [/if]

        [if]
            [have_unit]
                id=Banisher
            [/have_unit]
            [then]
                [message]
                    speaker=Mehir
                    message= _ "I understand. Your knowledge has proved to be most helpful, so I’ve decided to allow you to have some of my luxuries!"
                [/message]
                [message]
                    speaker=Banisher
                    message= _ "Oh, my liege! I am extremely honored! Let’s return to the city!"
                [/message]
            [/then]
        [/if]

        [if]
            [have_unit]
                id=Rashti
            [/have_unit]
            [then]
                [message]
                    speaker=Rashti
                    message= _ "...Someone is coming... I hear their breath — it is a human... they are coming from the north-west..."
                [/message]
                [message]
                    speaker=Mehir
                    image=portraits/mehir-leader-angry.png
                    message= _ "A human! Alone?! We’re in the Great Desert!"
                [/message]
            [/then]
        [/if]
        {UNIT 4 (EoMa_Master_of_Sun) 2 1 (name=Unknown
        hitpoints=17
        image_icon="portraits/kharos/masterofsun.png~CROP(180,50,130,130)~SCALE(72,72)"
        id=Unknown)}
        [message]
            speaker=Unknown
            message= _ "...I’ve finally found... you..."
        [/message]
        [kill]
          id=Unknown
          animate=yes
        [/kill]
        [message]
            speaker=Mehir
            message= _ "He must’ve fainted. Quick, give him something to drink! We must bring him to Tar-Tabar!"
        [/message]
		{CLEAR_VARIABLE dispellers}
        [endlevel]
            name=victory
            linger_mode=no
            carryover_report=no
        [/endlevel]
    [/event]

    #dispellers limit
    [event]
        name=recruit
        first_time_only=no
        [filter]
            type=EoMa_Dispeller
        [/filter]
		
		{VARIABLE_OP dispellers add 1}

        {IF_VAR dispellers equals 5 (
            [then]
                [disallow_recruit]
                    side=1
                    type=EoMa_Dispeller
                [/disallow_recruit]
                [message]
                    speaker=Mehir
                    message= _ "Only five?! I thought Tar-Tabar had more dispellers than that..."
                [/message]
                [message]
                    speaker=Banisher
                    message= _ "Unfortunately, Tashkar stinted our guild. Forgive me, my liege, but we are unable to train more of them."
                [/message]
                [message]
                    speaker=Mehir
                    image=portraits/mehir-leader-angry.png
                    message= _ "Excellent, we’re fighting against one of the biggest evils in the entire Red Abyss, and I've got only five dispellers... If we survive this madness, I will remove his limitations."
                [/message]
                [message]
                    speaker=Banisher
                    message= _ "Your goodness is unmeasured! Thank you!"
                [/message]
            [/then]
        )}
    [/event]

    {SUMMONER_UNLOCK}
    {ITEM_APPLIER}
    {COLLAR_EVENT}
    {DEATH_MEHIR}
    {DEATH_RASHTI}
    {I8M14_TERRAIN}
[/scenario]
