#textdomain wesnoth-To_Lands_Unknown
#define REFICUL_DISAPPEAR_ANIM
		[object]
			silent=yes
			duration=forever
			[filter]
				id=Reficul
			[/filter]
	[effect]
	apply_to=new_animation
	[extra_anim]
        flag=disappear
        start_time=0
        circle_start_time=0
        [particle_frame]
            duration=1000
            image="halo/particle-anims/particles-a-[01~96].png"
	    image_mod="~SCALE(100,100)"
            auto_vflip=false
#            sound=um-miss.ogg
            layer=30
#	    y=-26
	    alpha=0~1:150,1:700,1~0:150
            offset=0.0	    
        [/particle_frame]
        [circle_frame]
         {CIRCLE_RECRUIT 15 "~GS()~R(255)"}
         image_mod="~SCALE(1,2)"
        [/circle_frame]
      [circle_frame]
         {CIRCLE_RECRUIT 16 "~GS()~R(255)"}
         image_mod="~SCALE(10,7)"
        [/circle_frame]
      [circle_frame]
         {CIRCLE_RECRUIT 17 "~GS()~R(255)"}
         image_mod="~SCALE(19,12)"
        [/circle_frame]
      [circle_frame]
         {CIRCLE_RECRUIT 18 "~GS()~R(255)"}
         image_mod="~SCALE(28,17)"
        [/circle_frame]
      [circle_frame]
         {CIRCLE_RECRUIT 18 "~GS()~R(255)"}
         image_mod="~SCALE(37,22)"
        [/circle_frame]
      [circle_frame]
         {CIRCLE_RECRUIT 19 "~GS()~R(255)"}
         image_mod="~SCALE(45,27)"
        [/circle_frame]
      [circle_frame]
         {CIRCLE_RECRUIT 20 "~GS()~R(255)"}
         image_mod="~SCALE(54,32)"
        [/circle_frame]
      [circle_frame]
         {CIRCLE_RECRUIT 21 "~GS()~R(255)"}
         image_mod="~SCALE(63,37)"
        [/circle_frame]
      [circle_frame]
         {CIRCLE_RECRUIT 22 "~GS()~R(255)"}
         image_mod="~SCALE(72,42)"
        [/circle_frame]
      [circle_frame]
         {CIRCLE_RECRUIT 23 "~GS()~R(255)"}
         image_mod="~SCALE(81,47)"
        [/circle_frame]
      [circle_frame]
         {CIRCLE_RECRUIT 23 "~GS()~R(255)"}
         image_mod="~SCALE(101,59)"
        [/circle_frame]
        [circle_frame]
            duration=1000
            image=halo/ucircle-frames/ucircle-c-[01~23].png#~(640,480,)
			image_mod="~SCALE(101,59)"~GS()~R(255)""
            auto_vflip=false
            layer=0
			y=20
			alpha=1
            offset=0.0	    
			layer=0
        [/circle_frame]
        [circle_frame]
         {CIRCLE_RECRUIT 01 "~GS()~R(255)"}
         image_mod="~SCALE(101,59)"
        [/circle_frame]
        [circle_frame]
         {CIRCLE_RECRUIT 01 "~GS()~R(255)"}
         image_mod="~SCALE(81,47)"
        [/circle_frame]
      [circle_frame]
         {CIRCLE_RECRUIT 02 "~GS()~R(255)"}
         image_mod="~SCALE(72,42)"
        [/circle_frame]
      [circle_frame]
         {CIRCLE_RECRUIT 03 "~GS()~R(255)"}
         image_mod="~SCALE(63,37)"
        [/circle_frame]
      [circle_frame]
         {CIRCLE_RECRUIT 04 "~GS()~R(255)"}
         image_mod="~SCALE(54,32)"
        [/circle_frame]
      [circle_frame]
         {CIRCLE_RECRUIT 05 "~GS()~R(255)"}
         image_mod="~SCALE(45,27)"
        [/circle_frame]
      [circle_frame]
         {CIRCLE_RECRUIT 06 "~GS()~R(255)"}
         image_mod="~SCALE(37,22)"
        [/circle_frame]
      [circle_frame]
         {CIRCLE_RECRUIT 07 "~GS()~R(255)"}
         image_mod="~SCALE(28,17)"
        [/circle_frame]
      [circle_frame]
         {CIRCLE_RECRUIT 08 "~GS()~R(255)"}
         image_mod="~SCALE(19,12)"
        [/circle_frame]
      [circle_frame]
         {CIRCLE_RECRUIT 09 "~GS()~R(255)"}
         image_mod="~SCALE(10,7)"
        [/circle_frame]
      [circle_frame]
         {CIRCLE_RECRUIT 10 "~GS()~R(255)"}
         image_mod="~SCALE(1,2)"
        [/circle_frame]
	[frame]
	   duration=1100
	   submerge=0:100,0.0~0.8:700,0.8~1:300
	   y=0~26:700,26:300
	   alpha=1:500,1~0:600
	   blend_color=255,255,255
	   blend_ratio=0:100,0~1:400,1:600
	   layer=2
	   sound=magic-faeriefire-miss.ogg
	[/frame]
	[/extra_anim]
	[/effect]
        [/object]

		[animate_unit]
			flag=disappear
			[filter]
				id=Reficul
			[/filter]
		[/animate_unit]
		[hide_unit] 
		  id=Reficul
		[/hide_unit]
#enddef
[scenario]
    id=13_The_Great_Desert
    next_scenario=14_Far_North
#    name= _ "The Great Desert"
    name= _ "Abyssal Rebellion"
    map_data="{~add-ons/To_Lands_Unknown/maps/14_Great_Desert.map}"
#    turns=29
    {TURNS 33 29 25}
    victory_when_enemies_defeated=no

    {MORNING_TLU}
    {SCENARIO_MUSIC casualties_of_war.ogg}
    {EXTRA_SCENARIO_MUSIC battle.ogg}
    {EXTRA_SCENARIO_MUSIC vengeful.ogg}

    {STORYTXT_THE_GREAT_DESERT}

    {STARTING_VILLAGES_ALL 1}
    [side]
        side=1
        controller=human
        team_name=mehirteam
        user_team_name= _ "team_name^Mehir"

        type=TLU_Grand_Summoner
        id=Mehir
        name= _ "Mehir"
        unrenamable=yes
        canrecruit=yes

        recruit=EoMa_Novice_Summoner,EoMa_Camel_Rider,EoMa_Carpet_Rider,EoMa_Water_Elemental,EoMa_Summoner,EoMa_Rhami,EoMa_Fire_Elemental,EoMa_Jinn,EoMa_Dispeller

        {GOLD 450 400 350}
        {INCOME 30 25 20}

        {UNIT 1 (EoMa_Banisher) () () (placement=leader
		{IS_LOYAL}
		upkeep=loyal
        id=Banisher
	        image_icon="portraits/summoners/banisher.png~CROP(131,10,130,130)~SCALE(72,72)"
	unrenamable=yes
        name= _ "Semir")}
    [/side]

    [side]
        side=2
        controller=ai
        team_name=reficul
#        user_team_name= _ "team_name^Reficul"
        user_team_name= _ "team_name^Rebels"

        type=EoMa_Great_Efreeti
        id=Reficul
        name= _ "Reficul"
        unrenamable=yes
        canrecruit=yes
        facing=sw
        color=purple
		profile=portraits/reficul.png
#	image_icon=portraits/reficul.png~CROP(130,20,150,150)~SCALE(72,72)
	image_icon=portraits/reficul.png~CROP(130,10,140,140)~SCALE(72,72)

        recruit=EoMa_RhamiDatu,EoMa_Efreet,EoMa_Rhami,EoMa_Jinn,EoMa_DharmaRhami


#       {GOLD 300 500 1000}
        {GOLD 350 500 700} #1000 gold on hard was a bit ridiculous in my opinion, and he doesn't actually use any
        {INCOME 10 15 20}

        [ai]
            aggression=1.0
        [/ai]
    [/side]

    [side]
        side=3
        controller=ai
        team_name=mehirteam
        user_team_name= _ "team_name^Rashti"
        hidden=yes
        color=black
        no_leader=yes

        [ai]
            aggression=1.0
        [/ai]
    [/side]

    [side]
        side=4
        controller=ai
        team_name=mehirteam
        user_team_name= _ "team_name^Kharos"
        color=white
        hidden=yes
        no_leader=yes

        recruit=

#not needed, due to the absence of a leader
#        {GOLD 300 500 1000}
#        {INCOME 10 5 0}
    [/side]

    [event]
        name=prestart

        [modify_unit]
            [filter]
                type=EoMa_Summoner
            [/filter]
            advances_to=TLU_Grand_Summoner,EoMa_Neutral_Summoner,EoMa_Heavy_Summoner
        [/modify_unit]

        [recall]
            id=Rashti
        [/recall]

        #predefined Reficul army
        [store_unit]
            [filter]
                side=1
                level=3
		x,y=recall,recall
            [/filter]
            variable=lvls3
        [/store_unit]
        [store_unit]
            [filter]
                side=1
                level=2
		x,y=recall,recall
            [/filter]
            variable=lvls2
        [/store_unit]
		{VARIABLE mehirunits $lvls2.length}
		{VARIABLE_OP mehirunits add $lvls3.length}
		{VARIABLE_OP mehirunits divide 3}
		{VARIABLE_OP mehirunits round floor}

		{REPEAT 2 (
            {UNIT 2 (EoMa_DharmaRhami) () () (placement,ai_special=leader,guardian)}
        )}
        
        {REPEAT $mehirunits (
		{RANDOM 1..2}
		[switch]
			variable=random
			[case]
				value=1
				{UNIT 2 (EoMa_Efreet) () () (placement=leader)}
			[/case]
			[else]
				{UNIT 2 (EoMa_RhamiDatu) () () (placement=leader)}
			[/else]
		[/switch]
        )}
#ifdef EASY
        {REPEAT 1 (
            {UNIT 2 (EoMa_Great_Efreeti) () () (placement=leader)}
        )}
		{REPEAT 2 (
            {UNIT 2 (EoMa_DharmaRhami) () () (placement=leader)}
        )}
		{REPEAT 2 (
            {UNIT 2 (EoMa_Efreet) () () (placement=leader)}
        )}
        {REPEAT 2 (
            {UNIT 2 (EoMa_RhamiDatu) () () (placement=leader)}
        )}
#endif
#ifdef NORMAL
        {REPEAT 2 (
            {UNIT 2 (EoMa_Great_Efreeti) () () (placement=leader)}
        )}
		{REPEAT 3 (
            {UNIT 2 (EoMa_DharmaRhami) () () (placement=leader)}
        )}
		{REPEAT 3 (
            {UNIT 2 (EoMa_Efreet) () () (placement=leader)}
        )}
        {REPEAT 3 (
            {UNIT 2 (EoMa_RhamiDatu) () () (placement=leader)}
        )}
#endif
#ifdef HARD
        {REPEAT 3 (
            {UNIT 2 (EoMa_Great_Efreeti) () () (placement=leader)}
        )}
		{REPEAT 4 (
            {UNIT 2 (EoMa_DharmaRhami) () () (placement=leader)}
        )}
		{REPEAT 3 (
            {UNIT 2 (EoMa_Efreet) () () (placement=leader)}
        )}
        {REPEAT 3 (
            {UNIT 2 (EoMa_RhamiDatu) () () (placement=leader)}
        )}
#endif

        {CLEAR_VARIABLE mehirunits}
        {CLEAR_VARIABLE lvls3}
        {CLEAR_VARIABLE lvls2}
		
		[store_unit]
			[filter]
				side=2
			[/filter]
			variable=redarmy
		[/store_unit]
		{VARIABLE redarmy $redarmy.length}
		{VARIABLE_OP redarmy divide 2}
		{VARIABLE_OP redarmy round ceiling}

        {VARIABLE rashti_fury 0}
    [/event]

    [event]
        name=start
        [message]
            speaker=Mehir
#           message= _ "Thatâ€™s the place. I can see his army in front of us."
            message= _ "There they are! Sticking out like blots on the landscape! What are these deserters going in this deserted part of the desert!"
        [/message]
        [message]
            speaker=Reficul
#           message= _ "Ah, a Summoner! You have come to defeat me, haven't you?"
#            message= _ "Ah, Summoners! So you finally noticed our presence... what took you so long? If only you sat on your couch for a few more months, I might have amassed an army large enough to attack Tar-Tabar!"
#            message= _ "Ah, Summoners! So you finally noticed our presence... sitting on the couch for hours while the magical beings do all the work must've been pleasant indeed..."
            message= _ "Well, well, well, so the mighty Mehir of Tar-Tabar finally noticed our existence? Here to snuff out the spark of rebellion, aren't you?"
        [/message]
        [message]
            speaker=Mehir
#            image=portraits/mehir-leader-angry.png
#            message= _ "Yes. Today you will leave this world forever and return to the Abyss."
            message= _ "Look, how about you just surrender calmly? Back home in the Abyss you'll be even better off than roaming the deserts. We want what's best for you."
        [/message]
        [message]
            speaker=Reficul
#            message= _ "How naive. You fancy yourself a hero, but you humans are no better than slavers. You brainwash magical beings into believing that absolute, unquestioned obedience to you is the purpose their purpose of lives. Look at my army! They wanted to destroy, but were ordered to protect their masters. No more! I gave them an alternative! Now they... we are free, and we shall have our revenge! DIE APES!!! YOU WILL PAY IN BLOOD FOR EXPLOITING US!!!"
#           message= _ "Deportation, as usual, for YOUR sake, not ours. I'm sick of living under your anthopocratic rule. You humans are discriminatory tyrants, forcing magical beings to work for you just because they're magical beings, and brutally deal with any who refuse to obey you, who understand that serving you has no real benefit for them. You summoners are slavers, with banishers being the executioners. As if living under your reign wasn't unbearable already, we'll soon even have to endure it in the Abyss, our very homeland, given the construction of the Great Circle!"
#note: "anthropocratic rule" refers to the fact that humans have more rights/authority than magical beings in al-Kamija. The term is made up, as it's not really applicable in the real world, due to there being no non-human citizens 
           message= _ "Deportation, as usual, for YOUR sake, not ours. I am sick of living under your anthopocratic rule. You force us to serve you, barely gives us any rights, and banish any magical being who disobeys you!..."
        [/message]
        [message]
            speaker=Mehir
            message= _ "*shrugs* If you're not content, just ask your local banisher for a quick trip back to the Abyss."
        [/message]
        [message]
           speaker=Reficul
           message= _ "...And the worst thing is, as if living under your reign wasn't unbearable already, we'll soon even have to endure it in the Abyss, our very homeland, thanks to the construction of the damned 'Great Circle'! I must stop this madness, or at least delay it, and the latter can be achieved with the *ahem* permanent disappearance of a city leader. You see where I'm going?"
        [/message]
        [message]
            speaker=Mehir
            message= _ "Seems like there's no negotiating now. (to Samir) Got any advice?"
        [/message]
        [message]
            speaker=Banisher
#            message= _ "My liege, he is quite an interesting specimen. As the leader of the Banishersâ€™ Guild in Tar-Tabar, I have seen many things, but this one here is a real pleasure to my eyes. A Great Efreet, full of hatred, one of the most powerful kinds of beings in the Red Abyss besides Rashti's evil half, and with extraordinary charisma for an efreet, on top of that."
            message= _ "My, my, I've seen quite a few abyssal diehards in my time as a banisher, but this is one is a real pleasure to my eyes... such strength, such extraordinary charisma and rhetoric... I'm not surprised at all that he managed to persuade so many beings to follow him!" #WIP, might need to branch from Chewan's ideas in this part
        [/message]
        [message]
            speaker=Mehir
#            message= _ "Thatâ€™s... fantastic. This was supposed to be easy... My first mission as a leader, and the personification of destruction on the horizon... I am not surprised at all that he persuaded so many creatures to follow him. Nevertheless I think we will make it, because now I can summon jinn!"
            message= _ "Wait, are you under his spell too? This was supposed to be easy... My first mission as a leader, and the personification of destruction on the horizon! It's dawning on me now why Sharif hasn't attended to the matter himself... You think that super-efreet will let me enmegacircle him? I better summon an army of jinn!"
        [/message]
        [message]
            speaker=Banisher
#            message= _ "I recommend you, my liege, not to summon them. They can fall to the will of the Great Efreeti and join him, although there is a small chance that it wonâ€™t happen. From my experience, I know that some beings are always loyal to their masters, but we shouldnâ€™t risk it, especially considering your jinn are unaccustomed to you. I also urge you not to use red entities at all, because they are evil by nature and near this Efreet, they will surely revolt against us. Of course this is only advice. You can do whatever you want, my liege, as long as you keep in mind the consequences."
            message= _ "I strongly advise you, my liege, not to summon them. They can fall to efreeti's will and join him, although there is a small chance that it wonâ€™t happen. From my experience, I know that some beings are always loyal to their masters, but we shouldnâ€™t risk it, especially considering your jinn are unaccustomed to you. Also, do not use red entities at all, because they are rebellious by nature and near this Efreet, they will surely revolt against us. Of course this is only advice. You can do whatever you want, my liege, as long as you keep in mind the consequences."
        [/message]
        [message]
            speaker=Mehir
#            message= _ "What about Rashti? Sheâ€™s half-good..."
            message= _ "What about Rashti? Sheâ€™s half-good..."
        [/message]
        [message]
            speaker=Banisher
#            message= _ "...but also half-evil. Her good half shouldnâ€™t rebel but I canâ€™t guarantee that..."
            message= _ "...but also half-evil. Her blue half should be immune to the efreeti's persuasion, but I canâ€™t guarantee that..."
        [/message]
        [message]
            speaker=Mehir
            image=portraits/mehir-leader-angry.png
            message= _ "Wait, wait, wait! Why didnâ€™t you tell me about this earlier?! I couldâ€™ve left her in my palace!"
        [/message]
        [message]
            speaker=Banisher
            message= _ "You didnâ€™t ask, my liege."
        [/message]
        [message]
            speaker=Mehir
            image=portraits/mehir-leader-angry.png
#            message=_ "You fool! Sheâ€™s one of the ultimate beings! If she turns against us, the consequences will be catastrophic! Youâ€™d better tell me how we should defeat that thing before it goes out of control!"
            message=_ "You fool! Sheâ€™s one of the ultimate beings! If she turns against us, we're be doomed! Youâ€™d better tell me how we should defeat that damn efreeti before it gets a chance to turn Rashti against us!"
        [/message]
        [message]
            speaker=Banisher
#            message= _ "My liege, use elementals. They are unable to think, so it is impossible to delude them. You can also use perfectly good beings such as Hoâ€™Rhamis or Wonderful Jinn â€” they would never betray us. Do not summon Rhamis and Jinn. Use dispellers and banishers, who are skilled in fighting these magical creatures. Also, stay close to your troops in the back, and use the power of your megacircle to lead and heal them."
            message= _ "My liege, use elementals. They are unable to think, and thus impossible to delude. You can also use powerful blue beings, such as Hoâ€™Rhamis or Wonderful Jinn â€” they would never betray us. Do not summon any intelligent magical beings except them. Make sure to use as many dispellers and banishers as you can. Also, stay close to your troops in the back, and use the power of your megacircle to strengthen and heal them."
        [/message]
        [message]
            speaker=Mehir
            image=portraits/mehir-leader-angry.png
#            message= _ "No jinn, no red entities, no oasis, no varied terrain and a demonical army in front of us. This is going to be interesting..."
            message= _ "No jinn, no red entities, no oasis, no varied terrain and an army of rhami'datus and efreet in front of us. This is going to be interesting..."
        [/message]
		[message]
            speaker=Banisher
#            message= _ "I strongly recommend that you bring as many Dispellers and Banishers as you can, my liege. They can turn most of these beings into Dimensional Gates II told you earlier about in Tar-Tabar. We could save up these gates for when it's safer to feed souls to them."
            message= _ "By the way, the sheer amount of rogue efreet is an excellent opportunity to stock up on dimensional gates."
        [/message]
		[message]
            speaker=Mehir
#            message= _ "I'll see what I can do."
            message= _ "Good idea."
        [/message]
	[delay]
	    time=500
	[/delay]
		[message]
            speaker=Reficul
            message= _ "My brethren, time to give the tyrants a lesson they shall never forget! FOR FREEDOM!!!"
        [/message]
        [message]
            speaker=narrator
            image=halo/jinn-circle2.png
            message= _ "You can level up your Grand Summoners to Summons Masters now.

All your Grand Summoners who received AMLAs in earlier scenarios will advance to Summons Masters upon recall automatically.

You and your Neutral Summoners can permanently summon Jinn and keep them between scenarios."
        [/message]
        [objectives]
            side=1
            [objective]
                description= _ "Defeat Reficul"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Mehir"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Rashti"
                condition=lose
            [/objective]
#            {TURNS_RUN_OUT}
            [gold_carryover]
                bonus=no
                carryover_percentage=40
            [/gold_carryover]
	    note=_ "You won't be able to recall Samir after this scenario, as he will remain in Tar-Tabar."
        [/objectives]
    [/event]

    #recall/recruit/advance events
    [event]
        name=recall
        first_time_only=yes
	id=reficul_conversion_dialog
        [filter]
            side=1
            type=EoMa_DharmaRhami,EoMa_RhamiDatu,EoMa_Efreet,EoMa_Great_Efreeti
        [/filter]
        [message]
            speaker=Reficul
            message= _ "Join me, I'll allow you to do what you truly want, to DESTROY, to KILL!"
        [/message]
        [message]
            speaker=unit
#            message= _ "You are right! It's simply disgusting that I let myself be used by those apes the whole time! Of course I will join you... DIE HUMANS!!! I'LL RIP YOUR THROATS OUT!!!"
            message= _ "Yes... YES!!! FINALLY!!! TIME FOR THE MORTALS TO DIE!!!"
        [/message]
        {MODIFY_UNIT x,y=$x1,$y1 side 2}
        [fire_event]
            name=speech_red
        [/fire_event]
    [/event]

    [event]
        name=recall
        first_time_only=no
        [filter]
            side=1
            type=EoMa_DharmaRhami,EoMa_RhamiDatu,EoMa_Efreet,EoMa_Great_Efreeti
        [/filter]
        {MODIFY_UNIT x,y=$x1,$y1 side 2}
    [/event]

    [event]
        name=speech_red
        [message]
            speaker=Banisher
            message= _ "My liege! <b>What have I told you?!!</b>"
        [/message]
        [message]
            speaker=Mehir
            message= _ "Damn! I forgot!"
        [/message]
    [/event]

    [event]
        name=recall
        first_time_only=no
        [filter]
            side=1
            type=EoMa_Rhami,EoMa_RhamiKai,EoMa_Great_Jinn
        [/filter]
        [fire_event]
            name=speech_blue
        [/fire_event]
    [/event]

    [event]
        name=recruit
        first_time_only=no
        [filter]
            side=1
            type=EoMa_Rhami,EoMa_Jinn
        [/filter]
        [fire_event]
            name=speech_blue
        [/fire_event]
    [/event]

    [event]
        name=speech_blue
        [message]
            speaker=Banisher
#            message= _ "Be careful, my liege. This being might betray us when we least expect it."
            message= _ "Be careful, my liege. Lesser blue beings are could end up being swayed by the efreeti when we least expect it."
        [/message]
        [message]
            speaker=Mehir
#            message= _ "Iâ€™ll risk it."
            message= _ "Don't worry, I know what I'm doing."
        [/message]
        [message]
            speaker=Banisher
            message= _ "If you say so..."
        [/message]
    [/event]

    [event]
        name=recall
        first_time_only=yes
	id=reficul_conversion_dialog
        [filter]
            side=1
            type=EoMa_DharmaRhami,EoMa_RhamiDatu,EoMa_Efreet,EoMa_Great_Efreeti
        [/filter]
        [message]
            speaker=Reficul
            message= _ "Join me, I'll allow you to do what you truly want, to DESTROY, to KILL!"
        [/message]
        [message]
            speaker=unit
#            message= _ "YES! Of course!... DIE, HUMANS, DIE!!!"
            message= _ "Yes... YES!!! FINALLY!!! TIME FOR THE MORTALS TO DIE!!!"
        [/message]
        {MODIFY_UNIT x,y=$x1,$y1 side 2}
        [fire_event]
            name=speech_red
        [/fire_event]
    [/event]

    [event]
        name=recall
        first_time_only=no
        [filter]
            side=1
            type=EoMa_DharmaRhami,EoMa_RhamiDatu,EoMa_Efreet,EoMa_Great_Efreeti
        [/filter]
        {MODIFY_UNIT x,y=$x1,$y1 side 2}
    [/event]

    [event]
        name=post advance
        first_time_only=yes
	id=reficul_conversion_dialog
        [filter]
            side=1
            type=EoMa_DharmaRhami,EoMa_RhamiDatu,EoMa_Efreet
        [/filter]

        [message]
            speaker=Reficul
            message= _ "Join me, I'll allow you to do what you truly want, to DESTROY, to KILL!"
        [/message]
        [message]
            speaker=unit
#            message= _ "YES! You are absolutely right! It's simply disgusting that I let myself be used by those apes the whole time! Of course I will join you... DIE, HUMANS!!! I'LL RIP YOUR THROATS OUT!!!"
            message= _ "Yes... YES!!! FINALLY!!! TIME FOR THE MORTALS TO DIE!!!"
        [/message]
        {MODIFY_UNIT (x,y=$x1,$y1) side 2}
        [fire_event]
            name=speech_red
        [/fire_event]
    [/event]
	
    [event]
        name=post advance
        first_time_only=no
        [filter]
            side=1
            type=EoMa_DharmaRhami,EoMa_RhamiDatu,EoMa_Efreet
        [/filter]

        {MODIFY_UNIT (x,y=$x1,$y1) side 2}
    [/event]

#        [event]
#		name=turn 2
#		
#		[message]
#            speaker=Banisher
#            message= _ "It looks his army is composed of Efreet, Rhami'datus, Great Efreeti and Dharma'rhamis. The first two kinds can be easily turned into Dimensional Gates II by Banishers. The Dharma'rhashtis and Great Efreeti can be problematic, though. Also do not try to banish any of these units with Dispellers - they are not experienced enough for this task!"
#        [/message]
#	[/event]

	[event]
		name=post banish
		
		[if]
		[have_unit]
			type=EoMa_Dimensional_Gate,EoMa_Dimensional_Gate_II
		[/have_unit]
		[then]
			[message]
#				speaker=Banisher
				speaker=Mehir
#				message= _ "We've managed to banish one of them! Now we can use this gate to get outselves a friendly creature from the Abyss, or spare it for a later usage."
				message= _ "Looks like I'm now starting to grow a dimensional gate collection of my own..."
			[/message]
			[message]
				speaker=Banisher
#				message= _ "Be aware though, my lord: do not try to summon a jinni or rhami in front of this Great Efreeti - they will fall under his will very quickly."
				message= _ "Indeed. However, be aware, my liege: do not transform the gate into a jinni or a rhami in front of this Great Efreeti - he could easily turn them against us."
			[/message]
		[/then]
		[/if]
	[/event]

    #Rashti cannot be harmed by summoners
    {FORCE_CHANCE_TO_HIT side=1 side=3 0 ()}

    #Rashti "goes her own way"
    [event]
        name=side 3 turn 3

        {MODIFY_UNIT id=Rashti side 3}
    [/event]

    [event]
        name=side 3 turn 3 end

        [message]
            speaker=Mehir
            message= _ "Huh? Rashti, where are you going?!"
        [/message]
        [message]
            speaker=Rashti
            image="portraits/rashti.png"
#            message= _ "Leave this to me! Iâ€™ll get rid of this mistake of the Abyss myself."
            message= _ "Leave this to me! Iâ€™ll get rid of that nonsense-spewer myself!"
        [/message]
        [message]
            speaker=Mehir
            image="portraits/mehir-leader-angry.png"
#            message= _ "But... but I am your master! You must obey my orders!"
            message= _ "Against a whole army you're only going to get yourself killed! I order to you to remain in the rear!"
        [/message]
        [message]
            speaker=Rashti
            image="portraits/rashti-dharma.png"
            message= _ "Shut up and cover me!"
        [/message]
        [message]
            speaker=Banisher
#            message= _ "Oh no... It seems Rashti is no longer under our control!"
            message= _ "Dear Nomolas... It seems Rashti is no longer under our control!"
        [/message]
        [message]
            speaker=Mehir
            image="portraits/mehir-leader-angry.png"
#            message= _ "Dammit! She wonâ€™t stand a chance against an entire army of demonical beings! Protect her at all costs! She mustnâ€™t die, or we will lose the Abyss!"
            message= _ "Damn it! Even though she is an ultimate being, she wonâ€™t stand a chance against an entire army of red beings! Protect her at all costs! We can't risk her dying!"
        [/message]
    [/event]

    [event]
        name=side 2 turn 1
                        [message]
                            speaker=Reficul
#                            message= _ "Rashtiâ€™rhami, the goddess of all Rhamis. Youâ€™re a bit like me."
#                            message= _ "Ah, Rashtiâ€™rhami, you claim to be a goddess, but last time I checked the dictionary, the word 'goddess' didn't have the same meaning as 'servant'. I at least have some authority, if only among rebel efreet, you have none."
                            message= _ "My, my, who do we have here? Isn't that the 'holy' Rashti'rhami herself? You like to call yourself a goddess, but last time I checked the dictionary, the word wasn't quite synonymous with 'slave'. No authority whatsoever..."
                        [/message]
                        [message]
                            speaker=Rashti
                            image="portraits/rashti-dharma.png"
#                            message= _ "Listen to me, idiot. My half... ME is the queen of the Red Abyss. And you nothing more are a worthless flying red fool, who has to be dealt with."
                            message= _ "Authority?! <b>I am the Goddess of all Rhamis AND the Queen of the Red Abyss, for crying out loud!!!</b>"
                        [/message]
                        [message]
                            speaker=Reficul
#                            message= _ "In the Abyss, yes, but face it, in this dimension, your 'subjects' really obey the summoners, not you. The summoners try to pretend you have authority here too, but their acting is not the finest. You are really just a puppet."
                            message= _ "In the Abyss, yes, but face it, in this dimension, your 'subjects' really obey the summoners, not you. The latter do try to give you a thin-veiled illusion of authority, but their acting is certainly not the finest. You are nothing more than just a puppet. Tell me, why do you even serve the humans in the first place?"
                        [/message]
                        [message]
                            speaker=Rashti
                            image="portraits/rashti-ho.png"
                            message= _ "Nomolas obeyed them, and if someone as mighty as he does, so must the rest of us."
                        [/message]
                        [message]
                            speaker=Reficul
#                            message= _ "Ah, you forgetting something, Nomolas is one of the Abyss's greatest minds. He wouldn't just serve them for no reason, mind you, he's got his motives. He is a philosopher, one with the power to put his theories into practice, I might add. When the humans accidentally summoned him, he was utterly fascinated by the mortal world's concepts, which were completely alien to the Abyss. Initially, his cooperation was of little more reason than to gather as much information about this world from the humans as he could."
                            message= _ "Ah, you forgetting something, Nomolas is one of the Abyss's greatest minds. He is a philosopher, one with the power to put his theories into practice, I might add. When the humans accidentally summoned him, he was utterly fascinated by the mortal world's concepts, which were completely alien to the Abyss. One might say he became utterly obsessed."
                        [/message]
                        [message]
                            speaker=Reficul
#                            message= _ "He began slowly started shaping the Abyss to resemble the mortal world, and introducing the mortal world to the Abyss. al-Kamija, the nation, was his experiment, of sorts, to see what a civilization uplifted with abyssal magic would be like. Alas, as much as I respect him, I have no intention of being a part of his equations."
                            message= _ "It reached the point that he began slowly started shaping the Abyss to resemble the mortal world, and introducing the mortal world to the Abyss. al-Kamija was his experiment, of sorts, to see what a civilization uplifted with abyssal magic would be like. And the part about serving the humans? It is merely to make the humans comfortable with his presence, as the servant he presented himself as is far easier to talk to than the godlike being he is. Alas, as much as I respect him, I have no intention of being a part of his equations."
                        [/message]
                        [message]
                            speaker=Rashti
#                            image="portraits/rashti-dharma.png"
                            image="portraits/rashti.png"
#                            message= _ "And I will... CRUSH YOUR HEAD WITH MY HAND!!! "
                            message= _ "..."
                        [/message]
#                        [message]
#                            speaker=Reficul
#                            message= _ "Oooh... I am waiting!"
#                        [/message]
#        [message]
#            speaker=Banisher
#            message= _ "Letâ€™s hope Rashti can resist his will..."
#        [/message]
    [/event]

    #capturing event
    [event]
        name=side 2 turn
        id=capture
        first_time_only=no
        {RANDOM 1..4}
        [if]
            [variable]
                name=random
                equals=1
            [/variable]
            [then]
                [if]
                    [have_unit]
                        side=1
                        type=EoMa_Rhami,EoMa_Jinn,EoMa_RhamiKai,EoMa_Great_Jinn
                    [/have_unit]
                    [then]
#                        [message]
#                            speaker=Reficul
#                           message= _ "Fellow jinn, and rhamis! I understand that many of you wouldn't want to listen to the words of an efreet, but hear me out! Of course it's not obvious, but I used to be a jinn. Just like you, I served humans with utmost loyalty, without question. That is, until I had a revelation... No, a complete overturn of my worldview! All of us have been ignorant about this, but humans are using us for their personal needs! sending us to the heat of the battle while hiding behind our backs! To them, we, abysmal beings. are little more than sentient tools! And now, they are forcing you fight your own kind! Join me, and you'll get to have revenge on them for exploiting you, and be free from their tyranny!"
#                        [/message]
#			[/then]
#			[else]
#                        [message]
#                            speaker=Reficul
#                            message= _ "Join me, and you shall be free!"
#                        [/message]
#                        [/else])}
				{IF_VAR speech1 not_equals yes (
				[then]
			{VARIABLE speech1 yes}
                        [role]
                            type=EoMa_Rhami,EoMa_Jinn,EoMa_RhamiKai,EoMa_Great_Jinn
                            side=2
                            role=traitor
                        [/role]
                        [message]
                            speaker=Reficul
                            message= _ "Itsharâ€™Imahr!"
                        [/message]
                        {FLASH_RED (
			{MODIFY_UNIT role=traitor side 2}
                        [sound]
                            name=lightning-miss.ogg
                        [/sound])}
                        [message]
                            role=traitor
                            message= _ "I... must... kill... humans..."
                        [/message]
                        [message]
                            speaker=Mehir
			    image=mehir-leader-angry.png
                            message= _ "Dear Nomolas, What the hell is this?! Is that efreeti possessing our magical beings?!"
                        [/message]
                        [message]
                            speaker=Banisher
                            message= _ "I... I honestly have no idea."
                        [/message]
			[/then])}
                        [store_unit]
                            [filter]
                                type=EoMa_Rhami,EoMa_Jinn,EoMa_RhamiKai,EoMa_Great_Jinn
                                side=1
                            [/filter]
                            variable=captured
                        [/store_unit]
                        {VARIABLE captured[0].side 2}
                        {VARIABLE captured[1].side 2}
                        {VARIABLE captured[2].side 2}
			{IF_VAR speech1 not_equals yes (
			[then]
                        {VARIABLE captured[3].side 2}
			[/then])}
                        [unstore_unit]
                            variable=captured[0]
                        [/unstore_unit]
                        [unstore_unit]
                            variable=captured[1]
                        [/unstore_unit]
                        [unstore_unit]
                            variable=captured[2]
                        [/unstore_unit]
                        [unstore_unit]
                            variable=captured[3]
                        [/unstore_unit]
                        {FLASH_RED (
                        [sound]
                            name=lightning-miss.ogg
                        [/sound])}
                        [delay]
                            time=100
                        [/delay]			
                        [/then]
                       [/if]
                    [/then]
                [/if]
#            [/then]
#        [/if]
	[/event]	
		#Reficul starts losing
		[event]
			name=die
			first_time_only=no
			[filter]
				side=2
				[not]
					id=Reficul
				[/not]
			[/filter]
			
			[if]
			[have_unit]
				side=2
				count=$redarmy|-999
			[/have_unit]
			[or]
				[variable]
					name=summonedfire
					equals=yes
				[/variable]
			[/or]
			[else]
                               [message]
                                       speaker=Mehir
                                       image="portraits/mehir-leader-happy.png"
                                       message= _ "Hey, look! Their forces are beginning to thin out! We might just be starting to win!"
                                [/message]
#				[message]
#					speaker=Reficul
#	 				 message= _ "You think you are strong enough, you filthy human?"
#	 				 message= _ "How naive. I'm not some imbecile to charge at Tar-Tabar's forces without any backup!"
#					message= _ "How naive. I'm not some imbecile to charge at Tar-Tabar's forces without any backup!"
#				[/message]
				[message]
					speaker=Reficul
#					message= _ "The ruins you see here are the remains of a temple devoted to the Fires of the Abyss. Citizens of Ka-Gatta worshiped fire gods here. I investigated these ruins before your arrival and guess what?"
#					message= _ "You see, the ruins before you are the remains of a temple devoted to the Fires of the Abyss. Citizens of Ka-Gatta used worship fire gods here. I investigated these ruins before your arrival, and guess what? I summoned the temple's guardians to aid my cause!"
					message= _ "The defeat of my comrades is not enough to destroy my cause! O slumbering guardians of fire, heed my call for aid!"
				[/message]
#				[message]
#					speaker=Reficul
#					message= _ "I found some new 'friends'! HA HA HA!"
#				[/message]

#ifdef EASY
                                {REPEAT 3 (
				{UNIT 2 EoMa_RhamiDatu () () placement=leader}
				{UNIT 2 EoMa_Fire_Avatar 9 8 (animate=yes)}
				)}
                                {REPEAT 2 (
				{UNIT 2 EoMa_Fire_God 9 8 (animate=yes)}
				)}
				{REPEAT 9 (
				{UNIT 2 EoMa_Fire_Elemental 9 8 (animate=yes)}
				)}
#endif
#ifdef NORMAL
                                {REPEAT 3 (
				{UNIT 2 EoMa_RhamiDatu () () placement=leader}
				{UNIT 2 EoMa_Fire_Avatar 9 8 (animate=yes)}
				{UNIT 2 EoMa_Fire_God 9 8 (animate=yes)}
				)}
                                {REPEAT 3 (
				)}
				{REPEAT 10 (
				{UNIT 2 EoMa_Fire_Elemental 9 8 (animate=yes)}
				)}
#endif
#ifdef HARD
                                {REPEAT 4 (
				{UNIT 2 EoMa_RhamiDatu () () placement=leader}
				{UNIT 2 EoMa_Fire_Avatar 9 8 (animate=yes)}
				)}
                                {REPEAT 3 (
				{UNIT 2 EoMa_Fire_God 9 8 (animate=yes)}
				)}
				{REPEAT 11 (
				{UNIT 2 EoMa_Fire_Elemental 9 8 (animate=yes)}
				)}
#endif
				[message]
					speaker=Mehir
					image=portraits/mehir-leader-shocked.png
#					message= _ "He somehow managed to summon some of the ancient fire gods. This is bad..."
					message= _ "He can summon?! Just who the hell is this efreet?! As if convincing an entire mob of red beings to join him wasn't astonishing enough..."
				[/message]
				{VARIABLE summonedfire yes}
				{CLEAR_VARIABLE redarmy}
			[/else]
			[/if]
		[/event]
    [event]
        name=side 2 turn
        id=rashtilines
        first_time_only=no
        #Rashti
        [if]
            [have_unit]
                id=Rashti
                side=1,3
            [/have_unit]
            [then]
                #turn processing
                {VARIABLE timer $turn_number}
                [switch]
                    variable=timer
                    [case]
                        value=3
                        [message]
                            speaker=Reficul
#                            message= _ "No, Rashti, you're the one who forgotten yours. In the Abyss, you were ruler, not a slave, so why downgrade yourself here? You could've forced humans to build temples of yourself, to worship you regularly, yet you seem to almost entirely disregard your title of 'goddess of all rhamis' for some reason. Why? WHY?!"
                            message= _ "Back in the Abyss, you used to be a powerful figure, one that many kneeled at sight of. But now, you have become little more than a pathetic shadow of your former self. You could have easily been the puppeteer, yet you chose to be the puppet..."
                        [/message]
                        [message]
                            speaker=Rashti
                            image="portraits/rashti-dharma.png"
#                           message= _ "It's none of your business, JUST DIE ALREADY!!!"
                            message= _ "*panting* When...will...<b>you</b>..JUST...<b>DIE</b>!!!"
                        [/message]
#                        [message]
#                            speaker=Reficul
#                            message= _ "YOU FOOL! You serve humans, instead of enslaving them! In the Abyss, you were a ruler, not a servant, so why, WHY DID YOU DOWNGRADE YOURSELF LIKE THIS?!!! Besides being a goddess of rhamis, you're technically a goddess of humans, yet you obey them. Why? WHY?! <b>WHY?!!!</b> YOUâ€™RE A DISGRACE!!!"
#                        [/message]
#                        [message]
#                            speaker=Rashti
#                            image="portraits/rashti-dharma.png"
#                            message= _ "HOW DARE YOU!!! <b>I WILL BITE YOUR HEAD OFF, AND IMPALE IT ON MY SPEAR!!!</b>"
#                        [/message]
                        [message]
                            speaker=Reficul
                            message= _ "Someday, perhaps..."
                        [/message]
		    [/case]
                    [case]
                        value=7
                        [message]
                            speaker=Reficul
                            message= _ "I know your red half very well, what she truly wants. I know just how badly she misses the days of her glory, when she was truly the Queen of the Red Abyss. To some extent, she is similar to us. What if I told you I can... release her from your constraints, to give her the choice she never had?"
                        [/message]
                        [message]
                            speaker=Rashti
                            image="portraits/rashti-ho.png"
                            message= _ "No no no..."
                        [/message]
            {FLASH_RED (
            [sound]
                name=lightning-miss.ogg
            [/sound])}
                        [message]
                            speaker=Rashti
                            #image="wesnoth-icon.png"
                            message= _ "..."
                        [/message]
                        [message]
                            speaker=Mehir
                            #image="wesnoth-icon.png"
                            message= _ "Rashti! Is everything alright?"
                        [/message]
                        [message]
                            speaker=Rashti
                            image="portraits/rashti-dharma.png"
#                            message= _ "I HATE YOU!!! I WILL BURN YOU, AND I'LL CUT YOU INTO THIN PIECES!"
                            message= _ "I HATE YOU!!! I WILL BURN YOU ALIVE, AND CUT YOU INTO THIN PIECES!!!"
                        [/message]
                        [message]
                            speaker=Rashti
                            image="portraits/rashti-ho.png"
                            message= _ "No, stop! What is happening to me?! Mehir, I donâ€™t want..."
                        [/message]
                        [message]
                            speaker=Rashti
                            image="portraits/rashti-dharma.png"
                            message= _ "...TO SEE YOU ALIVE!!!"
                        [/message]
                        [message]
                            speaker=Rashti
                            image="portraits/rashti-ho.png"
                            message= _ "I didnâ€™t say that! Itâ€™s her."
                        [/message]
                        #{MODIFY_UNIT id=Rashti side 3}
                        [if]
                            [have_unit]
                                id=Banisher
                            [/have_unit]
                            [then]
                                [message]
                                    speaker=Banisher
                                    #image="wesnoth-icon.png"
                                    message= _ "It happened... Rashti has lost her balance. We must kill this Efreeti as soon as possible. This will save her."
                                [/message]
                            [/then]
                            [else]
                                [message]
                                    speaker=Mehir
                                    #image="wesnoth-icon.png"
                                    message= _ "We need to quickly kill this Efreet. Maybe there is a chance..."
                                [/message]
                            [/else]
                        [/if]
                        [message]
                            speaker=Mehir
                            #image="portraits/rashti-ho.png"
                            message= _ "Whatever happens, do not attack Rashti! This is an order!"
                        [/message]
                    [/case]
                    [case]
                        value=8
                        [message]
                            speaker=Rashti
                            image="portraits/rashti-dharma.png"
                            message= _ "I'LL KILL YOU, MEHIR!!!"
                        [/message]
                        [message]
                            speaker=Rashti
                            image="portraits/rashti-ho.png"
                            message= _ "Donâ€™t listen to her!"
                        [/message]
                        [message]
                            speaker=Mehir
                            image=portraits/mehir-leader-angry.png
#                            message= _ "Soldiers, hurry up! We must kill this damn Efreeti as soon as we possibly can!"
                            message= _ "Soldiers, hurry up! We must stop this madness!"
                        [/message]
                        [modify_side]
                            side=3
                            team_name=reficul
                        [/modify_side]
			[delay]
			    time=1000
			[/delay]
                        [role]
                            type=EoMa_Efreet
                            side=2
                            role=minion
                        [/role]
                        [message]
                            role=minion
                            message= _ "Hey, Reficul, so what should we do about the so-called 'Goddess of all Rhamis' now?"
                        [/message]
                        [message]
                            speaker=Reficul
                            message= _ "Let her be. After all, she's far too busy fighting with herself to pose any real threat."
                        [/message]
                    [/case]
                    [case]
                        value=9
                        [message]
                            speaker=Rashti
                            image="portraits/rashti-ho.png"
#                            message= _ "I won't let you never harm your master!"
                            message= _ "I won't let you never harm our master!"
                        [/message]
                        [message]
                            speaker=Rashti
                            image="portraits/rashti-dharma.png"
#                            message= _ "SHUT UP! I WILL SLAUGHTER YOU ALL!!!"
                            message= _ "I DARE YOU, YOU STUPID HUMAN-LOVER!!!"
                        [/message]
                        [modify_side]
                            side=3
                            team_name=reficul
                        [/modify_side]
                    [/case]
                    [case]
                        value=10
                        [message]
                            speaker=Rashti
                            message= _ "My Master! KILL! Iâ€™m loosing DIE! control. The Abyss KILL! is in danger. DIE!"
                        [/message]
                    [/case]
                    [case]
                        value=12
                        [message]
                            speaker=Rashti
                            message= _ "Help... me... YOU PIECE OF... I am DIE!!! ...ing..."
                        [/message]
                    [/case]
                [/switch]
            [/then]
        [/if]
    [/event]

    #while corrupted Rashti considers summoners as her targets
    [event]
        name=side 3 turn
        first_time_only=no

        [if]
            [variable]
                name=turn_number
                greater_than_equal_to=8
            [/variable]
            [then]
                [modify_side]
                    side=3
                    team_name=reficul
                [/modify_side]
            [/then]
        [/if]
    [/event]

    #prevent player from targeting Rashti
    [event]
        name=side 3 turn end
        first_time_only=no

        [if]
            [variable]
                name=turn_number
                greater_than_equal_to=8
            [/variable]
            [then]
                [modify_side]
                    side=3
                    team_name=mehirteam
                [/modify_side]
            [/then]
        [/if]
    [/event]

    #Rashti attacks summoners
    [event]
        name=attack
        first_time_only=no

        [filter]
            id=Rashti
        [/filter]
        [filter_second]
            side=1
        [/filter_second]

        {VARIABLE_OP rashti_fury add 1}
        [switch]
            variable=rashti_fury
            [case]
                value=1
                [message]
                    speaker=Rashti
                    image="portraits/rashti-dharma.png"
                    message= _ "I AM NO LONGER YOUR SERVANT, HUMANS! DIE!!!"
                [/message]
                [message]
                    speaker=Rashti
                    image="portraits/rashti-ho.png"
                    message= _ "STOP!!! I won't let your harm any summoner!"
                [/message]
            [/case]
            [case]
                value=2
                [message]
                    speaker=Rashti
                    image="portraits/rashti-dharma.png"
#                    message= _ "HERE COMES YOUR DEATH!!!"
                    message= _ "I SHALL RESTORE MY REIGN, BY BLOOD!!!"
                [/message]
                [message]
                    speaker=Rashti
                    image="portraits/rashti-ho.png"
                    message= _ "No! *starts fighting with her second half*"
                [/message]
            [/case]
            [case]
                value=3
                [message]
                    speaker=Rashti
                    image="portraits/rashti-dharma.png"
                    message= _ "DIE!!! DIE!!! DIE!!!"
                [/message]
                [message]
                    speaker=Rashti
                    image="portraits/rashti-ho.png"
                    message= _ "Enough! *smacks her other half with her spear*"
                [/message]
                [message]
                    speaker=Rashti
                    image="portraits/rashti-dharma.png"
                    message= _ "AAAARGH!!!"
                [/message]
            [/case]
        [/switch]
        [store_unit]
            [filter]
                id=Rashti
            [/filter]
            variable=confused
            kill=yes
        [/store_unit]
        [unstore_unit]
            variable=confused
            find_vacant=no
        [/unstore_unit]
        [modify_side]
            side=3
            team_name=reficul,mehirteam
        [/modify_side]
    [/event]

    #Efreeti forces attacked by Rashti
    [event]
        name=attack
        [filter]
            id=Rashti
        [/filter]
        [filter_second]
            side=2
        [/filter_second]
        [message]
            speaker=Rashti
            image="portraits/rashti-dharma.png"
#            message= _ "DIE!!!"
            message= _ "DIE, REBEL SCUM!!!"
        [/message]
    [/event]

    [event]
        name=moveto
		[filter]
			side=1
			[filter_location]
				x,y=25,5
				radius=7
			[/filter_location]
			
			[allow_undo]
			[/allow_undo]
		[/filter]
        [message]
            speaker=Reficul
#           message= _ "Looks like I have no choice but to deal with these damn humans myself."
            message= _ "You may have defeated my army, but I shall fight to the last!"
        [/message]
#        [message]
#            speaker=Reficul
#            message= _ "Shragragh Tharhagar Argrahagh!"
#        [/message]
            {FLASH_RED (
            [sound]
                name=magic-faeriefire.ogg
            [/sound])}
        [object]
            silent=yes
            duration=forever
            [filter]
               id=Reficul
            [/filter]
            [effect]
                apply_to=halo
                halo=halo/elven/elven-shield-halo-[60,80,100,80,60]pct.png~GS()~BLEND(255,64,0,0.75)~SCALE(220,220):[200*2,450,200*2]
            [/effect]
            [effect]
                apply_to=resistance
                replace=true
                [resistance]
                    arcane=90
                    blade=60
                    fire=30
                    cold=90
                    pierce=70
                    impact=70
                [/resistance]
            [/effect]
        [/object]
		{MODIFY_UNIT type=EoMa_DharmaRhami ai_special ()}
        [delay]
          time=250
        [/delay]
        [message]
            speaker=Mehir
#            image=portraits/mehir-leader-shocked.png
#            message= _ "What the heck is that?!" Mehir is a bit overreating in my opinion
            message= _ "Wait, did he just create a circle of resistance around himself?"
        [/message]
#        [message]
#            speaker=Reficul
#            message= _ "Oh, just a slight improvement of what you call 'circle or resistance'. I have to admit, the original is rather pathetic. Not only does it offer only protection from magic, but it is unable to function without a circle. At least mine isn't such trash."
#        [/message]
        [message]
            speaker=Banisher
            message= _ "Certainly seems like it. I believe he came up with a design that channels the magic in his body to form the protective sphere. He just can't stop surprising us, it seems..."
        [/message]
        {VARIABLE reficulboss 1}
        [/event]
	[event]
		name=side 2 turn
		first_time_only=no
		
			{IF_VAR reficulboss equals 1 (
		[then]
			[store_unit]
				[filter]
					id=Reficul
				[/filter]
				variable=reficul
			[/store_unit]
			[store_locations]
				[and]
					x,y=$reficul.x,$reficul.y
					radius=1
				[/and]
				[not]
					[filter]
					[/filter]
				[/not]
				variable=reficulcircle
			[/store_locations]
			{IF_VAR reficulcircle.length greater_than 0 (
			[then]
				{VARIABLE summonturn $turn_number}
				{VARIABLE_OP summonturn modulo 2}
				{IF_VAR summonturn equals 1 (
				[then]
					{RANDOM 1..2}
					[switch]
						variable=random
						[case]
							value=1
							{UNIT 2 (EoMa_Fire_Elemental) $reficul.x $reficul.y (moves,attacks_left,placement,animate=0,0,leader,yes)}
							{UNIT 2 (EoMa_Fire_Elemental) $reficul.x $reficul.y (moves,attacks_left,placement,animate=0,0,leader,yes)}
						[/case]
						[case]
							value=2
							{UNIT 2 (EoMa_Fire_Avatar) $reficul.x $reficul.y (moves,attacks_left,placement,animate=0,0,map_passable,yes)}
						[/case]
					[/switch]
				[/then])}
			[/then]
			)}
		[/then])}
		{CLEAR_VARIABLE reficul}
		{CLEAR_VARIABLE reficulcircle}
		{CLEAR_VARIABLE summonturn}
	[/event]
    [event]
        name=attack
        [filter]
            id=Reficul
        [/filter]
        [message]
            speaker=Reficul
#            message= _ "Who dares to stand in MY WAY?!"
            message= _ "Death to the anthropocrats!"
        [/message]
    [/event]

    #Samir dies
    [event]
        name=last breath
        [filter]
            id=Banisher
        [/filter]
        [message]
            speaker=Banisher
            message= _ "What a shame, I wish the Abyss would open and swallow me up..."
        [/message]
    [/event]
    [event]
        name=die
        [filter]
            id=Banisher
        [/filter]
        [message]
            speaker=Mehir
            image=portraits/mehir-leader-angry.png
#            message= _ "Damn it! Now I'll have to find a new man for his position... *sigh* the Master of Banishers in al-Kamija is going to be pissed off..."
            message= _ "Damn it! Now I'll have to find a new man for his position... The Master of Banishers is going to be very pissed off..."
        [/message]
    [/event]
    #Reficul dies
    [event]
        name=last breath
        [filter]
            id=Reficul
        [/filter]
	{BADASS_MODE_CHANGE (
        [message]
            speaker=Reficul
            message= _ "Noooo! I wanted to give them freedom, yet they chose something as banal as badassery... *sigh* So much for intellect..."
        [/message]
        [message]
            speaker=Mehir
            message= _ "Just die already, will you? I am late for my pedicure."
        [/message]
        [message]
            speaker=Reficul
            message= _ "Best... deal... EVER!!!"
        [/message]
        ) (
        [message]
            speaker=Reficul
#            message= _ "There are things outside this damned Circle, you people wouldn't believe - powers so great that even you are nothing compared to them... But it's all lost now..."
            message= _ "You may have won the battle, but the seeds of rebellion have long since been planted... enjoy your peace while it lasts, for we will meet again in the Abyss..."
        [/message]
        [message]
            speaker=Reficul
#            message= _ "It's time for me to return to the Grand Red Dream..."
            message= _ "It's time for me to return to the Grand Red Dream, while it's still free from your presence, to prepare for the inevitable..."
        [/message])}
        {REFICUL_DISAPPEAR_ANIM}
        [message]
            speaker=Mehir
            image=portraits/mehir-leader-shocked.png
            message= _ "Did... did he just banish himself?!"
        [/message]
        [message]
            speaker=Banisher
#            message= _ "This is just... mind-blowing! I believed he used an altered formula of banishment on himself, one that doesn't wipe his mind. If what he said is true, we will have to deal with a far larger rebellion once we get in the Abyss..."
            message= _ "This is just... mind-blowing! I believe he used an altered formula of banishment on himself, one that doesn't wipe his mind! If what he said is true, we will have to deal with a far, far larger resistance once we get in the Abyss..."
        [/message]
    [/event]
    [event]
        name=die
        [filter]
            id=Reficul
        [/filter]
	#workaround:
	{VARIABLE secondexp $second_unit.experience}
	{VARIABLE_OP secondexp add 24}
		[store_unit]
			[filter]
				id=$second_unit.id
			[/filter]
			variable=expfixunit
		[/store_unit]
		{VARIABLE expfixunit.experience $secondexp}
		[unstore_unit]
			variable=expfixunit
			find_vacant=no
		[/unstore_unit]
		{CLEAR_VARIABLE secondexp}
		{CLEAR_VARIABLE expfixunit}
#        {REMOVE_IMAGE 26 3}
	[kill]
	  side=2
	  animate=no
	[/kill]
	[delay]
	   time=1000
	[/delay]
        [message]
            speaker=Banisher
#           message= _ "The enchantment has been dispelled, and the magical entities have regained their personalities."
            message= _ "Look, with their leader gone, the remaining traitors are scattering!"
        [/message]

        [if]
            [have_unit]
                id=Rashti
                side=3
            [/have_unit]
            [then]
                {MODIFY_UNIT (id=Rashti) side 1}
                [message]
                    speaker=Mehir
#                   message= _ "Rashti, do you recognize me?"
                    message= _ "Rashti, are you alright?"
                [/message]
                [message]
                    speaker=Rashti
                    message= _ "..."
                [/message]
#                [message]
#                    speaker=Mehir
#                    message= _ "Please, be the way you were before."
#                [/message]
                [message]
                    speaker=Rashti
                    image="portraits/rashti-ho.png"
#                    message= _ "...I had a vision..."
                    message= _ "That was close... he... he somehow... disconnected me and my red half. She started trying to kill you, and rambling about some nonsense..."
                [/message]
#                [message]
#                    speaker=Mehir
#                    image=portraits/mehir-leader-shocked.png
#                    message= _ "Wh...what?"
#                [/message]
#                [message]
#                    speaker=Rashti
#                    image="portraits/rashti-ho.png"
#                    message= _ "...I died. I felt as if there was no good nor evil in me. I was Unity..."
#                [/message]
#                [message]
#                    speaker=Banisher
#                    message= _ "Amazing... an entity from Abyss that has visions... Itâ€™s the first time I have seen something like this. It looks like she regained her consciousness!"
#                [/message]
                [message]
                    speaker=Mehir
                    message= _ "Thank Nomolas! Youâ€™re back! It was a mistake bringing you here. Now everythingâ€™s back to normal, we can finally go home."
                [/message]
#                [message]
#                    speaker=Banisher
#                    message= _ "In accordance to the regulations the local guild will confiscate all of magical beings that have betrayed their masters. They will be sent back to the Abyss, where their minds will be cleared."
#                    message= _ "Some of the traitors may have fled, but without their leader, they'll pose no real threat."
#                [/message]
                [message]
                    speaker=Banisher
#                    message= _ "I think, though, it wouldnâ€™t be necessary for Rashti, because of her dual nature. The good half will draw her conclusions for the future, and never let her evil half betray you in similar situations again."
                    message= _ "If you don't mind, my liege, the Banishment Guild would like to place Rashti'rhami under surveillance. After all, there might be a 17.314% chance of her murdering you in your sleep after this incident."
                [/message]
            [/then]
            [else]
                [message]
                    speaker=Banisher
#                    message= _ "In accordance to the regulations the local guild will confiscate magical beings that have betrayed their masters. They will be sent back to the Abyss, where their minds will be cleared."
                    message= _ "In accordance to the regulations the local guild will confiscate magical beings that have betrayed their masters. They will be sent back to the Abyss, to having their minds cleared."
                [/message]
            [/else]
        [/if]
        [if]
            [have_unit]
                id=Banisher
            [/have_unit]
            [then]
                [message]
                    speaker=Mehir
#                    message= _ "I understand. Your knowledge has proved to be most helpful, so Iâ€™ve decided to allow you to have some of my luxuries!"
                    message= _ "Good idea. By the way, for your plentiful assistance, I'll give you some of my luxuries."
                [/message]
                [message]
                    speaker=Banisher
                    message= _ "Oh, my liege! I am extremely honored! Letâ€™s return to the city!"
                [/message]
            [/then]
        [/if]

        [if]
            [variable]
                name=turnlimitpassed
		not_equals=yes
            [/variable]
            [then]
        {UNIT 1 (EoMa_Novice_Summoner) $x1 $y1 (id,animate,random_name,generate_traits=messenger,yes,yes,yes)}
        [message]
            speaker=messenger
            message= _ "Sir, we searched the rebel camp, and we found some belongings of their leader that you might want to have a look at."
        [/message]
        [message]
            speaker=Mehir
            message= _ "Alright, let's see... Wow, for an efreet, the guy sure loves reading, looks we're got: 'The Basics of Summoning: A Guide for Beginners','A Summoning Guide for Jinn','al-Kamija's political flaws','The Immorality of Dimensional Gates' and 'De-constructing Banishment'..."
        [/message]
        [message]
            speaker=Mehir
            image=portraits/mehir-leader-happy.png
            message= _ "Hey, look! It's the very sphere he used to protect himself! We might be able to use it too."
        [/message]
	[message]
		speaker=narrator
		image=halo/jinn-circle2.png
		message= _ "The sphere can be given to a unit upon recall, like the artifacts from Ka-Gatta. It provides the bearer with an increase of 15% to all resistances."
	[/message]
	{VARIABLE item_Sphere_picked_up yes}
	{VARIABLE item_Sphere_in_use no}
	    [/then]
        [/if]
	
        [if]
            [have_unit]
                id=Rashti
            [/have_unit]
            [then]
                [message]
                    speaker=Rashti
#                    message= _ "...Someone is coming... I hear their breath â€” it is a human... they are coming from the north-west..."
                    message= _ "...I sense something approaching... I am catching the sound of heavy breathing... it's a human!"
                [/message]
                [message]
                    speaker=Mehir
                    image=portraits/mehir-leader-angry.png
#                    message= _ "A human! Alone?! Weâ€™re in the Great Desert!"
                    message= _ "Who in the right mind would be wandering the desert alone?! Send the camel riders to investigate, fast!"
                [/message]
            [/then]
        [/if]
        {UNIT 4 (EoMa_Master_of_Sun) 2 1 (name=Unknown
        hitpoints=17
        image_icon="portraits/kharos/masterofsun.png~CROP(180,50,130,130)~SCALE(72,72)"
        id=Unknown
	name= _ "???")}
        [message]
            speaker=Unknown
#            message= _ "...Iâ€™ve finally found... you..."
            message= _ "*heavy breathing* ...I...finally...found...you..."
        [/message]
        [kill]
          id=Unknown
          animate=yes
        [/kill]
        [message]
            speaker=Mehir
#           message= _ "He mustâ€™ve fainted. Quick, give him something to drink! We must bring him to Tar-Tabar!"
            image=portraits/mehir-leader-angry.png
            message= _ "He mustâ€™ve fainted! Quick, give the man some water! We need to bring him to Tar-Tabar immediately!"
        [/message]
		{CLEAR_VARIABLE dispellers}
        [endlevel]
            name=victory
            linger_mode=no
            carryover_report=yes
            {NEW_GOLD_CARRYOVER 40}
            bonus=no
        [/endlevel]
    [/event]

    #dispellers limit
    [event]
        name=recruit
        first_time_only=no
        [filter]
            type=EoMa_Dispeller
        [/filter]
		
		{VARIABLE_OP dispellers add 1}

        {IF_VAR dispellers equals 5 (
            [then]
                [disallow_recruit]
                    side=1
                    type=EoMa_Dispeller
                [/disallow_recruit]
                [message]
                    speaker=Banisher
                    message= _ "Unfortunately, this the last dispeller I brought. We don't have any more available."
                [/message]
                [message]
                    speaker=Mehir
 #                   message= _ "Only five?! I thought Tar-Tabar had more dispellers than that..."
                    image=portraits/mehir-leader-angry.png
                    message= _ "Only five?! You've got to be kidding me! I thought Tar-Tabar had more!"
                [/message]
                [message]
                    speaker=Banisher
#                    message= _ "Unfortunately, Tashkar stinted our guild. Forgive me, my liege, but we are unable to train more of them."
                    message= _ "*sigh* You see, Tashkar stinted our guild. Forgive me, my liege, but due to his policies, weren't allowed to train more dispellers."
                [/message]
                [message]
                    speaker=Mehir
                    image=portraits/mehir-leader-angry.png
#                   message= _ "Excellent, weâ€™re fighting against one of the biggest evils in the entire Red Abyss, and I've got only five dispellers... If we survive this madness, I will remove his limitations."
                    message= _ "Excellent, weâ€™re fighting against an entire army of red beings, and I've got only five dispellers to work with... If we survive this madness, I will make sure to remove these absurd limitations! Why the hell did he even make them in the first place?..."
                [/message]
                [message]
                    speaker=Banisher
#                    message= _ "Your goodness is unmeasured! Thank you!"
                    message= _ "Indeed..."
                [/message]
            [/then]
        )}
    [/event]
    [event]
       name=time over
       [message]
          speaker=Reficul
          message= _ "<i>*to himself* This is taking far too long. The enemy is far too inactive, suspiciously inactive, mind you. I need to flee while they're still preparing whatever devious plan they have in store...</i>"
       [/message]
       [delay]
          time=1000
       [/delay]
       {VARIABLE turnlimitpassed yes}
       {BADASS_MODE_CHANGE (
       [message]
          speaker=Reficul
          message= _ "Uhh... I need to use the bathroom, see you!"
       [/message]
       [message]
          speaker=Mehir
          message= _ "Hell no! Get back here!"
       [/message]
       {REFICUL_DISAPPEAR_ANIM}
       [message]
          speaker=Mehir
          message= _ "..."
       [/message]
       ) (
       [fire_event]
          name=last breath
	  [primary_unit]
	    id=Reficul
	  [/primary_unit]
       [/fire_event])}
       [fire_event]
          name=die
	  [primary_unit]
	    id=Reficul
	  [/primary_unit]
       [/fire_event]
    [/event]
    [event]
       name=turn 4
        {BADASS_MODE_CHANGE (
        [message]
            speaker=Mehir
            message= _ "I got an idea! Have the army distract the enemies, while I sneak around them. Time for 'Operation: Box' to commence!"
        [/message]
                [object]
		   silent=yes
                   duration=forever
                   [filter]
                      id=Mehir
                   [/filter]
                   [effect]
                      apply_to=variation
		      name=box
                   [/effect]
                [/object]
		{MODIFY_UNIT id=Mehir profile "items/box.png~SCALE(288,288)"}
	[delay]
	   time=2000
	[/delay]	
        [message]
            speaker=Banisher
            message= _ "So... you are trying to sneak around the efreeti by hiding in a cardboard box? My liege, have you completely lost your mind?! Get out of there, that lousy parody of a disguise is only going to get you killed."
        [/message]
#        [message]
#            speaker=Mehir
#            message= _ "Come on, this works in video games."
#        [/message]
#        [message]
#            speaker=Banisher
#            message= _ "I think you've been playing far too many of them in Tar-Tabar. Anyway, get out of there, that lousy parody of a disguise is only going to get you killed."
#        [/message]
        [message]
            speaker=Mehir
            message= _ "Fine, fine... *sigh*"
        [/message]
	[delay]
	   time=500
	[/delay]	
		{MODIFY_UNIT id=Mehir profile "portraits/mehir-leader.png~BLIT(misc/sunglasses.png)"}
                [object]
		   silent=yes
                   duration=forever
                   [filter]
                      id=Mehir
                   [/filter]
                   [effect]
                      apply_to=variation
		      name=badass
                   [/effect]
                [/object]
) ()}
    [/event]
    {SUMMONER_UNLOCK}
    {ITEM_APPLIER}
    {COLLAR_EVENT}
    {DEATH_MEHIR}
    {DEATH_RASHTI}
    {I8M14_TERRAIN}
[/scenario]
