#textdomain wesnoth-To_Lands_Unknown
[scenario]
    id=15_Gates_of_Kharos
    next_scenario=16_The_City_of_Light
    name= _ "Gates of Kharos"
    map_data="{~add-ons/To_Lands_Unknown/maps/16_GatesofKharos.map}"
    turns=-1
    victory_when_enemies_defeated=no

    {SCENARIO_MUSIC siege_of_laurelmor.ogg}
    {EXTRA_SCENARIO_MUSIC vengeful.ogg}
    {EXTRA_SCENARIO_MUSIC casualties_of_war.ogg}
    {AFTERNOON}

    [event]
        name = preload
        first_time_only = no
        [lua]
            code=<< main = wesnoth.dofile("~add-ons/To_Lands_Unknown/lua/animation.lua") >>
        [/lua]
    [/event]

    {STORYTXT_GATES_OF_KHAROS}

    {STARTING_VILLAGES 1 3}
    {STARTING_VILLAGES 2 8}
    {STARTING_VILLAGES 3 4}
    {STARTING_VILLAGES 4 4}
    {STARTING_VILLAGES 5 3}
	{STARTING_VILLAGES_AREA 4 37 25 2} 

    [side]
        side=1
        controller=human
        team_name=mehirteam
        user_team_name= _ "team_name^Mehir"

        type=TLU_Mehir_Leader
        id=Mehir
        name= _ "Mehir"
        unrenamable=yes
        canrecruit=yes
        profile=portraits/mehir-leader.png

        recruit=EoMa_Novice_Summoner,EoMa_Camel_Rider,EoMa_Carpet_Rider,EoMa_Water_Elemental,EoMa_Summoner,EoMa_Rhami,EoMa_Fire_Elemental,EoMa_Dispeller

        {GOLD 1000 750 500}
        {INCOME 30 25 20}

        {UNIT 1 (EoMa_Master_of_Sun) () () (placement=leader
        id=Atiros
		image_icon="portraits/kharos/masterofsun.png~CROP(180,50,130,130)~SCALE(72,72)"
        {IS_HERO}
        name=Atiros)}
    [/side]

    [side]
        side=2
        controller=ai
        team_name=tharis
        user_team_name= _ "team_name^Almathis"
        type=EoMa_Master_of_Darkness
        name= _ "Almathis"
        id=Master
        unrenamable=yes
        canrecruit=yes
        color=black
        {FLAG_VARIANT undead}
		image_icon="portraits/tharis/masterofdarkness.png~CROP(120,30,130,130)~SCALE(72,72)"

        recruit=EoMa_Disciple,EoMa_Dark_Wizard,EoMa_Great_Witch,EoMa_Raging_Hydra

        [ai]
            aggression=1.0
			passive_leader=yes
        [/ai]
		
		{GOLD 680 800 920}
        {INCOME 25 32 40}

        {UNIT 2 (EoMa_Great_Warlock) 17 23 (ai_special,upkeep=guardian,loyal)}
        {UNIT 2 (EoMa_Great_Warlock) 21 23 (ai_special,upkeep=guardian,loyal)}
        {UNIT 2 (EoMa_General) 17 25 (ai_special,upkeep=guardian,loyal)}
        {UNIT 2 (EoMa_General) 21 25 (ai_special,upkeep=guardian,loyal)}
        {UNIT 2 (EoMa_Chaos_Hydra) 18 22 (ai_special,upkeep=guardian,loyal)}
        {UNIT 2 (EoMa_Chaos_Hydra) 20 22 (ai_special,upkeep=guardian,loyal)}
        {UNIT 2 (EoMa_Chaos_Hydra) 18 25 (ai_special,upkeep=guardian,loyal)}
        {UNIT 2 (EoMa_Chaos_Hydra) 20 25 (ai_special,upkeep=guardian,loyal)}
        {UNIT 2 (EoMa_Matriarch_of_Darkness) 14 23 (ai_special,upkeep=guardian,loyal)}
        {UNIT 2 (EoMa_Matriarch_of_Darkness) 24 23 (ai_special,upkeep=guardian,loyal)}
        {UNIT 2 (TLU_animhack) 19 9 (variation,facing=kharos,se)}
    [/side]
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 (EoMa_Raging_Hydra) 4}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 (EoMa_Dark_Wizard) 6}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 (EoMa_Disciple) 3}

    [side]
        side=3
        controller=ai
        team_name=tharis
        user_team_name= _ "team_name^Amithrior"
        type=EoMa_Master_of_War
        name=_"Amithrior"
        image_icon="portraits/tharis/masterofwar.png~CROP(190,30,130,130)~SCALE(72,72)"
        unrenamable=yes
        canrecruit=yes
        color=purple
        {FLAG_VARIANT undead}

        recruit=EoMa_Dark_Warrior,EoMa_Hydra,Vampire Bat,Blood Bat,EoMa_Commander,EoMa_Dark_Slayer

        [ai]
            aggression=1.0
        [/ai]
		
		{GOLD 280 360 440}
        {INCOME 20 25 30}
    [/side]

    [side]
        side=4
        controller=ai
        team_name=tharis
        user_team_name= _ "team_name^Thrion"
        image_icon="portraits/tharis/masterofwar.png~CROP(190,30,130,130)~SCALE(72,72)"
        type=EoMa_Master_of_War
        name=_"Thrion"
        unrenamable=yes
        canrecruit=yes
        color=blue
        {FLAG_VARIANT undead}

        recruit=EoMa_Dark_Warrior,EoMa_Dark_Hunter,EoMa_Bladedancer,EoMa_Great_Hunter,EoMa_Dark_Assassin,EoMa_Sworddancer

        [ai]
            aggression=1.0
        [/ai]

		{GOLD 280 360 440}
        {INCOME 20 25 30}
    [/side]

    [side]
        side=5
        controller=ai
        team_name=mehirteam
        user_team_name= _ "team_name^Dedylos"

        type=EoMa_Platinum_Warrior
        id=Dedylos
        name= _ "Dedylos"
        unrenamable=yes
        canrecruit=yes
        color=white
		image_icon="portraits/kharos/platinum-warrior.png~CROP(130,10,150,150)~SCALE(72,72)~FL(horiz)"

        recruit=EoMa_White_Warrior,EoMa_Protector,EoMa_Brown_Warrior,EoMa_Shielder,EoMa_Cavalry_Archer,EoMa_Sun_Follower

        [ai]
            aggression=0.2
			[avoid]
				x,y=19,9
			[/avoid]
        [/ai]
        {GOLD 800 650 500}
        {INCOME 30 25 20}

        {UNIT 5 (EoMa_Silver_Warrior) 13 5 (upkeep=loyal)}
        {UNIT 5 (EoMa_Silver_Warrior) 13 2 ()}
        {UNIT 5 (EoMa_Silver_Warrior) 13 3 ()}
        {UNIT 5 (EoMa_Silver_Warrior) 13 4 ()}

        {UNIT 5 (EoMa_Silver_Warrior) 25 5 (facing=sw
        upkeep=loyal)}
        {UNIT 5 (EoMa_Silver_Warrior) 25 2 (facing=sw
        upkeep=loyal)}
        {UNIT 5 (EoMa_Silver_Warrior) 25 3 (facing=sw
        upkeep=loyal)}
        {UNIT 5 (EoMa_Silver_Warrior) 25 4 (facing=sw
        upkeep=loyal)}

        {UNIT 5 (EoMa_Protector) 14 1 (upkeep=loyal)}
        {UNIT 5 (EoMa_Protector) 14 2 (upkeep=loyal)}
        {UNIT 5 (EoMa_Protector) 14 3 (upkeep=loyal)}
        {UNIT 5 (EoMa_Protector) 14 4 (upkeep=loyal)}

        {UNIT 5 (EoMa_Protector) 24 1 (facing=sw
        upkeep=loyal)}
        {UNIT 5 (EoMa_Protector) 24 2 (facing=sw
        upkeep=loyal)}
        {UNIT 5 (EoMa_Protector) 24 3 (facing=sw
        upkeep=loyal)}
        {UNIT 5 (EoMa_Protector) 24 4 (facing=sw
        upkeep=loyal)}

        {UNIT 5 (EoMa_Avenger) 12 1 (upkeep=loyal)}
        {UNIT 5 (EoMa_Avenger) 12 2 (upkeep=loyal)}
        {UNIT 5 (EoMa_Avenger) 12 3 (upkeep=loyal)}
        {UNIT 5 (EoMa_Avenger) 12 4 (upkeep=loyal)}

        {UNIT 5 (EoMa_Avenger) 26 1 (facing=sw
        upkeep=loyal)}
        {UNIT 5 (EoMa_Avenger) 26 2 (facing=sw
        upkeep=loyal)}
        {UNIT 5 (EoMa_Avenger) 26 3 (facing=sw
        upkeep=loyal)}
        {UNIT 5 (EoMa_Avenger) 26 4 (facing=sw
        upkeep=loyal)}

        {UNIT 5 (EoMa_Sun_Follower) 11 5 (upkeep=loyal)}
        {UNIT 5 (EoMa_Sun_Follower) 11 2 (upkeep=loyal)}
        {UNIT 5 (EoMa_Sun_Follower) 11 3 (upkeep=loyal)}
        {UNIT 5 (EoMa_Sun_Follower) 11 4 (upkeep=loyal)}

        {UNIT 5 (EoMa_Sun_Follower) 27 5 (facing=sw
        upkeep=loyal)}
        {UNIT 5 (EoMa_Sun_Follower) 27 2 (facing=sw
        upkeep=loyal)}
        {UNIT 5 (EoMa_Sun_Follower) 27 3 (facing=sw
        upkeep=loyal)}
        {UNIT 5 (EoMa_Sun_Follower) 27 4 (facing=sw
        upkeep=loyal)}

        {UNIT 5 (EoMa_Shielder) 9 4 (upkeep=loyal
		ai_special=guardian)}
        {UNIT 5 (EoMa_Shielder) 9 5 (upkeep=loyal
		ai_special=guardian)}
        {UNIT 5 (EoMa_Shielder) 9 6 (upkeep=loyal
		ai_special=guardian)}
        {UNIT 5 (EoMa_Shielder) 9 7 (upkeep=loyal
		ai_special=guardian)}

        {UNIT 5 (EoMa_Shielder) 29 4 (facing=sw
		ai_special=guardian
        upkeep=loyal)}
        {UNIT 5 (EoMa_Shielder) 29 5 (facing=sw
		ai_special=guardian
        upkeep=loyal)}
        {UNIT 5 (EoMa_Shielder) 29 6 (facing=sw
		ai_special=guardian
        upkeep=loyal)}
        {UNIT 5 (EoMa_Shielder) 29 7 (facing=sw
		ai_special=guardian
        upkeep=loyal)}

        {UNIT 5 (EoMa_Shielder) 8 4 (upkeep=loyal
		ai_special=guardian)}
        {UNIT 5 (EoMa_Shielder) 8 5 (upkeep=loyal
		ai_special=guardian)}
        {UNIT 5 (EoMa_Shielder) 8 6 (upkeep=loyal
		ai_special=guardian)}
        {UNIT 5 (EoMa_Shielder) 8 7 (upkeep=loyal
		ai_special=guardian)}

        {UNIT 5 (EoMa_Shielder) 30 4 (facing=sw
		ai_special=guardian
        upkeep=loyal)}
        {UNIT 5 (EoMa_Shielder) 30 5 (facing=sw
		ai_special=guardian
        upkeep=loyal)}
        {UNIT 5 (EoMa_Shielder) 30 6 (facing=sw
		ai_special=guardian
        upkeep=loyal)}
        {UNIT 5 (EoMa_Shielder) 30 7 (facing=sw
		ai_special=guardian
        upkeep=loyal)}

        {UNIT 5 (EoMa_White_Warrior) 7 4 (upkeep=loyal
		ai_special=guardian)}
        {UNIT 5 (EoMa_White_Warrior) 7 5 (upkeep=loyal
		ai_special=guardian)}
        {UNIT 5 (EoMa_White_Warrior) 7 6 (upkeep=loyal
		ai_special=guardian)}
        {UNIT 5 (EoMa_White_Warrior) 7 7 (upkeep=loyal
		ai_special=guardian)}

        {UNIT 5 (EoMa_White_Warrior) 31 4 (facing=sw
		ai_special=guardian
        upkeep=loyal)}
        {UNIT 5 (EoMa_White_Warrior) 31 5 (facing=sw
		ai_special=guardian
        upkeep=loyal)}
        {UNIT 5 (EoMa_White_Warrior) 31 6 (facing=sw
		ai_special=guardian
        upkeep=loyal)}
        {UNIT 5 (EoMa_White_Warrior) 31 7 (facing=sw
		ai_special=guardian
        upkeep=loyal)}

        {UNIT 5 (EoMa_Cleric) 5 4 (upkeep=loyal
		ai_special=guardian)}
        {UNIT 5 (EoMa_Cleric) 5 5 (upkeep=loyal
		ai_special=guardian)}
        {UNIT 5 (EoMa_Cleric) 5 6 (upkeep=loyal
		ai_special=guardian)}
        {UNIT 5 (EoMa_Cleric) 5 7 (upkeep=loyal
		ai_special=guardian)}

        {UNIT 5 (EoMa_Cleric) 33 4 (facing=sw
		ai_special=guardian
        upkeep=loyal)}
        {UNIT 5 (EoMa_Cleric) 33 5 (facing=sw
		ai_special=guardian
        upkeep=loyal)}
        {UNIT 5 (EoMa_Cleric) 33 6 (facing=sw
		ai_special=guardian
        upkeep=loyal)}
        {UNIT 5 (EoMa_Cleric) 33 7 (facing=sw
		ai_special=guardian
        upkeep=loyal)}

        {UNIT 5 (EoMa_Inspired) 4 4 (upkeep=loyal
		ai_special=guardian)}
        {UNIT 5 (EoMa_Inspired) 4 5 (upkeep=loyal
		ai_special=guardian)}
        {UNIT 5 (EoMa_Inspired) 4 6 (upkeep=loyal
		ai_special=guardian)}
        {UNIT 5 (EoMa_Inspired) 4 7 (upkeep=loyal
		ai_special=guardian)}

        {UNIT 5 (EoMa_Inspired) 34 4 (facing=sw
		ai_special=guardian
        upkeep=loyal)}
        {UNIT 5 (EoMa_Inspired) 34 5 (facing=sw
		ai_special=guardian
        upkeep=loyal)}
        {UNIT 5 (EoMa_Inspired) 34 6 (facing=sw
		ai_special=guardian
        upkeep=loyal)}
        {UNIT 5 (EoMa_Inspired) 34 7 (facing=sw
		ai_special=guardian
        upkeep=loyal)}

        {UNIT 5 (EoMa_Adept_of_Light) 3 4 (upkeep=loyal
		ai_special=guardian)}
        {UNIT 5 (EoMa_Adept_of_Light) 3 5 (upkeep=loyal
		ai_special=guardian)}
        {UNIT 5 (EoMa_Adept_of_Light) 3 6 (upkeep=loyal
		ai_special=guardian)}
        {UNIT 5 (EoMa_Adept_of_Light) 3 7 (upkeep=loyal
		ai_special=guardian)}

        {UNIT 5 (EoMa_Adept_of_Light) 35 4 (facing=sw
		ai_special=guardian
        upkeep=loyal)}
        {UNIT 5 (EoMa_Adept_of_Light) 35 5 (facing=sw
		ai_special=guardian
        upkeep=loyal)}
        {UNIT 5 (EoMa_Adept_of_Light) 35 6 (facing=sw
		ai_special=guardian
        upkeep=loyal)}
        {UNIT 5 (EoMa_Adept_of_Light) 35 7 (facing=sw
		ai_special=guardian
        upkeep=loyal)}
    [/side]

    [side]
        side=6
        controller=ai
        team_name=mehirteam
        user_team_name= _ "team_name^Kharos"

        type=EoMa_Prophet_of_Light
        id=Anthi
        name= _ "Anthi"
        unrenamable=yes
        canrecruit=yes
        color=white
        profile=portraits/anthi.png
		image_icon="portraits/anthi.png~CROP(140,10,180,180)~SCALE(72,72)"

        recruit=EoMa_White_Warrior,EoMa_Protector,EoMa_Brown_Warrior,EoMa_Shielder,EoMa_Cavalry_Archer,EoMa_Sun_Follower

        {GOLD 400 300 200}
        {INCOME 10 5 0}

        {UNIT 6 (EoMa_Kirios) 7 9 (name= _ "Bodyguard"
        unrenamable=yes)}

        {UNIT 6 (EoMa_Golden_Warrior) 9 9 (id=Adviser
        name= _ "Advisor")}

        {UNIT 6 (EoMa_Platinum_Warrior) 19 2 (moves,max_moves=0,0)}
        {UNIT 6 (EoMa_Platinum_Warrior) 19 3 (moves,max_moves=0,0)}
        {UNIT 6 (EoMa_Platinum_Warrior) 19 4 (moves,max_moves=0,0)}
        {UNIT 6 (EoMa_Platinum_Warrior) 19 5 (moves,max_moves=0,0)}
        {UNIT 6 (EoMa_Platinum_Warrior) 19 6 (moves,max_moves=0,0)}

        {UNIT 6 (EoMa_Brown_Warrior) 18 2 (moves,max_moves=0,0)}
        {UNIT 6 (EoMa_Brown_Warrior) 18 3 (moves,max_moves=0,0)}
        {UNIT 6 (EoMa_Brown_Warrior) 18 4 (moves,max_moves=0,0)}
        {UNIT 6 (EoMa_Brown_Warrior) 18 5 (moves,max_moves=0,0)}
        {UNIT 6 (EoMa_Brown_Warrior) 18 6 (moves,max_moves=0,0)}

        {UNIT 6 (EoMa_Brown_Warrior) 20 2 (moves,max_moves=0,0)}
        {UNIT 6 (EoMa_Brown_Warrior) 20 3 (moves,max_moves=0,0)}
        {UNIT 6 (EoMa_Brown_Warrior) 20 4 (moves,max_moves=0,0)}
        {UNIT 6 (EoMa_Brown_Warrior) 20 5 (moves,max_moves=0,0)}
        {UNIT 6 (EoMa_Brown_Warrior) 20 6 (moves,max_moves=0,0)}

        {UNIT 6 (EoMa_Sun_Guardian) 21 2 (moves,max_moves=0,0)}
        {UNIT 6 (EoMa_Sun_Guardian) 21 3 (moves,max_moves=0,0)}
        {UNIT 6 (EoMa_Sun_Guardian) 21 4 (moves,max_moves=0,0)}
        {UNIT 6 (EoMa_Sun_Guardian) 21 5 (moves,max_moves=0,0)}
        {UNIT 6 (EoMa_Sun_Guardian) 21 6 (moves,max_moves=0,0)}
        {UNIT 6 (EoMa_Sun_Guardian) 17 2 (moves,max_moves=0,0)}
        {UNIT 6 (EoMa_Sun_Guardian) 17 3 (moves,max_moves=0,0)}
        {UNIT 6 (EoMa_Sun_Guardian) 17 4 (moves,max_moves=0,0)}
        {UNIT 6 (EoMa_Sun_Guardian) 17 5 (moves,max_moves=0,0)}
        {UNIT 6 (EoMa_Sun_Guardian) 17 6 (moves,max_moves=0,0)}
    [/side]
	
	{RASHTI_SIDES 7 8}

    [event]
        name=prestart
        [recall]
            id=Rashti
        [/recall]
        {PLACE_HALO "scenery/gatekharos0.png" 19 9}
        #{PLACE_HALO "scenery/wall.png" 6 9}
        #{PLACE_HALO "scenery/kharos-soldiers.png" 19 4}
		{MODIFY_UNIT id=Anthi max_moves 0}
    [/event]

    [event]
        name=start
        [store_unit]
            [filter]
                side=5
            [/filter]
            variable=army
        [/store_unit]
        {FOREACH army i}
            {VARIABLE army[$i].moves 0}
            {VARIABLE army[$i].max_moves 0}
            [unstore_unit]
                variable=army[$i]
                find_vacant=no
            [/unstore_unit]
        {NEXT i}
        [message]
            speaker=Mehir
            message= _ "We’re a bit too late."
        [/message]
        {SCROLL_TO 19 24}
        [delay]
            time=500
        [/delay]
        {SCROLL_TO 19 4}
        [delay]
            time=500
        [/delay]
        [message]
            speaker=Anthi
            message= _ "There are too many of them. This day had to come..."
        [/message]
        [message]
            speaker=Adviser
            message= _ "Don’t lose hope, Anthi. These walls have protected our peoples for centuries; nothing can destroy our gates."
        [/message]
        [message]
            speaker=Anthi
            message= _ "Atiros hasn’t returned..."
        [/message]
        [message]
            speaker=Adviser
            message= _ "I’m not sure whether he returned or not, but I can see an army in the distance. They must be troops from Saffaros, and those beside them... They don’t look like the warriors of Kharos, but they’re not of the invaders either..."
        [/message]
        [message]
            speaker=Anthi
            message= _ "Is this... Can it be true? They... exist? I can’t feel them because of this dark aura..."
        [/message]

        [message]
            speaker=Dedylos
            message=_ "Strange. These creatures always attacked after dusk, but this time is different. I have bad feelings about this."
        [/message]
        [message]
            speaker=Mehir
            message=_ "Don’t forget they are surrounded. If we attack them by surprise, they will be at a disadvantage."
        [/message]
        [objectives]
            side=1
            [objective]
                description= _ "Defeat the invaders"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Mehir"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Rashti"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Atiros"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Dedylos"
                condition=lose
            [/objective]
        [/objectives]
    [/event]

    [event]
        name=side 2 turn 2
        [message]
            canrecruit=yes
            side=4
            message= _ "Master, the human armies rounded us from the east. The desert wizards are with them. We are surrounded!"
        [/message]
        [message]
            speaker=Master
            message= _ "*smiles sinisterly* this is just what I wanted... our gods shall be pleased.... It’s time for a REAL BLOODBATH!!!"
        [/message]
        [message]
            speaker=Master
            message= _ "...SIRAHT THES SORUTH..."
        [/message]
        {SCROLL_TO 19 13}
		[lock_view]
		[/lock_view]
        [sound]
            name=magic-dark-big.ogg
        [/sound]
        {FAKE_SCENERY_ANIM scenery/implosion 10 19 13 100}
		{PLACE_HALO "scenery/gatecracks.png" 19 13}
        [sound]
            name=explosion.ogg
        [/sound]
		{REMOVE_IMAGE 19 9}
		[animate_unit]
			flag=kharos
			[filter]
				type=TLU_animhack
			[/filter]
			with_bars=no
		[/animate_unit]
		[kill]
			type=TLU_animhack
			animate=no
		[/kill]
        {PLACE_HALO "scenery/gate-top0.png" 19 9}
        {REMOVE_IMAGE 19 4}
        {EARTHQUAKE (
			{PLACE_HALO "scenery/gatelying.png" 19 2}
			[terrain]
				terrain=Xv
				x,y=19,3
				radius=2
			[/terrain]
            [kill]
                x=17,18,19,20,21,17,18,19,20,21,17,18,19,20,21,17,18,19,20,21,17,18,19,20,21,
                y=2,2,2,2,2,3,3,3,3,3,4,4,4,4,4,5,5,5,5,5,6,6,6,6,6
                animate=no
            [/kill])}
            [delay]
                time=1000
            [/delay]
			[unlock_view]
			[/unlock_view]
            {SCROLL_TO 19 4}
            [delay]
                time=2000
            [/delay]
            [message]
                speaker=Anthi
                message= _ "!!!"
            [/message]
            [message]
                speaker=Adviser
                message= _ "Our indestructible gates... Our best soldiers..."
            [/message]
            [message]
                speaker=Dedylos
                message= _ "What are the limits of that hated voice, whose mere sound tears the thickest walls?!"
            [/message]
            [message]
                speaker=Mehir
                message= _ "Looks like it has no limits. Let's hope they won’t throw buildings on us..."
            [/message]
            [message]
                speaker=Dedylos
                message= _ "!"
            [/message]
            [message]
                speaker=Anthi
                message= _ "Those apostles of death cannot enter our capital. Send half of our soldiers to the battlefield!"
            [/message]
            {FOREACH army i}
                {VARIABLE army[$i].moves 5}
                {VARIABLE army[$i].max_moves 5}
                [unstore_unit]
                    variable=army[$i]
                    find_vacant=no
                [/unstore_unit]
            {NEXT i}
            {CLEAR_VARIABLE army}
        [/event]

        [event]
            name=side 2 turn 5
            [message]
                speaker=Master
                message= _ "The fools are coming... FALL!"
            [/message]

            {REMOVE_IMAGE 19 15}
			[lock_view]
			[/lock_view]
            {SCROLL_TO 19 13}
            [sound]
                name=explosion.ogg
            [/sound]
			{UNIT 2 (TLU_animhack) 19 9 (variation,placement,facing=kharos2,map_overwrite,se)}
			{REMOVE_IMAGE 19 9}
			{PLACE_HALO "scenery/gate-top2.png" 19 9}
			[animate_unit]
				flag=kharos2
				[filter]
					type=TLU_animhack
				[/filter]
				with_bars=no
			[/animate_unit]
			{PLACE_HALO "scenery/top-end0.png" 19 9}
			[kill]
				type=TLU_animhack
				animate=no
			[/kill]
            
            {EARTHQUAKE ()}
            [kill]
                x=16-22,21
                y=14-17,18
                animate=no
            [/kill]
            [terrain]
                terrain=Rp^Xo
                x=16,17,18,22,16,17,18,19,20,21,22,16,17,18,19,20,21,22,16,17,18,19,20,21,22
                y=14,14,14,14,15,15,15,15,15,15,15,16,16,16,16,16,16,16,17,17,17,17,17,17,17
            [/terrain]
			[unlock_view]
			[/unlock_view]
        [/event]

        #master's death events
        [event]
            name=attack
			
			[filter_second]
				id=Master
			[/filter_second]
			
			[message]
                speaker=Mehir
                message= _ "He seems to dissolve himself into ...bats? We need to watch out."
            [/message]
		[/event]
		#master's death events
        [event]
            name=last breath

            [filter]
                id=Master
            [/filter]

            [message]
                speaker=Master
                message= _ "HAHAHAAAAAhaa!!! You’re pitiful."
            [/message]
            [gold]
                side=3
                {QUANTITY amount 300 425 550}
            [/gold]
            [gold]
                side=4
                {QUANTITY amount 300 425 550}
            [/gold]
            [store_unit]
                [filter]
                    x,y=$x1,$y1
                [/filter]
                variable=mastervar
                kill=yes
            [/store_unit]
            {UNIT 2 (Dread Bat) ($x1) ($y1) ()}
            {UNIT 2 (Dread Bat) ($x1) ($y1) ()}
            {UNIT 2 (Dread Bat) ($x1) ($y1) ()}
        [/event]

        [event]
            name=die
            first_time_only=no
            [filter]
                type=Dread Bat
            [/filter]

            [if]
                [have_unit]
                    type=Dread Bat
                [/have_unit]
                [else]
                    [unstore_unit]
                        variable=mastervar
                        x,y=25,6
                    [/unstore_unit]
                    {FULL_HEAL id=Master}
                    {CLEAR_VARIABLE mastervar}
					{MODIFY_UNIT id=Master moves 0}
					{MODIFY_UNIT id=Master max_moves 0}
                    [message]
                        speaker=Master
                        message= _ "You can try to stop us, but all your efforts will fail. We are the new Destroyers. We know no retreat nor mercy."
                    [/message]
                    [message]
                        speaker=Master
                        message= _ "This is our holy mission given to us by the Eye of Darkness. Only by destruction we can prove we are worth living. The Destroyers will spare us, when they return. But before this happens, we will slaugher you to the very end."
                    [/message]
                    [message]
                        speaker=Mehir
						image=portraits/mehir-leader-angry.png
                        message= _ "They want to fight the entire world? This is madness which has to be stopped now!"
                    [/message]
                    [message]
                        speaker=Mehir
						image=portraits/mehir-leader-angry.png
                        message= _ "Rashti, can you reach him?"
                    [/message]
                    [message]
                        speaker=Rashti
                        message= _ "Yes."
                    [/message]
                    [message]
                        speaker=Mehir
                        message= _ "So kill him!"
                    [/message]
                    {PLACE_IMAGE "items/gohere.png" 19 19}
                    {HIGHLIGHT_IMAGE 19 19 "items/gohere.png" ()}
                [/else]
            [/if]
        [/event]

        [event]
            name=moveto
            first_time_only=no
            [filter]
                id=Rashti
                x,y=19,19
            [/filter]

            [if]
                [have_unit]
                    id=Master
                    x,y=25,6
                [/have_unit]
                [then]
                    {REMOVE_IMAGE 19 19}
                    {SCROLL_TO 19 16}
                    [store_unit]
                        [filter]
                            id=Rashti
                        [/filter]
                        kill=yes
                    [/store_unit]
                    [redraw]
                    [/redraw]
					[lock_view]
					[/lock_view]
                    {FAKE_SCENERY_ANIM scenery/climb-a 14 19 16 75}
                    {PLACE_HALO "scenery/climb-a-14.png" 19 16}
                    {SCROLL_TO 19 11}
                    {REMOVE_IMAGE 19 16}
                    {FAKE_SCENERY_ANIM scenery/climb-b 16 19 11 75}
                    {PLACE_HALO "scenery/climb-b-16.png" 19 11}
					{SCROLL_TO 19 7}
                    {REMOVE_IMAGE 19 11}
                    {FAKE_SCENERY_ANIM scenery/climb-c 8 19 7 75}
                    {PLACE_HALO "scenery/climb-c-8.png" 19 7}
                    {SCROLL_TO 22 7}
                    {REMOVE_IMAGE 19 7}
                    [animate_path]
                        x=-1175,200,600,1100
                        y=200,-60,-60,200
                        hex_x,hex_y=13,6
                        image=anim/climb-d.png
                        frames=20
                        frame_length=75
                        interpolation=bspline
                        linger=yes
                    [/animate_path]
                    [delay]
                        time=500
                    [/delay]
					#Master's time bubble
                    {FADE_TO_BLACK}
					{REPLACE_SCENARIO_MUSIC silence.ogg}
					[store_unit]
						[filter]
							[not]
								id=Master
							[/not]
						[/filter]
						variable=timefreeze
						kill=yes
					[/store_unit]
					{REMOVE_IMAGE 19 9}
					{REMOVE_IMAGE 19 2}
					[delay]
                        time=500
                    [/delay]
					[message]
                        speaker=Master
                        message=_ "And now time stops..."
                    [/message]
					{MOVE_UNIT id=Master 24 6}
					{MOVE_UNIT id=Master 23 6}
                    [message]
                        speaker=Master
                        message=_ "A magical being. A very different one from those present here on the battlefield."
                    [/message]
					{MOVE_UNIT id=Master 24 5}
					[message]
                        speaker=Master
                        message=_ "You seem to be of dual personality. Your body is composed of two completely opposing energies. And one of them is familiar to me - it thirsts for blood..."
                    [/message]
					{MOVE_UNIT id=Master 27 6}
					[message]
                        speaker=Master
                        message=_ "I wonder, what would happen if I separated both of you... It could unleash devastating power of your angry half, no longer bound to the voice of reason, or..."
                    [/message]
					[store_unit]
						[filter]
							id=Master
						[/filter]
						variable=master
						kill=yes
					[/store_unit]
					[unstore_unit]
						variable=master
						x,y=25,6
					[/unstore_unit]
					{MODIFY_UNIT id=Master facing sw}
					[message]
                        speaker=Master
                        message=_ "...or you could die. Let’s check!"
                    [/message]
                    [animate_unit]
                        flag=attack
                        [filter]
                            id=Master
                        [/filter]
                        [primary_attack]
                            name=scythe
                        [/primary_attack]
                        hits=yes
                        [facing]
                            [filter]
                                id=Anthi
                            [/filter]
                        [/facing]
                    [/animate_unit]
					{REMOVE_IMAGE 24 5}
					{FAKE_SCENERY_ANIM scenery/climb-e 8 19 7 150}
					{PLACE_HALO "scenery/gate-top2.png" 19 9}
					{PLACE_HALO "scenery/top-end0.png" 19 9}
					{PLACE_HALO "scenery/gatelying.png" 19 2}
                    {PLACE_HALO "scenery/white.png" 19 7}
					{PLACE_HALO "scenery/dharmarashti-dead.png" 18 16}
                    {PLACE_IMAGE "scenery/horashti-dead.png" 6 19}
					{REPLACE_SCENARIO_MUSIC siege_of_laurelmor.ogg}
					{APPEND_MUSIC vengeful.ogg}
					{APPEND_MUSIC casualties_of_war.ogg}
					{FOREACH timefreeze i}
						[unstore_unit]
							variable=timefreeze[$i]
							find_vacant=no
						[/unstore_unit]
					{NEXT i}
					{CLEAR_VARIABLE timefreeze}
                    {REMOVE_IMAGE 19 7}
                    {REMOVE_IMAGE 24 5}
                    {FADE_STEP 192 5}
                    {FADE_STEP 160 5}
                    {FADE_STEP 128 5}
                    {FADE_STEP 96 5}
                    {FADE_STEP 64 5}
                    {FADE_STEP 32 5}
                    {FADE_STEP 0 5}
					[unlock_view]
					[/unlock_view]
                    [message]
                        speaker=Mehir
                        message= _ "Rashti?... No, it’s impossible. This is another illusion, it can’t happen. She can’t die."
                    [/message]
                    {SCROLL_TO 18 16}
                    [delay]
                        time=1000
                    [/delay]
                    {SCROLL_TO 6 19}
                    [delay]
                        time=1000
                    [/delay]
                    [message]
                        speaker=Master
                        message= _ "Is that all you have to show me? I am disappointed."
                    [/message]
                    [message]
                        speaker=Dedylos
                        message= _ "She’s dead. I’m sorry, Mehir..."
                    [/message]
                    [message]
                        speaker=Mehir
                        message= _ "One of the ultimate beings has perished. The balance between worlds has been disrupted. If the High Council finds out about that, they will surely kill me..."
                    [/message]
                    [fire_event]
                        name=resurrect
                    [/fire_event]
                [/then]
            [/if]
        [/event]

        [event]
            name=resurrect
			
			{REMOVE_IMAGE 18 16}
            {REMOVE_IMAGE 6 19}
            {UNIT 7 (TLU_DharmaRashti) 16 19 ()}
            {UNIT 8 (TLU_HoRashti) 6 19 ()}

            [message]
                type=TLU_HoRashti
                message= _ "It is not..."
            [/message]
            [message]
                type=TLU_DharmaRashti
                message= _ "...OVER YET!!!"
            [/message]
            [message]
                speaker=Mehir
				image=portraits/mehir-leader-shocked.png
                message= _ "Rashti? You’re alive?! Both of you?"
            [/message]
            [message]
                type=TLU_HoRashti
                message= _ "Our personalities have been split and now are independent, but we must unite in order to restore the balance."
            [/message]
            [message]
                type=TLU_DharmaRashti
                message= _ "NEVER! I won’t be enslaved again! Now I am finally free and... I AM COMING FOR YOU, MEHIR!"
            [/message]
            [message]
                speaker=Mehir
                message= _ "*gulp*"
            [/message]
            [message]
                type=TLU_HoRashti
                message= _ "I will never allow you to harm our Master!"
            [/message]
            [message]
                type=TLU_DharmaRashti
                message= _ "JUST TRY AND STOP ME, I DARE YOU!!!"
            [/message]
			[message]
                id=Mehir
                message= _ "We must trap Dharma’Rashti, so that Ho’Rashti can get her and unite!"
            [/message]
			[objectives]
				side=1
				[objective]
					description= _ "Defeat the invaders"
					condition=win
				[/objective]
				[objective]
					description= _ "Block Dharma’Rashti so that Ho’Rashti can eliminate her and unite"
					condition=win
				[/objective]
				[objective]
					description= _ "Death of Mehir"
					condition=lose
				[/objective]
				[objective]
					description= _ "Death of Atiros"
					condition=lose
				[/objective]
				[objective]
					description= _ "Death of Dedylos"
					condition=lose
				[/objective]
			[/objectives]
        [/event]

        [event]
            name=unified
            [message]
                type=TLU_True_Rashti
                message= _ "Finally, after all the eternal struggle between my two egos, I am UNITY!"
            [/message]
            [message]
                speaker=Master
                message= _ "Amazing. I have split her in half, and she is still alive. She has also changed her colors! Nevermind, it’s time to kill you for the second ti..."
            [/message]
			[lock_view]
			[/lock_view]
            {SCROLL_TO 19 13}
            [terrain]
                terrain=Rp
                x=16,17,18,22,16,17,18,19,20,21,22,16,17,18,19,20,21,22,16,17,18,19,20,21,22
                y=14,14,14,14,15,15,15,15,15,15,15,16,16,16,16,16,16,16,17,17,17,17,17,17,17
            [/terrain]
            {EARTHQUAKE ()}
            {UNIT 2 (TLU_animhack) 19 9 (variation,placement,facing=kharos3,map_overwrite,se)}
			{REMOVE_IMAGE 19 9}
			[animate_unit]
				flag=kharos3
				[filter]
					type=TLU_animhack
				[/filter]
				with_bars=no
			[/animate_unit]
			{PLACE_HALO "scenery/gate-top0.png" 19 9}
			[kill]
				type=TLU_animhack
				animate=no
			[/kill]
			[sound]
				name=explosion.ogg
			[/sound]
            [message]
                speaker=Master
                message= _ "What is the meaning of this?!"
            [/message]
            [store_unit]
                [filter]
                    type=TLU_True_Rashti
                [/filter]
                variable=truerashtivar
                kill=yes
            [/store_unit]
            {VARIABLE truerashtivar.id Rashti}
            {SCROLL_TO ($truerashtivar.x) ($truerashtivar.y)}
            [delay]
                time=500
            [/delay]
            [message]
                speaker=Master
                message= _ "Where is this bi..."
            [/message]
            {FAKE_SCENERY_ANIM scenery/rev-a 4 25 4 100}
            [sound]
                name=explosion.ogg
            [/sound]
            {PLACE_HALO "scenery/rev-a-5.png" 25 4}
            [kill]
                id=Master
                animate=no
            [/kill]
            [redraw]
            [/redraw]
            [delay]
                time=1000
            [/delay]
            {FAKE_SCENERY_ANIM scenery/rev-b 10 25 4 50}
            {PLACE_HALO "scenery/rev-b-10.png" 25 4}

            {SCROLL_TO 25 8}
            [sound]
                name=explosion.ogg
            [/sound]
            [delay]
                time=250
            [/delay]
            {SCROLL_TO 25 11}
            [sound]
                name=explosion.ogg
            [/sound]
            [delay]
                time=250
            [/delay]
            {SCROLL_TO 25 14}
            [sound]
                name=explosion.ogg
            [/sound]
            [delay]
                time=500
            [/delay]
            {SCROLL_TO 25 17}
            [sound]
                name=explosion.ogg
            [/sound]
            [delay]
                time=250
            [/delay]
            [sound]
                name=explosion.ogg
            [/sound]
            {FAKE_SCENERY_ANIM scenery/rev-c 8 19 17 100}
            {PLACE_HALO "scenery/rev-c-8.png" 19 17}
            [unstore_unit]
                variable=truerashtivar
                x,y=22,17
            [/unstore_unit]
            [delay]
                time=500
            [/delay]
            {MOVE_UNIT id=Rashti 19 20}
            [message]
                speaker=Rashti
                message= _ "This is how WE kill!"
            [/message]
            {SCROLL_TO 19 13}
            {SCROLL_TO 19 13}
            [sound]
                name=explosion.ogg
            [/sound]
			{UNIT 2 (TLU_animhack) 19 9 (variation,placement,facing=kharos2,map_overwrite,se)}
			{REMOVE_IMAGE 19 9}
			{PLACE_HALO "scenery/gate-top2.png" 19 9}
			[animate_unit]
				flag=kharos2
				[filter]
					type=TLU_animhack
				[/filter]
				with_bars=no
			[/animate_unit]
			{PLACE_HALO "scenery/top-end0.png" 19 9}
			[kill]
				type=TLU_animhack
				animate=no
			[/kill]
            
            {EARTHQUAKE ()}
            [kill]
                x=16-22,21
                y=14-17,18
                animate=no
            [/kill]
            [terrain]
                terrain=Rp^Xo
                x=16,17,18,22,16,17,18,19,20,21,22,16,17,18,19,20,21,22,16,17,18,19,20,21,22
                y=14,14,14,14,15,15,15,15,15,15,15,16,16,16,16,16,16,16,17,17,17,17,17,17,17
            [/terrain]
			[unlock_view]
			[/unlock_view]

            [message]
                speaker=Mehir
                message= _ "Ra..Rashti... you’ve changed, yet your character is still the same. What happened?"
            [/message]
            [message]
                speaker=Rashti
                message= _ "I have finally achieved harmony. Two egos have become one. This is my true and final form."
            [/message]
        {VARIABLE turn_master2 0}
        [if]
            [have_unit]
                side=2,3,4
            [/have_unit]
            [then]
                [message]
                    speaker=Dedylos
                    message= _ "You’ll talk later; we have a job to do. Their leader is dead, but the rest haven’t given up yet."
                [/message]
				[objectives]
				side=1
				[objective]
					description= _ "Defeat the invaders"
					condition=win
				[/objective]
				[objective]
					description= _ "Death of Mehir"
					condition=lose
				[/objective]
				[objective]
					description= _ "Death of Atiros"
					condition=lose
				[/objective]
				[objective]
					description= _ "Death of Dedylos"
					condition=lose
				[/objective]
			[/objectives]
            [/then]
            [else]
                [endlevel]
                    result=victory
                [/endlevel]
            [/else]
        [/if]
    [/event]

    [event]
        name=victory
        {REPLACE_SCENARIO_MUSIC wanderer.ogg}
        [message]
            speaker=Atiros
            message= _ "We defended Kharos! Anthi, WE DID IT!!!"
        [/message]
        [message]
            speaker=Anthi
            message= _ "The dark aura has disappeared. Atiros, I sent you with nothing and you returned with victory. May Sun bestow you with infinite light."
        [/message]
        [message]
            speaker=Atiros
            message= _ "Thank our legendary brothers from the Great Desert. This is Mehir, our rescuer!"
        [/message]
        [message]
            speaker=Anthi
            message= _ "Welcome in Kharos, Mehir, descendant of our fathers."
        [/message]
        [message]
            speaker=Mehir
            message= _ "So you are Anthi, The Highest Priest of Light. I can finally meet you."
        [/message]
        [message]
            speaker=Anthi
            message=_ "Yes. I ordered to find you. Sometimes fairy tales are true.

Please, enter our city."
        [/message]
        [message]
            speaker=Mehir
            message= _ "I’m honored, but first I must send someone to al-Kamija with a report about Rashti for the High Council."
        [/message]
    [/event]

    [event]
        name=die
        first_time_only=no
        [filter]
            side=2,3,4
        [/filter]
        [if]
            [have_unit]
                side=2,3,4
            [/have_unit]
            [else]
                [endlevel]
                    result=victory
                [/endlevel]
            [/else]
        [/if]
    [/event]

    {SUMMONER_UNLOCK}
    {ITEM_APPLIER}
    {COLLAR_EVENT}
    {DEATH_MEHIR}
    {DEATH_RASHTI}
    {DEATH_ATIROS}
    {DEATH_DEDYLOS}
    {I8M16_TERRAIN}
[/scenario]
