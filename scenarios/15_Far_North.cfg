#textdomain wesnoth-To_Lands_Unknown
[scenario]
    id=14_Far_North
    next_scenario=15_Gates_of_Kharos
#    name= _  "Far North"
    name= _  "Defense of Saffaros"
    map_data="{~add-ons/To_Lands_Unknown/maps/15_Far_North.map}"
    turns=39
    {TURNS 42 38 34}
    victory_when_enemies_defeated=no
	current_time=5

    {DEFAULT_SCHEDULE}
    {SCENARIO_MUSIC heroes_rite.ogg}

    {STORYTXT_FAR_NORTH}

    [event]
        name=start
        [message]
            speaker=narrator
            image=halo/jinn-circle2.png
            message= _ "This scenario has visual and audio effects that may cause noticeable slowdown on weaker devices.

Note that you can toggle these effects at any time during the scenario by using the relevant options in the context menu."
            [option]
                message= _ "Load rain"
                [command]
                    [replace_schedule]
                        {DEFAULT_SCHEDULE_RAIN}
                    [/replace_schedule]
                [/command]
            [/option]
            [option]
                message= _ "Continue without rain"
                [command]
                [/command]
            [/option]
        [/message]
        [message]
            speaker=narrator
            image=halo/jinn-circle2.png
#            message= _ "You can always turn on/off some weather effects. To do that, right-click anywhere on the map and choose which effects you want to disable/enable."
            message= _ "You can always toggle this scenario's weather effects. To do that, right-click anywhere on the map and choose which effects you want to enable/disable."
        [/message]
    [/event]

    [side]
        side=1
        controller=human
        team_name=mehirteam
        user_team_name= _ "team_name^Mehir"

        type=TLU_Grand_Summoner
        id=Mehir
        name= _ "Mehir"
        unrenamable=yes
        canrecruit=yes

        recruit=EoMa_Novice_Summoner,EoMa_Camel_Rider,EoMa_Carpet_Rider,EoMa_Water_Elemental,EoMa_Summoner,EoMa_Rhami,EoMa_Fire_Elemental,EoMa_Dispeller

        {GOLD 900 760 510}
        {INCOME 30 25 20}
    [/side]

    [side]
        side=2
        controller=ai
        team_name=mehirteam
#        user_team_name= _ "team_name^Kharos"
        user_team_name= _ "team_name^Kharosians"

        type=EoMa_Platinum_Warrior
        id=Dedylos
        name= _ "Dedylos"
        unrenamable=yes
        canrecruit=yes
        color=white
		image_icon="portraits/kharos/platinum-warrior.png~CROP(130,10,150,150)~SCALE(72,72)~FL(horiz)"

        recruit=EoMa_White_Warrior,EoMa_Protector,EoMa_Brown_Warrior,EoMa_Shielder,EoMa_Cavalry_Archer,EoMa_Sun_Follower

        [ai]
            #aggression=0.2
			#caution=0.5
            #grouping=defensive
            #passive_leader=yes
            #passive_leader_shares_keep=yes
            support_villages=yes
        [/ai]
        {GOLD 400 300 200}
        {INCOME 8 5 2}
    [/side]

    [side]
        side=3
        controller=ai
        team_name=tharis
        user_team_name= _ "team_name^Hydras"
        no_leader=yes
        color=black
	hidden=yes#revealed when a hydra actually appears

        [ai]
            aggression=0.9
        [/ai]
    [/side]

    [side]
        side=4
        controller=ai
        team_name=tharis
        user_team_name= _ "team_name^Invaders"
        no_leader=yes
        color=purple
        {FLAG_VARIANT undead}

        recruit=EoMa_Disciple,EoMa_Witch,EoMa_Dark_Warrior,EoMa_Hydra,EoMa_Dark_Hunter,EoMa_Black_Orb,EoMa_Dark_Observer,EoMa_Bladedancer,EoMa_Dark_Wizard,EoMa_Great_Witch,EoMa_Commander,EoMa_Dark_Slayer,EoMa_Raging_Hydra,EoMa_Great_Hunter,EoMa_Dark_Assassin,EoMa_Sworddancer

        [ai]
            aggression=0.8
        [/ai]

        {GOLD 580 700 800}
        {INCOME -2 1 3}
    [/side]

    {STARTING_VILLAGES_ALL 2}

    [event]
        name=prestart
        {MODIFY_UNIT id=Mehir facing nw}
        [hide_unit]
            id=Mehir
        [/hide_unit]
        [hide_unit]
            id=Dedylos
        [/hide_unit]
        {UNIT 1 (Transport Galleon) 34 54 (id=boat1
        facing=ne)}
        {UNIT 1 (Transport Galleon) 30 55 (id=boat2
        facing=ne)}
        {UNIT 1 (Transport Galleon) 34 55 (id=boat3
        facing=ne)}

        #landing

        [kill]
            id=Banisher
            animate=no
        [/kill]
	{SET_LABEL 6 3 "Outskirts of Degos"}
        {VARIABLE turn_hydras 99}
        {VARIABLE rain_sound 1}
        {VARIABLE lightnings 1}
        [sound_source]
            id=flames
            sounds=ambient/campfire.ogg
            delay=9000
            chance=100
            check_fogged=no
            check_shrouded=no
            x,y=6,3
            full_range=5
            fade_range=3
            loop=0
        [/sound_source]
#define FLAMES X Y
        [item]
          x,y={X},{Y}
          halo=scenery/flames[01~15].png:50
        [/item]
#enddef
#define NOFLAMES X Y
        [remove_item]
          x,y={X},{Y}
        [/remove_item]
#enddef
        {FLAMES 11 4}
        {FLAMES 10 5}
        {FLAMES 9 6}
        {FLAMES 10 2}
        {FLAMES 3 1}
        {FLAMES 1 3}
        {FLAMES 3 8}
        {FLAMES 1 5}
        {FLAMES 12 7}
        {FLAMES 7 1}
        {FLAMES 3 7}
        {FLAMES 2 8}
        {FLAMES 9 3}

        ##
        [set_menu_item]
            id=control_rain_sound
            description= _ "Toggle Rain Sound Effects"

            [command]
                [if]
                    [variable]
                        name=rain_sound
                        equals=1
                    [/variable]
                    [then]
                        {VARIABLE rain_sound 0}
                        [remove_sound_source]
                            id=rain
                        [/remove_sound_source]
                    [/then]
                    [else]
                        {VARIABLE rain_sound 1}
                        [sound_source]
                            id=rain
                            x,y=30,30
                            sounds="rain.wav"
                            delay=0
                            chance=100
                            full_range=35
                            loop=-1
                        [/sound_source]
                    [/else]
                [/if]
            [/command]
        [/set_menu_item]

        [set_menu_item]
            id=control_rain
            description= _ "Toggle Rain Visual Effects"

            [command]
                [store_time_of_day]
                [/store_time_of_day]
                [switch]
                    variable=time_of_day.id
                    [case]
                        value=dawn_rain
                        [replace_schedule]
                            {DEFAULT_SCHEDULE}
							current_time=0
                        [/replace_schedule]
                    [/case]
                    [case]
                        value=dawn
                        [replace_schedule]
                            {DEFAULT_SCHEDULE_RAIN}
							current_time=0
                        [/replace_schedule]
                    [/case]
					[case]
                        value=morning_rain
                        [replace_schedule]
                            {DEFAULT_SCHEDULE}
							current_time=1
                        [/replace_schedule]
                    [/case]
                    [case]
                        value=morning
                        [replace_schedule]
                            {DEFAULT_SCHEDULE_RAIN}
							current_time=1
                        [/replace_schedule]
                    [/case]
					[case]
                        value=afternoon_rain
                        [replace_schedule]
							current_time=2
                            {DEFAULT_SCHEDULE}
                        [/replace_schedule]
                    [/case]
                    [case]
                        value=afternoon
                        [replace_schedule]
							current_time=2
                            {DEFAULT_SCHEDULE_RAIN}
                        [/replace_schedule]
                    [/case]
					[case]
                        value=dusk_rain
                        [replace_schedule]
							current_time=3
                            {DEFAULT_SCHEDULE}
                        [/replace_schedule]
                    [/case]
                    [case]
                        value=dusk
                        [replace_schedule]
							current_time=3
                            {DEFAULT_SCHEDULE_RAIN}
                        [/replace_schedule]
                    [/case]
					[case]
                        value=first_watch_rain
                        [replace_schedule]
							current_time=4
                            {DEFAULT_SCHEDULE}
                        [/replace_schedule]
                    [/case]
                    [case]
                        value=first_watch
                        [replace_schedule]
							current_time=4
                            {DEFAULT_SCHEDULE_RAIN}
                        [/replace_schedule]
                    [/case]
					[case]
                        value=second_watch_rain
                        [replace_schedule]
							current_time=5
                            {DEFAULT_SCHEDULE}
                        [/replace_schedule]
                    [/case]
					[case]
                        value=second_watch
                        [replace_schedule]
							current_time=5
                            {DEFAULT_SCHEDULE_RAIN}
                        [/replace_schedule]
                    [/case]
                [/switch]
                {CLEAR_VARIABLE time_of_day}
            [/command]
        [/set_menu_item]
    [/event]

    [event]
        name=turn 1
        {MOVE_UNIT id=boat1 39 52}
        {MOVE_UNIT id=boat2 37 53}
        {MOVE_UNIT id=boat3 39 54}
        [message]
            speaker=narrator
            caption="Atiros"
            image="portraits/kharos/masterofsun.png"
            message= _ "These are the shores of my land! Finally, we are here!"
        [/message]
        [message]
            speaker=narrator
            caption=_ "Mehir"
            image="portraits/mehir-leader.png"
#            message= _ "What a warm welcome for a return after a thousand years..."
            message= _ "My, my, the climate here is certainly fascinateing..."
        [/message]
        [message]
            speaker=narrator
            caption="Atiros"
            image="portraits/kharos/masterofsun.png"
#            message= _ "Pardon, Mehir, but we are on the border of two different climates; storms are a common phenomenon here."
            message= _ "Yeah... you desert dwellers musst be struck by all the water around you. We are on the border of two different climates, heavy rainfall is commonplace here during the wet season. The greenery must be an odd sight to you."
        [/message]
        [message]
            speaker=narrator
            caption=_ "Mehir"
            image="portraits/mehir-leader.png"
#            message= _ "It’s the first time I have seen water falling from the sky. Something like that could be very useful in our desert."
            message= _ "There you're mistaken, I've battled my way through jungle already! But it’s the first time I have seen water falling from the sky without magical influence. When I get back home, I'll have water elementals show my deputy how you people bathe, hehe."
        [/message]
        [message]
            speaker=narrator
            caption="Atiros"
            image="portraits/kharos/masterofsun.png"
#            message= _ "North from here, there’s a town called Saffaros, or at least there was when I left this land. Let’s not waste time."
            message= _ "North from here, there’s a town called Saffaros, or at least there was when I left this land. I hope it's not ruins yet."
        [/message]

        {MOVE_UNIT id=boat1 41 44}
        {MOVE_UNIT id=boat2  40 45}
        {MOVE_UNIT id=boat3 43 46}

        {MOVE_UNIT id=boat1 43 42}
        {MOVE_UNIT id=boat2  42 38}
        {MOVE_UNIT id=boat3 46 37}

        {UNIT 2 (EoMa_White_Warrior) 33 32 (id=boy
        facing=se)}

        [message]
            id=boy
            message= _ "Huh?"
        [/message]

        {MOVE_UNIT x,y=33,32 36 33}

        [message]
            id=boy
            message= _ "Sh... ships?! SHIPS!!! SHIPS COMING FROM THE SOUTH!!!"
        [/message]

        [unhide_unit]
            id=Dedylos
        [/unhide_unit]
        [message]
            speaker=Dedylos
#            message= _ "What?! There is only a dead desert south of here! This must be the enemy trying to go around the eastern defensive lines! Prepare troops! NOW!"
            message= _ "What?! There's only a dead desert south of here! This must be the enemy trying to flank us! Prepare the troops! NOW!"
        [/message]

        {MOVE_UNIT id=boy 33 32}

        {UNIT 2 (EoMa_Brown_Warrior) 28 31 (id=boy
        facing=se)}
        {UNIT 2 (EoMa_Brown_Warrior) 30 30 (id=boy
        facing=se)}
        {UNIT 2 (EoMa_Brown_Warrior) 30 28 (id=boy
        facing=se)}

        {MOVE_UNIT x,y=28,31 34 31}
        {MOVE_UNIT x,y=30,30 36 30}
        {MOVE_UNIT x,y=30,28 37 30}
        {MOVE_UNIT id=Dedylos 35 31}

        {MOVE_UNIT id=boat1 39 33}
        {MOVE_UNIT id=boat2  39 35}
        {MOVE_UNIT id=boat3 43 33}

        {UNIT 1 (EoMa_Master_of_Sun) 38 32 (id=Atiros
        image_icon="portraits/kharos/masterofsun.png~CROP(180,50,130,130)~SCALE(72,72)"
        {IS_HERO}
		upkeep=loyal
        name=Atiros)}

        {MOVE_UNIT id=Atiros 37 32}

        [message]
            speaker=Atiros
#            message= _ "Hello, Dedylos!"
            message= _ "Hello, Dedylos! I see you're still standing your ground! What's with the drawn swords, though? I though you'd be glad to see your old pal in one piece!"
        [/message]
        [message]
            speaker=Dedylos
#            message= _ "Atiros? Is that you? Thank the Sun, you’re still alive! But who are those people behind you? Don’t tell me they’re..."
            message= _ "*clears eyes* Atiros? Is that you? Thank the Sun, you’re still alive! But who are those people behind you? Don’t tell me they’re..."
        [/message]
        {TELEPORT_UNIT id=Mehir 38 32}
        [unhide_unit]
            id=Mehir
        [/unhide_unit]
        [message]
            speaker=Atiros
#            message= _ "Our legendary siblings truly exist and have just arrived. Please, meet Mehir, the leader of the Summoners from Tar-Tabar. He was the only one who decided to help us in our plight."
            message= _ "Get this, our legendary siblings do exist! They call themselves Summoners, 'cause they can conjure demons or some such up. Can you believes that?! Meet Mehir, a master of this kind of magic, city leader, and the ambassador of our antecendents' descendants."
        [/message]
        [message]
            speaker=Dedylos
#            message= _ "Welcome, stranger. We thought you were the invaders. Your help is a matter of life and death; we can’t defeat them alone."
            message= _ "By the Sun! I'd have brought out the red carpet, if only I hadn't at first mistaken you for the invaders. You are welcome and much needed here, kinsman! Those damned spawns of darkness have destroyed most of our cities already!"
        [/message]
        [message]
            speaker=Mehir
#            message= _ "Well met, Dedylos. As it happened, I have fought this enemy before, and I have valuable experience which may be very useful to us all."
            message= _ "Actually, I just wanted to drop off an invitation letter, but I might as well throw in my help and valuable experience. It just so happens that I have fought this enemy of yours already, AND emerged victorious."
        [/message]
        [message]
            speaker=Dedylos
#            message= _ "That’s great. We were looking for someone like you. I will send a messenger to Kharos to announce the amazing news, and in the meantime, I invite you to my castle, where we should discuss our next steps."
            message= _ "You don't say. Tell me more about it! Come in, let's get out of the rain, have a rest in my castle. In the meantime, I'll send a messenger to announce the wonderful news to Anthi."
        [/message]

        {FADE_TO_BLACK}
        {TELEPORT_UNIT id=Dedylos 28 29}
        [kill]
            type=Transport Galleon
            animate=no
        [/kill]
        [kill]
            side=2
            [not]
                id=Dedylos
            [/not]
        [/kill]
        {PLACE_IMAGE "units/transport/transport-galleon.png~RC(magenta>red)" 37 34}
        {PLACE_IMAGE "units/transport/transport-galleon.png~RC(magenta>red)" 39 33}
        {PLACE_IMAGE "units/transport/transport-galleon.png~RC(magenta>red)" 41 32}

        {TELEPORT_UNIT id=Mehir 28 28}
        {TELEPORT_UNIT id=Atiros 27 28}

        [store_unit]
            [filter]
                type=TLU_Grand_Summoner_lock
                x,y=recall,recall
            [/filter]
            variable=landing
        [/store_unit]
        {FOREACH landing i}
            {VARIABLE landing[$i].advances_to (EoMa_Summons_Master)}
            [unstore_unit]
                variable=landing[$i]
                find_vacant=no
            [/unstore_unit]
        {NEXT i}

        {CLEAR_VARIABLE landing}
        [recall]
            id=Rashti
        [/recall]
        {FADE_IN}
        [message]
            speaker=narrator
            image=halo/jinn-circle2.png
            message= _ "Two hours later..."
        [/message]
        [message]
            speaker=Dedylos
#            message= _ "The dark armies have captured all the cities of the middle-lands; we had to evacuate all of our citizens that live there, and now they’re behind the thick walls of Kharos. The only exception is Saffaros, for we hope to escape to the desert by its port if the capital falls."
            message= _ "The dark armies have captured all the cities of the middle-lands; we had to evacuate all of our citizens that lived there, and now the refugees are behind the thick walls of Kharos. The only exception is Saffaros, for we hope to escape to the desert by ship, in case the capital falls."
        [/message]
        [message]
            speaker=Atiros
#            message= _ "So only two cities remain..."
            message= _ "So only three cities remain..."
        [/message]

        {REPLACE_SCENARIO_MUSIC siege_of_laurelmor.ogg}
        {UNIT 2 (EoMa_Cavalry_Archer) 49 21 (id=Rider2
        generate_name=yes)}
        {MOVE_UNIT id=Rider2 44 27}
        [message]
            speaker=Rider2
#            message= _ "THEY’RE HERE!!! RUN!!!"
            message= _ "THEY’RE HERE!!! RUN!!!"
        [/message]
        [message]
            speaker=Dedylos
#            message= _ "But... how is it possible? They had to come from the north!"
            message= _ "But... how is it possible? The enemy had to come from the north!"
        [/message]
        {UNIT 2 (EoMa_Cavalry_Archer) 21 16 (id=Rider3
        generate_name=yes)}
        {MOVE_UNIT id=Rider3 22 18}
        [message]
            speaker=Rider3
            message= _ "Enemy on the horizon!!! They have seized Degos!!!"
        [/message]
        [message]
            speaker=Dedylos
            message= _ "Does it mean..."
        [/message]
        [message]
            speaker=Atiros
#            message= _ "And what about Kharos? Have they destroyed Kharos?"
            message= _ "And what about Kharos? Has it been besieged?"
        [/message]
        [message]
            speaker=Rider3
#            message= _ "No! Their main strike force is regrouping to the east!!!"
            message= _ "Not yet! Their main strike force is regrouping to the east!!!"
        [/message]
        [message]
            speaker=Dedylos
            message= _ "Thank the sun, for Kharos is untouched, for now. So they must be scouts. We must defend Saffaros. Mehir, will you help us?"
        [/message]
        [message]
            speaker=Mehir
            message= _ "You defend the town and I will try to prepare a counterattack."
        [/message]
        [message]
            speaker=narrator
            image=halo/jinn-circle2.png
            message= _ "Rain damages your fire elementals. Be careful. On the other hand it can heal your water elementals."
        [/message]
		[message]
            speaker=narrator
            image=halo/jinn-circle2.png
            message= _ "Atiros is now on your side, but he will leave your army after the next scenario. Keep this in mind."
        [/message]

        [message]
            speaker=narrator
            image=halo/jinn-circle2.png
            message= _ "If you find the upcoming battle too slow, you can increase game speed via settings."
        [/message]

        {UNIT 4 (EoMa_Great_Warlock) () () (placement=leader
        canrecruit=yes
		id=Warlock
        name="Amalrir"
        profile="portraits/tharis/greatwarlock.png"
        image_icon="portraits/tharis/greatwarlock.png~CROP(170,30,130,130)~SCALE(72,72)")}
        {CAPTURE_VILLAGES 4 6 3 8}
		
        {VARIABLE turn_hydras $turn_number}
        [objectives]
            side=1
            [objective]
                description= _ "Defeat all enemies"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Mehir"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Rashti"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Atiros"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Dedylos"
                condition=lose
            [/objective]

            [gold_carryover]
                bonus=no
                carryover_percentage=40
            [/gold_carryover]

            {TURNS_RUN_OUT}
	    note= _ "The hydras spawning from the swamp don't count towards victory."
        [/objectives]
		[modify_unit]
		  [filter]
		    id=Rider3
		  [/filter]
		  goto_x=28
		  goto_y=23
		[/modify_unit]
    [/event]
    [event]
		name=side 2 turn 2
		[modify_unit]
		  [filter]
		    id=Rider3
		  [/filter]
		  goto_x=19
		  goto_y=26
		[/modify_unit]
    [/event]
	[event]
		name=side 4 turn
		
		[message]
            speaker=Warlock
#            message= _ "The scouts were right. There is another town south of here, full of those miserable people. I love the way they scream - it is like a music to my ears..."
            message= _ "The scouts were correct - there is, indeed, another untouched town south of here, full of those miserable humans. I love the way they scream - it is like a music to my ears..."
        [/message]
		[message]
            speaker=Warlock
#            message= _ "I want this town to burn. I want to see them plead for mercy. I want to hear this music once again - the music of tearing their bodies apart!"
            message= _ "I want to see the town burn to ashes. I want to see them plead for mercy. I want to hear the true sounds of war, and witness its darkest colors!"
        [/message]
		[message]
            speaker=Warlock
#            message= _ "You know what to do, my wardogs. Prove me you are worthy of becoming the new Destroyers! When our Gods return, they will spare us and we will all become the eternal Death Lords. But now... KILL THEM ALL!"
            message= _ "You know what to do, my soldiers. Prove that you are worthy of becoming the new Destroyers! When our Gods return, they will spare us, and grant us power beyond what any mortal could ever dream of! But for now, all that matters is the body count! KILL THEM ALL, SHOW NOT A TRACE OF MERCY!!!"
        [/message]
	[/event]
	
    #ai_guardian event
    [event]
        name=side 2 turn
        first_time_only=no
        #[fire_event]
		#	name=guardians
        #[/fire_event]
    [/event]
	
	[event]
        name=guardians
        first_time_only=no
        [store_unit]
            [filter]
                side=2
                [not]
                    [filter_location]
                        terrain=C*,K*
                    [/filter_location]
                [/not]
            [/filter]
            variable=guards
        [/store_unit]
        {FOREACH guards i}
            {VARIABLE guards[$i].ai_special guardian}
            [unstore_unit]
                variable=guards[$i]
                find_vacant=no
            [/unstore_unit]
        {NEXT i}
    [/event]

    #Hydra waves event
    [event]
        name=side 3 turn
        first_time_only=no
        [if]
            [variable]
                name=turn_number
                less_than_equal_to=12
            [/variable]
            [and]
                [variable]
                    name=turn_number
                    greater_than_equal_to=$turn_hydras
                [/variable]
            [/and]
            [then]
                {RANDOM 0..1}
                {REPEAT $random (
                    {UNIT 3 (EoMa_Chaos_Hydra) 48 14 ()}
                )}
                {RANDOM 0..1}
                {REPEAT $random (
                    {UNIT 3 (EoMa_Raging_Hydra) 48 14 ()}
                )}
                {RANDOM 0..3}
                {REPEAT $random (
                    {UNIT 3 (EoMa_Hydra) 48 14 ()}
                )}
		[modify_side]
		   side=3
		   hidden=no
		[/modify_side]
            [/then]
        [/if]
    [/event]

    [event]
        name=attack
        [filter_second]
            type=EoMa_Hydra,EoMa_Raging_Hydra,EoMa_Chaos_Hydra
            side=3
        [/filter_second]
        [message]
            speaker=Dedylos
#            message= _ "These monsters seem to rise to the surface in that swamp. I hope there won’t be too many of them or we will never make it."
            message= _ "May the Sun have mercy! These creeping monsters are emerging from the swamp! Believe me, these abominations are not native to our land! Oh Mehir, do something! Otherwise we won't live long enough to see the sun rise again..."
        [/message]
    [/event]

    #jinns and the castle
    [event]
        name=recruit,recall

        [filter]
            side=1
        [/filter]

        [message]
            speaker=Mehir
#            message= _ "The keep is too small. I wonder, if I had three jinns placed between empty spaces, they could transform themselves and create a new, larger keep for me and strengthen the city walls..."
            message= _ "The keep is too small. I wonder, if I had three jinns placed on the keeps of outer walls, they could tranform themselves, connect the loose forts, strengthening the city walls..."
        [/message]
        [message]
            speaker=Mehir
#            message= _ "I would lose them, but this can be worth it."
            message= _ "It would mean their sacrifice, but this can be worth it."
        [/message]
        {HIGHLIGHT_IMAGE 23 27 "items/gohere.png" ()}
        {HIGHLIGHT_IMAGE 33 27 "items/gohere.png" ()}
        {HIGHLIGHT_IMAGE 28 24 "items/gohere.png" ()}
    [/event]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            type=EoMa_Jinn
        [/filter]

        [allow_undo]
        [/allow_undo]

        [if]
            [have_unit]
                type=EoMa_Jinn
                x,y=23,27
            [/have_unit]
            [and]
                [have_unit]
                    type=EoMa_Jinn
                    x,y=33,27
                [/have_unit]
            [/and]
            [and]
                [have_unit]
                    type=EoMa_Jinn
                    x,y=28,24
                [/have_unit]
            [/and]
            [then]
                [fire_event]
                    name=jinn_event
                [/fire_event]
            [/then]
        [/if]
    [/event]

    [event]
        name=jinn_event
        first_time_only=yes
        [message]
            speaker=Mehir
            message= _ "Jinns, I order you to create a new keep in this town!"
        [/message]
        [message]
            x,y=28,24
            message= _ "As you wish, Master."
        [/message]
        {FLASH_BLUE (
            {SCROLL_TO 28 29}
	    [sound]
	        name=magic-faeriefire.ogg
	    [/sound]
            {MODIFY_TERRAIN Cd (25,26,30,31,25,28,31,25,28,31) (26,25,25,26,28,26,28,31,32,31)}
	    [sound]
	        name=magic-faeriefire.ogg
	    [/sound]
            {MODIFY_TERRAIN Kd (28) (24)}
            [kill]
                x=23,33,28
                y=27,27,24
            [/kill]
            {REMOVE_IMAGE 23 27}
            {REMOVE_IMAGE 33 27}
            {REMOVE_IMAGE 28 24}
        )}
        [redraw]
        [/redraw]
        [message]
            speaker=Dedylos
#            message= _ "Amazing!"
            message= _ "Amazing! Southern architecture, never seen before in these parts... I do hope it's rain-proof, though."
        [/message]
    [/event]

    #Rashti
    [event]
        name=attack

        [filter]
            id=Rashti
        [/filter]
        [filter_second]
            side=3,4
        [/filter_second]

        [message]
            speaker=Rashti
            image="portraits/rashti-ho.png"
#            message= _ "The Dark People. I want to see..."
            message= _ "Spawns of darkness, I want to see..."
        [/message]
        [message]
            speaker=Rashti
            image="portraits/rashti-dharma.png"
            message= _ "...WHAT YOU ARE MADE OF!!!"
        [/message]
    [/event]

    [event]
        name=attack end

        [filter]
            id=Rashti
        [/filter]
        [filter_second]
            side=3,4
        [/filter_second]

        [message]
            speaker=Dedylos
#            message= _ "Who is she?!"
            message= _ "Eh? What's wrong with your companioness? Has she been sun-struck in the desert?"
        [/message]
        [message]
            speaker=Mehir
#            message= _ "This is Rashti’rhami, the queen of the Abyss and one of the Ultimate Beings. Her dual nature can be a real trouble sometimes..."
            message= _ "Nah, Rashti is an example of ultimate ambivalence. Two for one, you know. Her dual nature can be a real pain sometimes..."
        [/message]
    [/event]

    [event]
        name=die

        [filter]
            side=3,4
        [/filter]
        [filter_second]
            id=Rashti
        [/filter_second]

        [message]
            speaker=Rashti
            image="portraits/rashti-dharma.png"
#            message= _ "I NEED MORE!!! Reminds me of the last time when I wanted to RIP YOUR THROAT OUT, MEHIR!!!"
            message= _ "I NEED MORE!!! Reminds me of the last time I wanted to RIP YOUR THROAT OUT, MEHIR!!!"
        [/message]
        [message]
            speaker=Dedylos
            message= _ "WHAT?!"
        [/message]
        [message]
            speaker=Rashti
            image="portraits/rashti-ho.png"
#            message= _ "I am extremely sorry, my Master! It is her! Control yourself, stupid!"
            message= _ "I am extremely sorry, my Master! It is her! *to her other half* Control yourself, stupid!"
        [/message]
        [message]
            speaker=Dedylos
#            message= _ "What’s going on?"
            message= _ "By the Sun! What is wrong with her?!"
        [/message]
        [message]
            speaker=Mehir
#            message= _ "Don’t pay attention to what she says. She’s quite... unstable at times..."
            message= _ "Don’t pay attention to what she says. She can be quite... unstable at times..."
        [/message]
    [/event]
	
	[event]
        name=moveto
        [filter]
            side=1
			[filter_location]
				x,y=11,10
				radius=8
			[/filter_location]
		[/filter]
			
		[message]
			speaker=Warlock
			message= _ "So they have managed to break through our offensive force."
		[/message]
		[message]
			speaker=Warlock
#			message= _ "The Three Sisters were ordered to slay them, but did not return - this means that they failed their task. Our master Almathis has finally found a formidable foe..."
			message= _ "So the Three Sisters failed the task of slaying these desert mages... It appears our master Almathis has finally found a formidable foe..."
		[/message]
		[gold]
			side=4
			{QUANTITY amount 100 150 200}
		[/gold]
	[/event]
	
	[event]
        name=last breath
        [filter]
			id=Warlock
        [/filter]
		
		[message]
			speaker=Warlock
#			message= _ "So this is the day of my end... but I am not afraid of death. We've lost here, but when our Gods return, the ocean will become quiet, and instead of water, it will be filled with blood..."
			message= _ "My death is but a drop in a bucket. Once our Gods return, there will be oceans of blood and mountains of bodies, with the moon turned blood-red..."
		[/message]
	[/event]

    #victory condition
    [event]
        name=die
        first_time_only=no
        [filter]
            side=3,4
        [/filter]

        [if]
            [have_unit]
                side=3,4
            [/have_unit]
            [else]
                [fire_event]
                    name=victory_dialogue
                [/fire_event]
            [/else]
        [/if]
    [/event]

    [event]
        name=victory_dialogue
        [message]
            speaker=Dedylos
#            message= _ "We did it! It’s the first time we have defeated them!!! Thank you, Mehir!"
            message= _ "We did it! I... it's just great knowing that those spawns of darkness can actually be defeated. My utmost gratitude to you, Mehir!"
        [/message]
        [message]
            speaker=Mehir
#            message= _ "I’m not surprised at all that your country is falling."
            message= _ "I’m not surprised at all that your army is failing spectacularly against the invaders."
        [/message]
        [message]
            speaker=Dedylos
#            message= _ "Why do you think so?"
            message= _ "Do you mean that as an insult?"
        [/message]
        [message]
            speaker=Mehir
#            message= _ "Your armies consist of humans, who are very easy to kill. We, contrariwise, mainly use beings from the Abyss, which cannot be poisoned or eaten, which seem to be the favorite tactics of your enemies. You’re lucky I’ve decided to help you."
            message= _ "Your armies consist entirely of humans, who are quite susceptible to being poisoned or eaten. We, contrariwise, mainly use abyssal beings, which are immune to those methods, which your enemies seem to favor. You’re lucky I arrived in time to help you."
        [/message]

        [endlevel]
            result=victory
            carryover_report=yes
            {NEW_GOLD_CARRYOVER 100}
            bonus=no
        [/endlevel]
    [/event]

    [event]
        name=victory
        {CLEAR_VARIABLE rain_sound}
        {CLEAR_VARIABLE lightnings}
		
		#dedylos troops to recall
		[heal_unit]
			side=2
		[/heal_unit]
		{PUT_TO_RECALL_LIST (side=2
		[not]
			id=Dedylos
		[/not])}
        # Make weather menus go away
        [set_menu_item]
            id=control_lightning
            [show_if]
                [not][/not]
            [/show_if]
        [/set_menu_item]
        [set_menu_item]
            id=control_rain
            [show_if]
                [not][/not]
            [/show_if]
        [/set_menu_item]
        [set_menu_item]
            id=control_rain_sound
            [show_if]
                [not][/not]
            [/show_if]
        [/set_menu_item]
    [/event]
    #weather
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
        [/filter]
        [allow_undo]
        [/allow_undo]
        #[fire_event]
		#	name=thunders
        #[/fire_event]
    [/event]
	
	[event]
		name=thunders
		first_time_only=no
		
		[if]
            [variable]
                name=lightnings
                equals=1
            [/variable]
            [then]
                {RANDOM 1..20}
                [switch]
                    variable=random
                    [case]
                        value=1
                        {COLOR_ADJUST 66 66 66}
                        {COLOR_ADJUST 0 0 0}
                        [sound]
                            name="thunder1.wav"
                        [/sound]
                    [/case]
                    [case]
                        value=2
                        {COLOR_ADJUST 33 33 33}
                        {COLOR_ADJUST 0 0 0}
                        {COLOR_ADJUST 33 33 33}
                        {COLOR_ADJUST 0 0 0}
                        [sound]
                            name="thunder2.wav"
                        [/sound]
                    [/case]
                    [case]
                        value=3
                        {COLOR_ADJUST 33 33 33}
                        {COLOR_ADJUST 0 0 0}
                        [sound]
                            name="thunder3.wav"
                        [/sound]
                    [/case]
                    [case]
                        value=4
                        {COLOR_ADJUST 100 100 100}
                        {COLOR_ADJUST 33 33 33}
                        {COLOR_ADJUST 0 0 0}
                        {COLOR_ADJUST 66 66 66}
                        {COLOR_ADJUST 0 0 0}
                        [sound]
                            name="thunder1.wav"
                        [/sound]
                    [/case]
                    [case]
                        value=5
                        {COLOR_ADJUST 100 100 100}
                        {COLOR_ADJUST 0 0 0}
                        [sound]
                            name="thunder2.wav"
                        [/sound]
                    [/case]
                [/switch]
                {COLOR_ADJUST 0 0 0}
            [/then]
        [/if]
	[/event]

    [sound_source]
        id=rain
        x,y=28,29
        sounds="rain.wav"
        delay=0
        chance=100
        full_range=35
        loop=-1
    [/sound_source]

    #weather and elementals
    [event]
        name=side 1 turn refresh
        first_time_only=no

        #fire
        [store_unit]
            [filter]
                type=EoMa_Fire_Elemental,EoMa_Fire_Avatar,EoMa_Fire_God
                [not]
                    x,y=recall,recall
                [/not]
            [/filter]
            variable=fire
        [/store_unit]
        {FOREACH fire i}
            {VARIABLE_OP fire[$i].hitpoints sub 5}
            [if]
                [variable]
                    name=fire[$i].hitpoints
                    less_than_equal_to=0
                [/variable]
                [then]
                    [kill]
                        x,y=$fire[$i].x,$fire[$i].y
                        animate=yes
			fire_event=yes
                    [/kill]
                [/then]
                [else]
                    [unstore_unit]
                        variable=fire[$i]
                        find_vacant=no
                        text= _ "5"
                        {COLOR_HARM}
                    [/unstore_unit]
                [/else]
            [/if]
        {NEXT i}
        {CLEAR_VARIABLE fire}

        #water
        [store_unit]
            [filter]
                type=EoMa_Water_Elemental,EoMa_Water_Avatar,EoMa_Water_God
                [not]
                    x,y=recall,recall
                [/not]
            [/filter]
            variable=water
        [/store_unit]
        {FOREACH water i}
            [heal_unit]
                [filter]
                    id=$water[$i].id
                [/filter]
                animate=yes
                amount=3
            [/heal_unit]
        {NEXT i}
        {CLEAR_VARIABLE water}
    [/event]

    [event]
        name=turn 3
    [modify_side]
        side=4
        {INCOME 2 5 10}
    [/modify_side]

        {MODIFY_TERRAIN Hh 11 4}
        {MODIFY_TERRAIN Ss 10 5}
        {MODIFY_TERRAIN Ss 9 6}
        {MODIFY_TERRAIN Gs 10 2}
        {MODIFY_TERRAIN Gs 3 1}
        {MODIFY_TERRAIN Gs 1 3}
        {MODIFY_TERRAIN Gs 3 8}
        {MODIFY_TERRAIN Gs 1 5}
        {MODIFY_TERRAIN Gs 12 7}
        {MODIFY_TERRAIN Gs 7 1}
        {MODIFY_TERRAIN Gll^Fdw 3 7}
        {MODIFY_TERRAIN Gll^Fdw 2 8}
        {MODIFY_TERRAIN Gll^Fdw 9 3}

        {PLACE_IMAGE "scenery/trash.png" 11 4}
        {PLACE_IMAGE "scenery/trash.png" 10 5}
        {PLACE_IMAGE "scenery/trash.png" 9 6}
        {PLACE_IMAGE "scenery/village-human-burned1.png" 10 2}
        {PLACE_IMAGE "scenery/village-human-burned2.png" 3 1}
        {PLACE_IMAGE "scenery/trash.png" 1 3}
        {PLACE_IMAGE "scenery/village-human-burned1.png" 3 8}
        {PLACE_IMAGE "scenery/trash.png" 1 5}
        {PLACE_IMAGE "scenery/trash.png" 12 7}
        {PLACE_IMAGE "scenery/trash.png" 7 1}
    [/event]
    [event]
        name=turn 7
        {NOFLAMES 11 4}
        {NOFLAMES 10 5}
        {NOFLAMES 9 6}
        {NOFLAMES 10 2}
        {NOFLAMES 3 1}
        {NOFLAMES 1 3}
        {NOFLAMES 3 8}
        {NOFLAMES 1 5}
        {NOFLAMES 12 7}
        {NOFLAMES 7 1}
        {NOFLAMES 3 7}
        {NOFLAMES 2 8}
        {NOFLAMES 9 3}
        [remove_sound_source]
            id=flames
        [/remove_sound_source]
        {PLACE_IMAGE "scenery/trash.png" 11 4}
        {PLACE_IMAGE "scenery/trash.png" 10 5}
        {PLACE_IMAGE "scenery/trash.png" 9 6}
        {PLACE_IMAGE "scenery/village-human-burned1.png" 10 2}
        {PLACE_IMAGE "scenery/village-human-burned2.png" 3 1}
        {PLACE_IMAGE "scenery/trash.png" 1 3}
        {PLACE_IMAGE "scenery/village-human-burned1.png" 3 8}
        {PLACE_IMAGE "scenery/trash.png" 1 5}
        {PLACE_IMAGE "scenery/trash.png" 12 7}
        {PLACE_IMAGE "scenery/trash.png" 7 1}
    [/event]

    [event]
       name=turn 2
       {BADASS_MODE_CHANGE (
       {SCROLL_TO 28 20}
       {ANIMHACK joke_wyverndrop 28 20 se}
       {PLACE_IMAGE "items/box.png" 28 20}
       {SCROLL_TO 31 21}
       {ANIMHACK joke_wyverndrop 31 21 se}
       {PLACE_IMAGE "items/box.png" 31 21}
       {SCROLL_TO 25 23}
       {ANIMHACK joke_wyverndrop 25 23 se}
       {PLACE_IMAGE "items/box.png" 25 23}
       {VARIABLE box_placed yes}
        [message]
            speaker=Rashti
	    image="portraits/rashti-dharma.png"
            message= _ "Ugh, Mehir, did you sign up for some online delivery service AGAIN?!!"
        [/message]
        [message]
            speaker=Mehir
            message= _ "Wyvern Mail: have stuff delivered to you by wyvern, anywhere, anytime.

P.S. sponsored by Wyvern Mail(TM)."
        [/message]
        [message]
            speaker=Rashti
            message= _ "So, what exactly did you order?"
        [/message]
        [message]
            speaker=Mehir
            message= _ "Oh, nothing much, a couple dozen video games, a new console for Jaffar, and a miniature golden statue of myself. You know, the really important stuff."
        [/message]
        [message]
            speaker=Rashti
            message= _ "*sigh* what a great way to spend taxpayer money..."
        [/message]

) ()}
    [/event]

    [event]
       name=moveto
       first_time_only=no
       [filter]
          side=1
	  x=28,31,25
	  y=20,21,23
       [/filter]
       {IF_VAR box_placed equals yes (
       [then]
        [message]
            speaker=Rashti
            message= _ "I think it would be a better idea to open the boxes AFTER the battle is over."
        [/message]
       [/then]
       )}
    [/event]

    [event]
       name=turn 5
       {BADASS_MODE_CHANGE (
        {UNIT 2 (EoMa_Mastermage) 2 1 (id,animate,name=speaker1,no,"???")}
        {UNIT 2 (EoMa_Elementalist) 5 2 (id,animate,name=speaker2,no,"???")}
        [message]
            speaker=speaker1
            message= _ "Passpartout, we're going around the world!"
        [/message]
        [message]
            speaker=speaker2
            message= _ "But monsieur, we've only got eighty days!"
        [/message]
        [message]
            speaker=speaker1
            message= _ "I made a wager of twenty thousand pounds, and I don't intend to lose it. Anyway, our means of transportation should arrive soon, make sure you packed everything."
        [/message]
	[delay]
	   time=3000
	[/delay]
        {UNIT 2 (EoMa_Wyvern_Rider) 1 1 (id,animate,name=wyvern,yes,"Driver")}
        [message]
            speaker=wyvern
            message= _ "Rhaaa! Xisss! Hassssss! Oh, and the trip costs 357 pounds."
        [/message]
        [message]
            speaker=speaker1
            message= _ "Excellent! Now, Passpartout, do me a favor and load our luggage into the cargo hold of our transport."
        [/message]
        [message]
            speaker=speaker2
            message= _ "I hope you're not referring to the wyvern's bottom, Monsieur..."
        [/message]
        [message]
            speaker=speaker1
            message= _ "Unfortunately for you, that's exactly what I meant."
        [/message]
        [message]
            speaker=speaker2
            message= _ "*sigh* As you wish, monsieur..."
        [/message]
        {MOVE_UNIT id=speaker2 1 2}
	[sound]
	   name={SOUND_LIST:GRYPHON_DIE}
        [/sound]
        [message]
            speaker=speaker1
            message= _ "To the Reform Club!"
        [/message]
	[kill]
	   type=EoMa_Mastermage,EoMa_Elementalist,EoMa_Wyvern_Rider
	   side=2
	   animate=no
	[/kill]) ()}
    [/event]


    {SUMMONER_UNLOCK}
    {ITEM_APPLIER}
    {COLLAR_EVENT}
    {DEATH_MEHIR}
    {DEATH_RASHTI}
    {DEATH_ATIROS}
    {DEATH_DEDYLOS}
    {I8M15_TERRAIN}
[/scenario]
