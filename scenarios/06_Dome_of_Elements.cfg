#textdomain wesnoth-To_Lands_Unknown
[scenario]
    id=06_Dome_of_Elements
    next_scenario=07_Ka-gatta

    name= _ "Dome of Elements"
    map_data="{~add-ons/To_Lands_Unknown/maps/06_Dome_of_Elements.map}"
    turns=-1
    victory_when_enemies_defeated=no

    {MORNING_TLU}

    {SCENARIO_MUSIC traveling_minstrels.ogg}

    {STORYTXT_DOME_OF_ELEMENTS}

    [side]
        side=1
        controller=human
        team_name=mehirteam
        user_team_name= _ "team_name^Mehir"

        type=EoMa_Summoner
        id=Mehir
        name= _ "Mehir"
        unrenamable=yes
        canrecruit=yes

        recruit=EoMa_Novice_Summoner,EoMa_Camel_Rider,EoMa_Carpet_Rider,EoMa_Water_Elemental

        gold=11
        income=-2
    [/side]

    [side]
        side=2
        controller=ai
        team_name=mehirteam
        user_team_name= _ "team_name^Instructor"
        color=green

		id=Instructor
        name= _ "Instructor"
		type=TLU_Elder
        unrenamable=yes
        canrecruit=yes

        recruit=

        gold=0
        income=0

        [ai]
        [/ai]
		
		#{UNIT 2 (EoMa_Earth_God) 11 8 (facing=sw)}
		#{UNIT 2 (EoMa_Earth_God) 15 8 (facing=se)}
		#{UNIT 2 (EoMa_Fire_God) 12 5 (facing=se)}
		#{UNIT 2 (EoMa_Fire_God) 14 5 (facing=sw)}
		#{UNIT 2 (EoMa_Air_God) 13 4 (facing=sw)}
		#{UNIT 2 (EoMa_Water_God) 10 8 (facing=sw)}
		#{UNIT 2 (EoMa_Water_God) 16 8 (facing=se)}
		
		{UNIT 2 (TLU_Elder) 20 9 (id,facing=elder,se)}
		{UNIT 2 (EoMa_Carpet_Master) 21 10 (facing=nw)}
		
		{UNIT 2 (TLU_Elder) 5 9 (facing=se)}
		{UNIT 2 (TLU_Elder) 6 9 (facing=se)}
		{UNIT 2 (EoMa_HoRhami) 7 9 (facing=sw)}		
    [/side]
	
	[side]
        side=3
        controller=ai
        team_name=enemy
        user_team_name= _ "team_name^Enemy"
        no_leader=yes
        color=black
		hidden=yes

        gold=0
        income=0

    [/side]

    [event]
        name=prestart
		
		[hide_unit]
			id=Instructor
		[/hide_unit]
		
		[store_unit]
			[filter]
				id=Mehir
			[/filter]
			variable=mehirvar
		[/store_unit]
		{MODIFY_UNIT id=Mehir moves $mehirvar.max_moves}
    [/event]

    [event]
        name=turn 1
        [message]
            speaker=Mehir
#            message= _ "So this is the famous Dome of Elements - the central shrine of Sud-Affar."
            message= _ "Well, well... the famous Dome of Elements. Brings back the memories of the time when I came here with my father as a kid... The central shrine of Sud-Affar seems even larger than how I remember it... A sublime place for the celebration of my promotion!"
        [/message]
		{MOVE_UNIT id=Mehir 13 10}
		[message]
            speaker=Mehir
#            message= _ "I remember visiting this place once, when I was a child. It looks even larger than before..."
            message= _ "Salam, elders! Where are all the other guests of honor?"
        [/message]
#2 new lines
	{MODIFY_UNIT id=elder facing sw}
        [message]
            speaker=elder
            message= _ "Haven't you heard? The celebration has been canceled. Pretty much everyone left for the circle's construction site, they all want to see the jungle creatures, the ones you recently befriended."
        [/message]
		[message]
            speaker=Mehir
            message= _ "Oh, I see... great... *sigh* Well, I guess I'll have to leave now..."
        [/message]
	{MODIFY_UNIT id=elder facing se}
		[unhide_unit]
			id=Instructor
		[/unhide_unit]
		{MOVE_UNIT id=Instructor 14 9}
		{MODIFY_UNIT id=Instructor facing sw}
		[message]
            speaker=Instructor
#            message= _ "Oh, excuse me, are you Mehir?"
            message= _ "Excuse me, Are you Mehir ibn Mehir the Elder, the one being promoted?"
        [/message]
		[message]
            speaker=Mehir
#            message= _ "Yes, and you are?"
            message= _ "That's right. Mehir, commander of the second degree, in person! And who might you be?"
        [/message]
		{MOVE_UNIT id=Instructor 14 9}
		{MODIFY_UNIT id=Instructor facing sw}
#		[message]
#            speaker=Instructor
#            message= _ "I am your new instructor. Because you were promoted to the rank of commander, you are authorized to own and use a lesser personal magical circle."
#            message= _ "Erm, no. The celebration has been cancelled. Pretty much everyone left for the circle's construction site, they all want to see the jungle creatures, the ones you recently befriended."
#        [/message]
#		[message]
#            speaker=Mehir
#			image="portraits/mehir-happy.png"
#            message= _ "Awesome! I've always wanted to have one!"
#            message= _ "Oh, I see... great... Well, I guess I can leave now."
#        [/message]
		[message]
            speaker=Instructor
#            message= _ "Usually there is a celebration during such occasions, but thanks to your pact with these jungle folks, almost all of our troops are headed to the circle's construction site. They want to see these strange beasts you encountered."
            message= _ "A circle usage instructor.  You see, with your new rank, you are entitled to the privilege of owning a lesser personal magic circle, the combat-oriented kind. I believe it's my responsibility to teach you how to use this prestigious object, and the things you need to keep in mind when doing so."
        [/message]
		[message]
            speaker=Mehir
#            message= _ "They are quite a sight. But some of them smell really bad..."
	    image="portraits/mehir-happy.png"
#            message= _ "Awesome! I've always wanted to have one!"
            message= _ "A personal circle?! Awesome! I've always dreamed of owning one!"
        [/message]
		[message]
            speaker=Instructor
            message= _ "Anyway... A beautiful place, this Dome of ours, isn't it? Here on the top of the column lies the Elemental Bird - one of the four ultimate beings and the most powerful elemental ever summoned."
        [/message]
		[message]
            speaker=Instructor
#            message= _ "It is sealed now in a small container, but I have seen it released two times in my old life. A perfect being composed of all basic elements. The flapping of its wings could devaste entire cities."
            message= _ "It's now sealed in a small container, but I have seen its release twice in my lifetime. A majestic being composed of all basic elements. The flapping of its wings could devastate entire cities..."
        [/message]
		[message]
            speaker=Instructor
#            message= _ "Sharif - our leader - owns this creature now. He released it only once to celebrate the beginning of our greatest endeavor - the Great Circle that is under construction on the desert."
            message= _ "Sharif - our leader - owns this creature now. He released it only once to celebrate the beginning of our greatest endeavor - the Great Circle's construction."
        [/message]
		[message]
            speaker=Mehir
#            message= _ "I remember that moment. At first I thought it was a second sun in the sky, then it turned into a gale, a waterfall and then dropped as a mountain to finally rise once again as all of these things mixed together."
            message= _ "I remember that moment. At first it seemed like a second sun in the sky, then it turned into a tornado, a waterfall and then dropped as a mountain to finally rise once again as a mix of all of the above..."
        [/message]
		[message]
            speaker=Instructor
#            message= _ "Yes. Only the ultimate beings are that powerful. Sud-Affar is the place of the Elemental Bird. Other cities have their own ultimate beings guarding them. The leader Tashkar from Tar-Tabar owns Rashti'rhami, the goddess of all Rhamis, the perfect female equivalent of Nomolas, and the leader of Mag-Magar, Malib, owns the Living Gate - the last and the weirdest ultimate being of all."
            message= _ "Yes. Only the ultimate beings are that powerful. Sud-Affar is the place of the Elemental Bird. Other cities have their own ultimate beings guarding them. Tashkar, the leader of Tar-Tabar owns Rashti'rhami, the goddess of all Rhamis. Some say she's the female equivalent of Nomolas, but honestly she's far less powerful. And the leader of Mag-Magar, Malib, owns the Living Gate - the last and the weirdest ultimate being of them all."
        [/message]
		[message]
            speaker=Instructor
#            message= _ "Enough talking. I have that circle for you. Here it is."
            message= _ "Enough talking. I've got the circle for you. Here it is."
        [/message]
		{PLACE_IMAGE items/summonerIIIcircle.png 14 10}
		[sound]
			name=magic-faeriefire.ogg
		[/sound]
		[delay]
			time=1000
		[/delay]
		[message]
            speaker=Instructor
            message= _ "Now you have to step in."
        [/message]
#removed due to feeling a little useless/unnatural:
#		[message]
#            speaker=Mehir
#            message= _ "And what if it eats me?"
#        [/message]
#		[message]
#            speaker=Instructor
#            message= _ "Oh, don't be so foolish! Now step in. I don't have much time."
#        [/message]
		{MOVE_UNIT id=Mehir 14 10}
		[store_unit]
			[filter]
				id=Mehir
			[/filter]
			variable=mehirvar
		[/store_unit]
		{VARIABLE oldexp $mehirvar.experience}
		{ADVANCE_UNIT id=Mehir (TLU_Mehir_Commander)}
		{MODIFY_UNIT id=Mehir profile "portraits/mehir-commander.png"}
		{MODIFY_UNIT id=Mehir experience $oldexp}
		{CLEAR_VARIABLE oldexp}
		{REMOVE_IMAGE 14 10}
		[message]
            speaker=Mehir
			image="portraits/mehir-commander-happy.png"
#            message= _ "Wow, this is amazing! I feel the power!"
            message= _ "Wow, this is amazing! I can feel the power flowing through me!"
        [/message]
		{BADASS_MODE_CHANGE (
		[message]
            speaker=Mehir
            message= _ "Now the girls will be all over me!"
        [/message]
		) ()}
		[message]
            speaker=Instructor
#            message= _ "The circle is calibrating itself. It will take a few seconds."
            message= _ "The circle is calibrating itself. It will take a moment."
        [/message]
		[message]
            speaker=Instructor
#            message= _ "You have probably seen some of your troops using their own circles. These fine tools have many uses. Yours can do two things - destroy enemies with a deadly accuracy and summon basic elementals!"
            message= _ "You have probably seen some of your troops using their own circles. These fine tools have many uses. Yours is combat-oriented, capable of doing two things - destroying enemies with a deadly accuracy and summoning basic elementals!"
        [/message]
		[message]
            speaker=Instructor
#            message= _ "Let's start with the latter. Use your new circle to summon something. It can be a fire, water elemental or something else. Just think about the element of your choosing and the circle will do the rest for you."
            message= _ "Let's start with the latter, shall we? Use your new circle to summon something. It can be an elemental of either fire, water, air or earth. Just think about the element of your choice, and the circle will do the rest for you."
        [/message]
		[message]
            speaker=narrator
			image=halo/jinn-circle2.png
            message= _ "Right click an empty hex adjacent to Mehir and then pick a unit you wish to summon."
        [/message]
		[disallow_end_turn]
		[/disallow_end_turn]
		[store_unit]
			[filter]
				id=Mehir
			[/filter]
			variable=mehirvar
		[/store_unit]
		[fire_event]
			name=forcesummonoptions
		[/fire_event]
		[objectives]
            side=1
            [objective]
                description= _ "Summon something"
                condition=win
            [/objective]
			[note]
				description= _ "Right click Mehir for help"
			[/note]
        [/objectives]
    [/event]
	
	[event]
		name=post summon
		
		[message]
            speaker=Mehir
			image="portraits/mehir-commander-happy.png"
#            message= _ "My very first elemental! Woohoo!" a bit childish, so removed
            message= _ "Wow, summoning with a circle is certainly far easier than with scrolls!"
        [/message]
		[message]
            speaker=Instructor
#            message= _ "Excellent! As you can see, summoning is very easy. And now..."
            message= _ "Indeed, and now, how about trying the circle's attacks on it?"
        [/message]
#		[message]
#            speaker=Instructor
#            message= _ "...DESTROY THAT CREATURE!!!"
#        [/message]
		[message]
            speaker=Mehir
            message= _ "Sure, why not?"
        [/message]
#		[message]
#            speaker=Mehir
#			image="portraits/mehir-commander-shocked.png"
#            message= _ "Wha..? I've just grown attached to it, you know?!"
#        [/message]
#		[message]
#            speaker=Instructor
#            message= _ "Elementals are mindless beings, they are all the same and do not have personalities nor feel pain. Destroying this one particular aspect of the Abyss won't change a thing. Its energy will return one day in a different form."
#        [/message]
#		[message]
#            speaker=Instructor
#            message= _ "I want you to use your circle's destroying power to disintegrate your summoned creature. The circle of destruction is a powerful weapon that tracks your target and always hits no matter what."
#        [/message]
		[message]
            speaker=Instructor
#            message= _ "Use your mind and tell the circle to track down and eliminate your elemental. Do it now!"
            message= _ "Use your mind and tell the circle to track down and eliminate the elemental, and it'll do the rest."
        [/message]
		{MODIFY_UNIT id=Mehir attack[0].number 0}
		{MODIFY_UNIT id=Mehir attack[1].number 0}
		{MODIFY_UNIT id=Mehir attack[3].number 0}
		{MODIFY_UNIT id=Mehir attacks_left 1}
#define FILTER_DOME
type=EoMa_Air_Elemental,EoMa_Earth_Elemental,EoMa_Fire_Elemental,EoMa_Water_Elemental
[not]
	x,y=recall,recall
[/not]
#enddef
		{MODIFY_UNIT ({FILTER_DOME}) hitpoints 1}
		{MODIFY_UNIT ({FILTER_DOME}) side 3}
		{MODIFY_UNIT ({FILTER_DOME}) attack[0].number 0}
		[objectives]
            side=1
            [objective]
                description= _ "Destroy your elemental"
                condition=win
            [/objective]
        [/objectives]
	[/event]
	
	[event]
		name=die
		
		[filter]
			{FILTER_DOME}
		[/filter]
		
		[message]
            speaker=Instructor
            message= _ "You see? Slaughtering innocent elementals is a piece of cake!"
        [/message]
		[message]
            speaker=Instructor
#            message= _ "Just remember - summoning take some time and focus, so when in battle you have to choose whether to fight in a particular moment or to summon instead. You can't fight and summon at the same time."
            message= _ "Just remember - summoning takes some time and focus, so when in battle you have to choose whether to fight in a particular moment or to summon instead. It's best to fight when you're in the front, and summon when in the rear."
        [/message]
		[message]
            speaker=Instructor
#            message= _ "Also, summoning wears off the circle so you need some resources to reinforce it after each summoning. If you run out of money, you won't be able to summon, literally speaking."
            message= _ "Also, summoning wears down the circle, so you need some resources to reinforce it after each summoning. If you run out of gold, you won't be able to summon, literally speaking."
        [/message]
		{BADASS_MODE_CHANGE (
		[message]
            speaker=Mehir
            message= _ "Now, now... abyssal magic comes at a price? What next?!..."
        [/message]
		[message]
            speaker=Instructor
            message= _ "Anyway, the lesson is over. I've been planning to see those jungle dwellers for myself, so I guess I'll go join the fun..."
        [/message]
		) (
		[message]
            speaker=Mehir
#            message= _ "Understood. I would love to meet that strange salamander with a chest full of gold once again..."
            message= _ "Now, now... abyssal magic comes at a price? What next?!... Oh, by the way, did you know that there are lizards— no, salamanders down there in the South who carry trunks of gold around?"
        [/message]
		[message]
            speaker=Instructor
#            message= _ "Ah, I almost forgot one of the most important things of all! Staying too long inside a circle is FORBIDDEN!"
            message= _ "Really? Sounds like a bunch of nonsense to me. Anyway, the lesson is over. I've been planning to see those jungle dwellers for myself, so I guess I'll go join the fun..."
        [/message])}
#new line
	{MOVE_UNIT id=Instructor 12 11}
         [delay]
	   time=750
         [/delay]
	{MOVE_UNIT id=Instructor 14 9}
	        [message]
            speaker=Instructor
            message= _ "Wait, I almost forgot the most important part! Staying too long inside a circle is FORBIDDEN!"
        [/message]
		[message]
            speaker=Mehir
#            message= _ "Why?"
            message= _ "And why is that the case?"
        [/message]
		[message]
            speaker=Instructor
#            message= _ "Weren't they taught you this at school? All personal circles synchronize themselves with minds of their owners every time they use them. If this lasts for too long, for example days, the bond can become too strong."
            message= _ "Weren't you taught this in school? All personal circles synchronize themselves with minds of their owners every time they use them. If this lasts for too long, for example days, the bond can become too strong."
        [/message]
		[message]
            speaker=Mehir
#            message= _ "And what's wrong with it?"
            message= _ "And what does this affect?"
        [/message]
		[message]
            speaker=Instructor
#            message= _ "You see, this can become problematic when you ...die. Your body may perish, but your mind will be somehow trapped within the circle forever!"
            message= _ "You see, this can become problematic when you... die. Your body may perish, but your mind will be trapped within the circle, forever!"
        [/message]
		[message]
            speaker=Mehir
            message= _ "So the owner becomes immortal?"
        [/message]
		[message]
            speaker=Instructor
            message= _ "Not exactly. His memories, behavior, personality - yes. But it is only a shadow of a living form, lost in the labyrinth of memories, helpless, hollow, tragic. Some of the first summoners, unaware of the consequences of abusing circles, ended up this way. Poor people..."
        [/message]
		[message]
            speaker=Mehir
#            message= _ "Indeed. So I will try to not stay too long inside my circle."
            message= _ "Out of one's right senses?... Got it. Oh dear, I don't want to end up like Jaffar, or worse."
        [/message]
		{BADASS_MODE_CHANGE (
		[message]
            speaker=Instructor
            message= _ "Ahem... Anyway, use your circle wisely, it may save your life one day! Well, I think my job is done here. Now I shall leap onto my carpet, and set off on a jungle trip! Flying reptiles and toad riders must be quite a sight..."
        [/message]
		[message]
            speaker=Instructor
            message= _ "...especially considering that they tend to smoke quite the unique mixtures of herbs, as some are saying. I am so excited to try them!"
        [/message]
		[message]
            speaker=Mehir
            message= _ "Yeah, I can certainly confirm the stuff they smoke is quite... potent. Anyway, have a nice time, old man."
        [/message]
		{MOVE_UNIT id=Instructor 12 12}
		[kill]
			id=Instructor
			animate=no
			fire_event=no
		[/kill]
		
		[store_unit]
			[filter]
				id=Mehir
			[/filter]
			variable=mehirvar2
		[/store_unit]
		
		#ladies
		{UNIT 2 (TLU_Citizen5) 10 12 (generate_name,id=yes,girl1)}
		{UNIT 2 (TLU_Citizen5) 8 12 (generate_name,id=yes,girl2)}
		{STORE_UNIT_VAR id=girl1 name girl1name}
		{STORE_UNIT_VAR id=girl2 name girl2name}
		{MOVE_UNIT id=girl1 11 10}
		{MOVE_UNIT id=girl2 10 10}
		[message]
            speaker=girl1
            message= _ "(with an excited voice) Sweet Nomolas! Is this Mehir? The one who survived in the jungle and negotiated an alliance with the untamed beasts?"
        [/message]
		[message]
            speaker=Mehir
            message= _ "Umm... hello, ladies."
        [/message]
		{MOVE_UNIT id=girl1 $mehirvar2.x $mehirvar2.y}
		{MOVE_UNIT id=girl2 $mehirvar2.x $mehirvar2.y}
		[message]
            speaker=girl2
            message= _ "It is really him! I can't believe this! Best... day... Ever! Could you give us an autograph? Pleeease?"
        [/message]
		[message]
            speaker=Mehir
            message= _ "Sure thing, baby."
        [/message]
		[message]
            speaker=girl1
            message= _ "Is it a magical circle? You look so hot standing on it."
        [/message]
		[message]
            speaker=Mehir
            message= _ "I know, beauty. Thanks. Wait, so, are you... twins?"
        [/message]
		[message]
            speaker=girl2
            message= _ "Yes. *giggles* And we are so happy to meet you!"
        [/message]
		[message]
            speaker=Mehir
            message= _ "*ahem* Do you have plans for tonight? Maybe you'd join me?"
        [/message]
		[message]
            speaker=girl1
            message= _ "Oh, Mehir! We would love to!"
        [/message]
		[message]
            speaker=Mehir
            message= _ "Glad to hear that. So let's go, shall we?"
        [/message]
		{MOVE_UNIT id=Mehir 14 12}
		[hide_unit]
			id=Mehir
		[/hide_unit]
		{MOVE_UNIT id=girl1 14 12}
		{MOVE_UNIT id=girl2 14 12}
		[hide_unit]
			id=girl1
		[/hide_unit]
		[hide_unit]
			id=girl2
		[/hide_unit]
		) (
		[message]
            speaker=Instructor
#            message= _ "Good. I think my job is done here. It was nice to meet you commander Mehir. Use your circle wisely, it may save your life one day!"
            message= _ "Ahem... Anyway, use your circle wisely, it may save your life one day! Well, I think my job is done here. Now I shall leap onto my carpet, and set off on a jungle trip! Flying reptiles and toad riders must be quite a sight... Fare thee well, commander Mehir, it was nice to meet you!"
        [/message]
		[message]
            speaker=Mehir
			image=portraits/mehir-commander-happy.png
            message= _ "Thank you and good luck!"
        [/message]
		)}
	[kill]
	   id=Mehir
	   animate=no
	   fire_event=no
	[/kill]
		[unstore_unit]
			variable=mehirvar
			find_vacant=no 
		[/unstore_unit]
		[hide_unit]
			id=Mehir
		[/hide_unit]
		[allow_end_turn]
		[/allow_end_turn]
		{CLEAR_VARIABLE mehirvar}
		{CLEAR_VARIABLE mehirvar2}
		[endlevel]
            result=victory
            carryover_report=no
            {NEW_GOLD_CARRYOVER 100}
            bonus=no
        [/endlevel]
	[/event]
	
	[event]
		name=moveto
		first_time_only=no
		[allow_undo]
		[/allow_undo]
		
		{MODIFY_UNIT id=Mehir moves $mehirvar.max_moves}
	[/event]
	
	[event]
		name=attack
		first_time_only=no
		[filter_attack]
			name=scimitar,hammer,scroll
		[/filter_attack]
		
		{MODIFY_UNIT ({FILTER_DOME}) side 1}
		
		[message]
            speaker=Instructor
            message= _ "You have to use your circle of destruction."
        [/message]
	[/event]
	
	[event]
		name=attack end
		first_time_only=no
		[filter_attack]
			name=scimitar,hammer,scroll
		[/filter_attack]
		
		{MODIFY_UNIT ({FILTER_DOME}) side 3}
		{MODIFY_UNIT id=Mehir attacks_left 1}
	[/event]

    [event]
        name=moveto
        first_time_only=yes
        [filter]
	    id=Mehir
          [filter_location]
	    x,y=6,9
	    radius=1
          [/filter_location]
        [/filter]
	[message]
            x,y=6,9
            message= _ "...and as I was saying, we need to increase the taxes again. The circle's construction has been taking quite a toll on the treasury, after all."
        [/message]
	[message]
            x,y=5,9
            message= _ "Good idea."
        [/message]
	[message]
            x,y=6,9
            message= _ "Oh, Mehir! I didn't notice you. Don't scare me like that!"
        [/message]
    [/event]
    [event]
        name=moveto
        first_time_only=no
        [filter]
            x=1-25
	    y=12
	    id=Mehir
	    [or]
            x=22-25
	    id=Mehir
	    [/or]
	    [or]
            x=1-3
	    id=Mehir
	    [/or]
        [/filter]
	[message]
            speaker=Instructor
            message= _ "Hey! Come back!"
        [/message]
        {MOVE_UNIT x,y=$x1,$y1 15 10}
    [/event]
    
    {SUMMONER_LOCK}
	{JINN_LOCK}
    {DEATH_MEHIR}
    {I8M06_TERRAIN}
[/scenario]
