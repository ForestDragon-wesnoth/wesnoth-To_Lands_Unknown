#textdomain wesnoth-help

#define MORNING_TLU
    [time]
        id=morning_tlu
        name= _ "Morning"
        image=misc/time-schedules/after-the-fall/2morning1.png
        lawful_bonus=25
    [/time]
#enddef

#textdomain wesnoth-To_Lands_Unknown

#Collar--------------------------------------------------------------
#define COLLAR_EVENT
    [event]
        name=die
        first_time_only=no
        [filter]
            [filter_wml]
                [status]
                    collar=yes
                [/status]
            [/filter_wml]
        [/filter]
        [if]
            [variable]
                name=unit.status.firstrecall
                equals=yes
            [/variable]
            [then]
                {VARIABLE unit.status.firstrecall no}
                {RECALL_ACTION}
            [/then]
            [else]
                [if]
                    [variable]
                        name=unit.status.secondrecall
                        equals=yes
                    [/variable]
                    [then]
                        {VARIABLE unit.status.secondrecall no}
                        {RECALL_ACTION}
                    [/then]
                    [else]
                        [if]
                            [variable]
                                name=unit.status.thirdrecall
                                equals=yes
                            [/variable]
                            [then]
                                {VARIABLE unit.status.thirdrecall no}
                                {RECALL_ACTION}
                            [/then]
                            [else]
                            [/else]
                        [/if]
                    [/else]
                [/if]
            [/else]
        [/if]
    [/event]
#enddef

#define RECALL_ACTION
    [store_unit]
        [filter]
            canrecruit=yes
            side=$unit.side
        [/filter]
        variable=summonerleader
    [/store_unit]
    [unstore_unit]
        variable=unit
        x,y=$summonerleader.x,$summonerleader.y
        find_vacant=yes
        text= _ "Recalled..."
        {COLOR_HEAL}
    [/unstore_unit]
    {CLEAR_VARIABLE summonerleader}
    {FULL_HEAL (
        [not]
            x,y=$x1,$y1
        [/not]
        [filter_wml]
            [status]
                collar=yes
            [/status]
        [/filter_wml]
    )}
#enddef

#LockActions-----------------------------------------------------
#define JINN_LOCK
    [event]
        name=post advance
        [filter]
            type=EoMa_Neutral_Summoner
        [/filter]
        [if]
            {VARIABLE_CONDITIONAL jinnlock1 equals 1}
            [else]
                [message]
                    speaker=narrator
                    image=halo/jinn-circle2.png
                    message= _ "Note: Your unit has become a Neutral Summoner. He can now summon friendly Jinn to aid your cause, but Mehir is not experienced enough at this stage of the story, to maintain such a unit. This means all summoned Jinn will disappear every time you advance to the next scenario.

When Mehir becomes a Summons Master, he will be able to keep them and carry between missions."
                [/message]
                {VARIABLE jinnlock1 1}
            [/else]
        [/if]
    [/event]

    [event]
        name=victory

        [if]
            [have_unit]
                type=EoMa_Jinn,EoMa_Great_Jinn,EoMa_Mystical_Jinn,EoMa_Wonderful_Jinn,EoMa_Efreet,EoMa_Great_Efreeti
                side=1
            [/have_unit]
            [then]
                [kill]
                    type=EoMa_Jinn,EoMa_Great_Jinn,EoMa_Mystical_Jinn,EoMa_Wonderful_Jinn,EoMa_Efreet,EoMa_Great_Efreeti
                    animate=no
                [/kill]
                [message]
                    speaker=narrator
                    image=halo/jinn-circle2.png
                    message= _ "Note: All summoned Jinn have returned to the Abyss. Remember: Mehir needs to be a Summons Master to carry them between missions."
                [/message]
            [/then]
        [/if]
    [/event]

    [event]
        name=side 1 turn end
        first_time_only=no

        [if]
            [have_unit]
                type=EoMa_Jinn,EoMa_Great_Jinn,EoMa_Wonderful_Jinn,EoMa_Efreet,EoMa_Great_Efreeti
                side=1
            [/have_unit]
            [and]
                {VARIABLE_CONDITIONAL jinnlock2 not_equals 1}
            [/and]
			#disable for scenario 04
			[and]
                [not]
					[have_unit]
						id=Jaffar
					[/have_unit]
                [/not]
            [/and]
            [then]
                [message]
                    speaker=narrator
                    image=halo/jinn-circle2.png
                    message= _ "Note: You have summoned a Jinni. Unfortunately Mehir is not experienced enough at this stage of the story to carry such a unit between missions. The summoned jinni will disappear at the end of the current scenario."
                [/message]
                {VARIABLE jinnlock2 1}
            [/then]
        [/if]
    [/event]
#enddef

#define SUMMONER_LOCK
    [event]
        name=recall,recruit,post advance
        first_time_only=no
        [filter]
            type=EoMa_Summoner
        [/filter]
        {VARIABLE unit.advances_to (EoMa_Grand_Summoner_lock,EoMa_Neutral_Summoner,EoMa_Heavy_Summoner)}
        [unstore_unit]
            variable=unit
            find_vacant=no
        [/unstore_unit]
		[allow_undo]
		[/allow_undo]
    [/event]
    [event]
        name=post advance
        first_time_only=no
        [filter]
            type=EoMa_Grand_Summoner_lock
        [/filter]

        [if]
            {VARIABLE_CONDITIONAL summonerlock equals 1}
            [else]
                [message]
                    speaker=narrator
                    image=halo/jinn-circle2.png
                    message= _ "Note: Grand Summoners can't advance now, but if one gets an AMLA, they'll become Summons Masters when Mehir recalls them while being a Summons Master himself."
                [/message]
                {VARIABLE summonerlock 1}
            [/else]
        [/if]

        [if]
            [have_unit]
                id=$unit.id
                find_in=noamlayet
            [/have_unit]
            [then]
                [store_unit]
                    [filter]
                        id=$unit.id
                    [/filter]
                    variable=summonscandidates
                    mode=append
                [/store_unit]
            [/then]
            [else]
                [store_unit]
                    [filter]
                        id=$unit.id
                    [/filter]
                    variable=noamlayet
                    mode=append
                [/store_unit]
            [/else]
        [/if]
    [/event]
#enddef

#define SUMMONER_UNLOCK
    [event]
        name=recall
        first_time_only=no
        [filter]
            type=EoMa_Grand_Summoner_lock
        [/filter]

        [if]
            [have_unit]
                id=$unit.id
                find_in=summonscandidates
            [/have_unit]
            [then]
                {ADVANCE_UNIT id=$unit.id (EoMa_Summons_Master)}
            [/then]
            [else]
                [object]
                    [filter]
                        x,y=$x1,$y1
                    [/filter]
                    [effect]
                        apply_to=type
                        name=EoMa_Grand_Summoner
                    [/effect]
                    silent=yes
                [/object]
            [/else]
        [/if]
    [/event]
#enddef

#Badass mode--------------------------------------------------------------
#define SECRET_EVENTS
    [event]
        name=start

        [set_menu_item]
            id=badass_mode_toggle
            description=_"Toggle Badass Mode"
            [show_if]
                [variable]
                    name=badass_mode_unlocked
                    equals=yes
                [/variable]
                [and]
                    [have_unit]
                        id=Mehir
                        type=TLU_Mehir_Leader
                        x=$x1
                        y=$y1
                    [/have_unit]
                    [or]
                        [have_unit]
                            type=TLU_True_Rashti
                            x=$x1
                            y=$y1
                        [/have_unit]
                    [/or]
                [/and]
            [/show_if]

            [command]
                [if]
                    [variable]
                        name=badass_mode_active
                        equals=yes
                    [/variable]
                    [then]
                        [object]
                            silent=yes
                            duration=forever
                            [filter]
                                id=Mehir
                            [/filter]
                            [effect]
                                apply_to=variation
                                name=
                            [/effect]
                        [/object]
                        {MODIFY_UNIT id=Mehir profile "portraits/mehir-leader.png"}
                        [object]
                            silent=yes
                            duration=forever
                            [filter]
                                type=TLU_True_Rashti
                            [/filter]
                            [effect]
                                apply_to=variation
                                name=
                            [/effect]
                        [/object]
                        {MODIFY_UNIT type=TLU_True_Rashti profile "portraits/truerashti.png"}
                        [set_variable]
                            name=badass_mode_active
                            value=no
                        [/set_variable]
                    [/then]
                    [else]
                        [object]
                            silent=yes
                            duration=forever
                            [filter]
                                id=Mehir
                            [/filter]
                            [effect]
                                apply_to=variation
                                name=badass
                            [/effect]
                        [/object]
                        {MODIFY_UNIT id=Mehir profile "portraits/mehir-leader.png~BLIT(misc/sunglasses.png)"}
                        [object]
                            silent=yes
                            duration=forever
                            [filter]
                                type=TLU_True_Rashti
                            [/filter]
                            [effect]
                                apply_to=variation
                                name=badass
                            [/effect]
                        [/object]
                        {MODIFY_UNIT type=TLU_True_Rashti profile "portraits/truerashti.png~BLIT(misc/truerashti-sunglasses.png)"}
                        [set_variable]
                            name=badass_mode_active
                            value=yes
                        [/set_variable]
                    [/else]
                [/if]
            [/command]
        [/set_menu_item]
        [set_menu_item]
            id=badass_mode_toggle_last
            description=_"Toggle Badass Mode"
            [show_if]
                [variable]
                    name=badass_mode_unlocked
                    equals=yes
                [/variable]
                [and]
                    [have_unit]
                        id=Mehir
                        type=TLU_Last_Summoner
                        x=$x1
                        y=$y1
                    [/have_unit]
                [/and]
            [/show_if]
            [command]
                [if]
                    [variable]
                        name=badass_mode_active
                        equals=yes
                    [/variable]
                    [then]
                        [object]
                            silent=yes
                            duration=forever
                            [filter]
                                id=Mehir
                            [/filter]
                            [effect]
                                apply_to=variation
                                name=
                            [/effect]
                        [/object]
                        {MODIFY_UNIT id=Mehir profile "portraits/mehir-last.png"}
                        [object]
                            silent=yes
                            duration=forever
                            [filter]
                                type=TLU_True_Rashti
                            [/filter]
                            [effect]
                                apply_to=variation
                                name=
                            [/effect]
                        [/object]
                        {MODIFY_UNIT type=TLU_True_Rashti profile "portraits/truerashti.png"}
                        [set_variable]
                            name=badass_mode_active
                            value=no
                        [/set_variable]
                    [/then]
                    [else]
                        [object]
                            silent=yes
                            duration=forever
                            [filter]
                                id=Mehir
                            [/filter]
                            [effect]
                                apply_to=variation
                                name=badass
                            [/effect]
                        [/object]
                        {MODIFY_UNIT id=Mehir profile "portraits/mehir-last.png~BLIT(misc/sunglasses.png)"}
                        [object]
                            silent=yes
                            duration=forever
                            [filter]
                                type=TLU_True_Rashti
                            [/filter]
                            [effect]
                                apply_to=variation
                                name=badass
                            [/effect]
                        [/object]
                        {MODIFY_UNIT type=TLU_True_Rashti profile "portraits/truerashti.png~BLIT(misc/truerashti-sunglasses.png)"}
                        [set_variable]
                            name=badass_mode_active
                            value=yes
                        [/set_variable]
                    [/else]
                [/if]
            [/command]
        [/set_menu_item]
    [/event]

#enddef

#define SUNGLASSES_FIX1
    [store_unit]
        [filter]
            id=Mehir
        [/filter]
        variable=mehir_typecheck
    [/store_unit]
    [switch]
        variable=mehir_typecheck.type
        [case]
            value=TLU_Mehir_Guard
            {MODIFY_UNIT id=Mehir profile "portraits/mehir.png~BLIT(misc/sunglasses.png)"}
        [/case]
        [case]
            value=TLU_Mehir_Commander
            {MODIFY_UNIT id=Mehir profile "portraits/mehir-commander.png~BLIT(misc/sunglasses.png)"}
        [/case]
        [case]
            value=TLU_Mehir_Leader
            {MODIFY_UNIT id=Mehir profile "portraits/mehir-leader.png~BLIT(misc/sunglasses.png)"}
        [/case]
        [case]
            value=TLU_The_Last_Summoner
            {MODIFY_UNIT id=Mehir profile "portraits/mehir-last.png~BLIT(misc/sunglasses.png)"}
        [/case]
        [else]
        [/else]
    [/switch]
    {MODIFY_UNIT type=TLU_True_Rashti profile "portraits/truerashti.png~BLIT(misc/truerashti-sunglasses.png)"}
#enddef
#define SUNGLASSES_FIX2
    [switch]
        variable=mehir_typecheck.type
        [case]
            value=TLU_Mehir_Guard
            {MODIFY_UNIT id=Mehir profile "portraits/mehir.png"}
        [/case]
        [case]
            value=TLU_Mehir_Commander
            {MODIFY_UNIT id=Mehir profile "portraits/mehir-commander.png"}
        [/case]
        [case]
            value=TLU_Mehir_Leader
            {MODIFY_UNIT id=Mehir profile "portraits/mehir-leader.png"}
        [/case]
        [case]
            value=TLU_The_Last_Summoner
            {MODIFY_UNIT id=Mehir profile "portraits/mehir-last.png"}
        [/case]
        [else]
        [/else]
    [/switch]
    {CLEAR_VARIABLE mehir_typecheck}
    {MODIFY_UNIT type=TLU_True_Rashti profile "portraits/truerashti.png"}
#enddef
#define BADASS_MODE_CHANGE NEW OLD
    {IF_VAR badass_mode_active equals yes (
        [then]
            {SUNGLASSES_FIX1}
            {NEW}
            {SUNGLASSES_FIX2}
        [/then]
        [else]
            {OLD}
        [/else]
    )}
#enddef

#define SUNGLASSES_OFF ACTION_WML
    {SUNGLASSES_FIX2}
    {ACTION_WML}
    {SUNGLASSES_FIX1}
#enddef

#Rashti--------------------------------------------------------------
#define RASHTI_SIDES SIDE_DHARMA SIDE_HO
    #dharma
    [side]
        side={SIDE_DHARMA}
        controller=ai
        team_name=rashti
        user_team_name= _ "team_name^DharmaRashti"
        no_leader=yes
        color=black
        hidden=yes

        {ai/aliases/stable_singleplayer.cfg}
        [ai]
            aggression=1.0
            caution=0.0
            {MODIFY_AI_ADD_CANDIDATE_ACTION {SIDE_DHARMA} main_loop (
                [candidate_action]
                    id=escape_south
                    engine=fai
                    name=escape_south
                    type=movement
                    evaluation="if(me.type='TLU_DharmaRashti',{AI_CA_GOTO_SCORE}+10,0)"
                    action="move(me.loc, choose(unit_moves(me.loc),'mloc',-sum(map(simplest_path(mloc,find(units,id='Mehir').loc,me.loc), 'path_location', movement_cost( me, path_location ) ))) )"
                [/candidate_action]
            )}
            {MODIFY_AI_ADD_CANDIDATE_ACTION {SIDE_DHARMA} main_loop (
                [candidate_action]
                    id=attack_gra
                    engine=fai
                    name=attack_gra
                    type=attack
                    evaluation="if(me.type = 'TLU_DharmaRashti' and target.id = 'Mehir', {AI_CA_GOTO_SCORE} ,0)"
                    action="attack(me.loc, me.loc, target.loc)"
                [/candidate_action]
                [candidate_action]
                    id=attack_gra2
                    engine=fai
                    name=attack_gra2
                    type=attack
                    evaluation="if(me.type = 'EoMa_Fire_Elemental' and target.type = 'TLU_HoRashti', {AI_CA_GOTO_SCORE} ,0)"
                    action="attack(me.loc, me.loc, target.loc)"
                [/candidate_action]
            )}
        [/ai]
    [/side]

    #ho
    [side]
        side={SIDE_HO}
        controller=ai
        team_name=mehirteam
        user_team_name= _ "team_name^HoRashti"
        no_leader=yes
        color=white
        hidden=yes

        {ai/aliases/stable_singleplayer.cfg}
        [ai]
            aggression=1.0
            caution=0.0
            {MODIFY_AI_ADD_CANDIDATE_ACTION {SIDE_HO} main_loop (
                [candidate_action]
                    id=escape_south
                    engine=fai
                    name=escape_south
                    type=movement
                    evaluation="if(me.type='TLU_HoRashti',{AI_CA_GOTO_SCORE}+10,0)"
                    action="move(me.loc, choose(unit_moves(me.loc),'mloc',-sum(map(simplest_path(mloc,find(units,type='TLU_DharmaRashti').loc,me.loc), 'path_location', movement_cost( me, path_location ) ))) )"
                [/candidate_action]
            )}
            {MODIFY_AI_ADD_CANDIDATE_ACTION {SIDE_HO} main_loop (
                [candidate_action]
                    id=attack_gra
                    engine=fai
                    name=attack_gra
                    type=attack
                    evaluation="if(me.type = 'TLU_HoRashti' and target.type = 'TLU_DharmaRashti', {AI_CA_GOTO_SCORE} ,0)"
                    action="attack(me.loc, me.loc, target.loc)"
                [/candidate_action]
            )}
        [/ai]
    [/side]

    #change dharma side parameters for badass
    [event]
        name=side 1 turn
        first_time_only=no

        {BADASS_MODE_CHANGE (
            [modify_side]
                side={SIDE_DHARMA}
                team_name=rashti
            [/modify_side]
            {MODIFY_AI_DELETE_CANDIDATE_ACTION {SIDE_DHARMA} main_loop escape_south}
            {MODIFY_AI_DELETE_CANDIDATE_ACTION {SIDE_DHARMA} main_loop attack_gra}
        ) ()}
    [/event]

    [event]
        name=side {SIDE_DHARMA} turn
        first_time_only=no

        {BADASS_MODE_CHANGE (
            [modify_side]
                side={SIDE_DHARMA}
                team_name=mehirteam
            [/modify_side]
        ) ()}
    [/event]

    [event]
        name=side {SIDE_HO} turn
        first_time_only=no

        {BADASS_MODE_CHANGE (
            [modify_side]
                side={SIDE_DHARMA}
                team_name=rashti
            [/modify_side]
        ) ()}
    [/event]

    #transformations
    [event]
        name=last breath
        id=rashtitransformations_event
        first_time_only=no

        [filter]
            type=TLU_True_Rashti
        [/filter]

        {IF_VAR lock_truerashti equals yes (
            [then]
                #heal rashti
                [heal_unit]
                    [filter]
                        type=TLU_True_Rashti
                    [/filter]
                    amount=full
                    animate=no
                    restore_statuses=yes
                [/heal_unit]
                {VARIABLE exp $second_unit.experience}
                {VARIABLE_OP exp add -32}
                [store_unit]
                    [filter]
                        id=$second_unit.id
                    [/filter]
                    variable=noexp
                [/store_unit]
                {VARIABLE noexp.experience $exp}
                [unstore_unit]
                    variable=noexp
                    find_vacant=no
                [/unstore_unit]
                {CLEAR_VARIABLE noexp}
                {CLEAR_VARIABLE exp}
            [/then]
            [else]
                {ADVANCE_UNIT (x,y=$x1,$y1) "TLU_Rashti"}
                {ADVANCE_UNIT (x,y=$x1,$y1) "TLU_HoRashti"}
                {MODIFY_UNIT type=TLU_HoRashti side ({SIDE_HO})}
                {MODIFY_UNIT type=TLU_HoRashti overlays ""}
                {UNIT ({SIDE_DHARMA}) (TLU_DharmaRashti) $x1 $y1 (placement,passable=map,yes)}
                {VARIABLE dharma_turns 0}
                {VARIABLE dharma_return yes}
                [store_unit]
                    [filter]
                        type=TLU_DharmaRashti
                    [/filter]
                    variable=dharmarashti_loc
                    kill=no
                [/store_unit]
                [store_unit]
                    [filter]
                        type=TLU_HoRashti
                    [/filter]
                    variable=horashti_loc
                    kill=no
                [/store_unit]
                {UNIT {SIDE_DHARMA} (EoMa_Fire_Elemental) $dharmarashti_loc.x $dharmarashti_loc.y (animate=yes)}
                {UNIT {SIDE_DHARMA} (EoMa_Fire_Elemental) $dharmarashti_loc.x $dharmarashti_loc.y (animate=yes)}
                [modify_unit]
                    [filter]
                        side={SIDE_DHARMA}
                        type=EoMa_Fire_Elemental,EoMa_Fire_Avatar,EoMa_Fire_God #I put the advancements in case an enemy fire elemental somehow advances
                    [/filter]
                    goto_x=$horashti_loc.x
                    goto_y=$horashti_loc.y
                [/modify_unit]
                [fire_event]
                    name=split
                [/fire_event]
            [/else]
        )}
    [/event]

    [event]
        name=last breath
        id=rashti_onkill_event1
        first_time_only=no

        [filter]
            type=TLU_DharmaRashti,TLU_HoRashti
        [/filter]
        [filter_second]
            [not]
                type=TLU_DharmaRashti,TLU_HoRashti
            [/not]
        [/filter_second]

        [heal_unit]
            [filter]
                type=TLU_DharmaRashti,TLU_HoRashti
            [/filter]
            amount=full
            animate=no
            restore_statuses=yes
        [/heal_unit]
        {VARIABLE exp $second_unit.experience}
        {VARIABLE_OP exp add -24}
        [store_unit]
            [filter]
                id=$second_unit.id
            [/filter]
            variable=noexp
        [/store_unit]
        {VARIABLE noexp.experience $exp}
        [unstore_unit]
            variable=noexp
            find_vacant=no
        [/unstore_unit]
        {CLEAR_VARIABLE noexp}
        {CLEAR_VARIABLE exp}
    [/event]

    #dharmarashti spawns fire elementals to delay horashti:
    [event]
        name=side {SIDE_DHARMA} turn
        id=spawn_fire
        first_time_only=no
        [if]
            [have_unit]
                type=TLU_DharmaRashti
            [/have_unit]
            [then]
                [store_unit]
                    [filter]
                        type=TLU_DharmaRashti
                    [/filter]
                    variable=dharmarashti_loc
                    kill=no
                [/store_unit]
                [store_unit]
                    [filter]
                        type=TLU_HoRashti
                    [/filter]
                    variable=horashti_loc
                    kill=no
                [/store_unit]
                [switch]
                    variable=dharma_turns
                    [case]
                        value=1,3,5,9
                        {UNIT {SIDE_DHARMA} (EoMa_Fire_Elemental) $dharmarashti_loc.x $dharmarashti_loc.y (animate=yes)}
                        {UNIT {SIDE_DHARMA} (EoMa_Fire_Elemental) $dharmarashti_loc.x $dharmarashti_loc.y (animate=yes)}
                    [/case]
                    [case]
                        value=7
                        {UNIT {SIDE_DHARMA} (EoMa_Fire_Avatar) $dharmarashti_loc.x $dharmarashti_loc.y (animate=yes)}
                        {UNIT {SIDE_DHARMA} (EoMa_Fire_Elemental) $dharmarashti_loc.x $dharmarashti_loc.y (animate=yes)}
                    [/case]
                    [case]
                        value=11
                        {UNIT {SIDE_DHARMA} (EoMa_Fire_Elemental) $dharmarashti_loc.x $dharmarashti_loc.y (animate=yes)}
                        {UNIT {SIDE_DHARMA} (EoMa_Fire_Elemental) $dharmarashti_loc.x $dharmarashti_loc.y (animate=yes)}
                        {UNIT {SIDE_DHARMA} (EoMa_Fire_Elemental) $dharmarashti_loc.x $dharmarashti_loc.y (animate=yes)}
                    [/case]
                [/switch]
                {VARIABLE_OP dharma_turns add 1}
                [modify_unit]
                    [filter]
                        side={SIDE_DHARMA}
                        type=EoMa_Fire_Elemental,EoMa_Fire_Avatar,EoMa_Fire_God #I put the advancements in case an enemy fire elemental somehow advances
                    [/filter]
                    goto_x=$horashti_loc.x
                    goto_y=$horashti_loc.y
                [/modify_unit]
            [/then]
        [/if]
#ifndef EASY
        [if]
            [have_unit]
                type=TLU_DharmaRashti
            [/have_unit]
            [and]
                [variable]
                    name=dharma_return
                    equals=yes
                [/variable]
            [/and]
            [then]
                [switch]
                    variable=dharma_turns
                    [case]
                        value=1,5,9
                        {UNIT {SIDE_DHARMA} (EoMa_Efreet) $dharmarashti_loc.x $dharmarashti_loc.y (animate=yes)}
                    [/case]
                    [case]
                        value=3,7,11
                        {UNIT {SIDE_DHARMA} (EoMa_RhamiDatu) $dharmarashti_loc.x $dharmarashti_loc.y (animate=yes)}
                    [/case]
                [/switch]
                [modify_unit]
                    [filter]
                        side={SIDE_DHARMA}
                        type=EoMa_Fire_Elemental,EoMa_Fire_Avatar,EoMa_Fire_God #I put the advancements in case an enemy fire elemental somehow advances
                    [/filter]
                    goto_x=$horashti_loc.x
                    goto_y=$horashti_loc.y
                [/modify_unit]
            [/then]
        [/if]
#endif
    [/event]

    [event]
        name=die
        first_time_only=no
        id=rashti_onkill_event2
        [filter]
            type=TLU_HoRashti
        [/filter]

        [heal_unit]
            [filter]
                type=TLU_DharmaRashti,TLU_HoRashti
            [/filter]
            amount=full
            animate=no
            restore_statuses=yes
        [/heal_unit]
    [/event]

    [event]
        name=last breath
        id=rashti_onkill_event3
        first_time_only=no
        [filter]
            type=TLU_DharmaRashti,TLU_HoRashti
        [/filter]
        [filter_second]
            type=TLU_DharmaRashti,TLU_HoRashti
        [/filter_second]
        [kill]
            x,y=$x1,$y1
        [/kill]
        {ADVANCE_UNIT (x,y=$x2,$y2) "TLU_Rashti2"}
        {ADVANCE_UNIT (x,y=$x2,$y2) "TLU_True_Rashti"}
        {MODIFY_UNIT (type=TLU_True_Rashti) side 1}
        {MODIFY_UNIT (type=TLU_True_Rashti) id Rashti}
        {MODIFY_UNIT (type=TLU_True_Rashti) upkeep loyal}
        {MODIFY_UNIT (type=TLU_True_Rashti) overlays "misc/hero-icon.png"}
        [modify_unit]
            [filter]
                type=TLU_True_Rashti
            [/filter]
            {IS_HERO}
        [/modify_unit]

        {CLEAR_VARIABLE dharma_turns}
        [fire_event]
            name=unified
        [/fire_event]
    [/event]

    [event]
        name=split
        {BADASS_MODE_CHANGE (
            [message]
                speaker=Mehir
                message= _ "It looks like Rashti has lost her balance once again!"
            [/message]
            [message]
                type=TLU_DharmaRashti
                message= _ "Long time no see, Mehir. I'm back and I am gonna KICK SOME BUTTS TODAY!!! You ready?"
            [/message]
            [message]
                speaker=Mehir
                message= _ "Count me in!"
            [/message]
            [message]
                type=TLU_HoRashti
                message= _ "Master, you shouldn't befriend her! She is evil!"
            [/message]
            [message]
                type=TLU_DharmaRashti
                message= _ "Just shut your mouth and return to your books! We are about to do some serious stuff right now, am I right Mehir?"
            [/message]
            [message]
                speaker=Mehir
                message= _ "Yes, baby. Sort of..."
            [/message]
            [message]
                type=TLU_HoRashti
                message= _ "If we don't unite the Abyss will be in danger really soon!"
            [/message]
        ) (
            [message]
                speaker=Mehir
                message= _ "Oh no! Rashti has lost her balance once again!"
            [/message]
            [message]
                type=TLU_DharmaRashti
                message= _ "Long time no see, Mehir. I'm back and I am gonna RIP YOUR THROAT OUT!!!"
            [/message]
            [message]
                type=TLU_HoRashti
                message= _ "Fear not, Master! She is mine!"
            [/message])}
        [/event]
#enddef

#define RECALL_RASHTI
    [if]
        [have_unit]
            side=1
            type=TLU_True_Rashti
            x,y=recall,recall
        [/have_unit]
        [then]
            recall=Rashti
        [/then]
        [else]
            {UNIT 1 TLU_True_Rashti () () (placement=leader
            id=Rashti
            name= _ "Rashti"
            gender=female
            animate=yes
            upkeep=loyal
            {IS_HERO}
        )}
    [/else]
[/if]
#enddef

#define MEDITATION_EVENT
    [event]
        name=side 1 turn
        id=medidation_event1
        first_time_only=no

        [if]
            [have_unit]
                ability=meditation
            [/have_unit]
            [then]
                [store_unit]
                    variable=meditation
                    [filter]
                        type=TLU_Mehir_Guard,TLU_Mehir_Commander,TLU_Mehir_Leader,TLU_The_Last_Summoner
                    [/filter]
                [/store_unit]
                #evaluate
                {VARIABLE meditation.variables.new_x $meditation.x}
                {VARIABLE meditation.variables.new_y $meditation.y}

                [if]
                    {VARIABLE_CONDITIONAL meditation.variables.new_x equals $meditation.variables.old_x}
                    [and]
                        {VARIABLE_CONDITIONAL meditation.variables.new_y equals $meditation.variables.old_y}
                    [/and]
                    [then]
                        {VARIABLE meditation.variables.old_x $meditation.variables.new_x}
                        {VARIABLE meditation.variables.old_y $meditation.variables.new_y}
                        {VARIABLE_OP meditation.experience add 1}
                        [unstore_unit]
                            variable=meditation
                            text=_ "+1 exp"
                            red,green,blue=50,50,200
                        [/unstore_unit]
                    [/then]
                    [else]
                        {VARIABLE meditation.variables.old_x $meditation.variables.new_x}
                        {VARIABLE meditation.variables.old_y $meditation.variables.new_y}
                        [unstore_unit]
                            variable=meditation
                        [/unstore_unit]
                    [/else]
                [/if]
                {CLEAR_VARIABLE meditation}
            [/then]
        [/if]
    [/event]

    [event]
        name=start
        id=medidation_event2

        [if]
            [have_unit]
                ability=meditation
            [/have_unit]
            [then]
                [store_unit]
                    variable=meditation
                    [filter]
                        type=TLU_Mehir_Guard,TLU_Mehir_Commander,TLU_Mehir_Leader,TLU_The_Last_Summoner
                    [/filter]
                [/store_unit]

                {MODIFY_UNIT id=$meditation.id variables.new_x $x1}
                {MODIFY_UNIT id=$meditation.id variables.new_y $y1}
                {MODIFY_UNIT id=$meditation.id variables.old_x $x1}
                {MODIFY_UNIT id=$meditation.id variables.old_y $y1}
            [/then]
        [/if]
    [/event]

    [event]
        name=post advance
        id=medidation_event3
        [filter]
            type=TLU_Mehir_Guard,TLU_Mehir_Commander,TLU_Mehir_Leader,TLU_The_Last_Summoner
        [/filter]
        [if]
            [have_unit]
                ability=meditation
            [/have_unit]
            [then]
                [store_unit]
                    variable=meditation
                    [filter]
                        type=TLU_Mehir_Guard,TLU_Mehir_Commander,TLU_Mehir_Leader,TLU_The_Last_Summoner
                    [/filter]
                [/store_unit]

                {MODIFY_UNIT id=$meditation.id variables.new_x $x1}
                {MODIFY_UNIT id=$meditation.id variables.new_y $y1}
                {MODIFY_UNIT id=$meditation.id variables.old_x $x1}
                {MODIFY_UNIT id=$meditation.id variables.old_y $y1}
            [/then]
        [/if]
    [/event]
#enddef

#define RASHTICIRCLE COLOR DURATION
    circle_start_time=-400
    particle_start_time=-400
    [particle_frame]
        duration={DURATION}
        image="halo/particle-anims/particles-a-[01~96].png"
        image_mod="~SCALE(100,100)"
        auto_vflip=false
        layer=30
        alpha=0~1:150,1:700,1~0:150
        offset=0.0
    [/particle_frame]
    [circle_frame]
        {CIRCLE_RECRUIT 15 {COLOR}}
        image_mod="~SCALE(1,2)"
    [/circle_frame]
    [circle_frame]
        {CIRCLE_RECRUIT 16 {COLOR}}
        image_mod="~SCALE(10,7)"
    [/circle_frame]
    [circle_frame]
        {CIRCLE_RECRUIT 17 {COLOR}}
        image_mod="~SCALE(19,12)"
    [/circle_frame]
    [circle_frame]
        {CIRCLE_RECRUIT 18 {COLOR}}
        image_mod="~SCALE(28,17)"
    [/circle_frame]
    [circle_frame]
        {CIRCLE_RECRUIT 18 {COLOR}}
        image_mod="~SCALE(37,22)"
    [/circle_frame]
    [circle_frame]
        {CIRCLE_RECRUIT 19 {COLOR}}
        image_mod="~SCALE(45,27)"
    [/circle_frame]
    [circle_frame]
        {CIRCLE_RECRUIT 20 {COLOR}}
        image_mod="~SCALE(54,32)"
    [/circle_frame]
    [circle_frame]
        {CIRCLE_RECRUIT 21 {COLOR}}
        image_mod="~SCALE(63,37)"
    [/circle_frame]
    [circle_frame]
        {CIRCLE_RECRUIT 22 {COLOR}}
        image_mod="~SCALE(72,42)"
    [/circle_frame]
    [circle_frame]
        {CIRCLE_RECRUIT 23 {COLOR}}
        image_mod="~SCALE(81,47)"
    [/circle_frame]
    [circle_frame]
        {CIRCLE_RECRUIT 23 {COLOR}}
        image_mod="~SCALE(101,59)"
    [/circle_frame]
    [circle_frame]
        duration={DURATION}
        image=halo/ucircle-frames/ucircle-c-[01~23].png#~(640,480,)
        image_mod="~SCALE(101,59){COLOR}"
        auto_vflip=false
        layer=0
        y=17
        alpha=1
        offset=0.0
        layer=0
    [/circle_frame]
    [circle_frame]
        {CIRCLE_RECRUIT 01 {COLOR}}
        image_mod="~SCALE(101,59)"
    [/circle_frame]
    [circle_frame]
        {CIRCLE_RECRUIT 01 {COLOR}}
        image_mod="~SCALE(81,47)"
    [/circle_frame]
    [circle_frame]
        {CIRCLE_RECRUIT 02 {COLOR}}
        image_mod="~SCALE(72,42)"
    [/circle_frame]
    [circle_frame]
        {CIRCLE_RECRUIT 03 {COLOR}}
        image_mod="~SCALE(63,37)"
    [/circle_frame]
    [circle_frame]
        {CIRCLE_RECRUIT 04 {COLOR}}
        image_mod="~SCALE(54,32)"
    [/circle_frame]
    [circle_frame]
        {CIRCLE_RECRUIT 05 {COLOR}}
        image_mod="~SCALE(45,27)"
    [/circle_frame]
    [circle_frame]
        {CIRCLE_RECRUIT 06 {COLOR}}
        image_mod="~SCALE(37,22)"
    [/circle_frame]
    [circle_frame]
        {CIRCLE_RECRUIT 07 {COLOR}}
        image_mod="~SCALE(28,17)"
    [/circle_frame]
    [circle_frame]
        {CIRCLE_RECRUIT 08 {COLOR}}
        image_mod="~SCALE(19,12)"
    [/circle_frame]
    [circle_frame]
        {CIRCLE_RECRUIT 09 {COLOR}}
        image_mod="~SCALE(10,7)"
    [/circle_frame]
    [circle_frame]
        {CIRCLE_RECRUIT 10 {COLOR}}
        image_mod="~SCALE(1,2)"
    [/circle_frame]
#enddef
