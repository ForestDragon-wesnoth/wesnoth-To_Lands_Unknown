#textdomain wesnoth-To_Lands_Unknown

#define TLU_PICKUPPABLE_ITEM ID X Y CAN_TAKE_FILTER_WML IMAGE TEXT TAKE_IT_STRING LEAVE_IT_STRING CANNOT_TAKE_TEXT OBJECT_WML
    [item]
        x,y={X},{Y}
        image={IMAGE}
    [/item]

    [event]
        name=moveto
        first_time_only=no

        [filter]
            x,y={X},{Y}
	    side=1
        [/filter]

        [if]
            [have_unit]
                x,y={X},{Y}
                {CAN_TAKE_FILTER_WML}
				side=1
            [/have_unit]

            [variable]
                name=item_{ID}_picked_up
                not_equals=yes
            [/variable]

            [then]
                [message]
                    speaker=narrator
                    message={TEXT}
                    image={IMAGE}

                    [option]
                        message={TAKE_IT_STRING}

                        [command]
                            {OBJECT_WML}

                            [remove_item]
                                x,y={X},{Y}
                                image={IMAGE}
                            [/remove_item]

                            [set_variable]
                                name=item_{ID}_picked_up
                                value=yes
                            [/set_variable]
                            [set_variable]
                                name=item_{ID}_in_use
                                value=yes
                            [/set_variable]
                        [/command]
                    [/option]
                    [option]
                        message={TAKE_IT_STRING}+ _ " for later use (on recruit/recall of a unit)"

                        [command]
                            [remove_item]
                                x,y={X},{Y}
                                image={IMAGE}
                            [/remove_item]

                            [set_variable]
                                name=item_{ID}_picked_up
                                value=yes
                            [/set_variable]
                            [set_variable]
                                name=item_{ID}_in_use
                                value=no
                            [/set_variable]
                        [/command]
                    [/option]

                    [option]
                        message={LEAVE_IT_STRING}

                        [command]
                            [allow_undo]
                            [/allow_undo]
                        [/command]
                    [/option]
                [/message]
            [/then]

            [else]
                [if]
                    [have_unit]
                        {CAN_TAKE_FILTER_WML}
						side=1
                    [/have_unit]
                    [then]
                        [if]
                            [variable]
                                name=item_{ID}_picked_up
                                not_equals=yes
                            [/variable]

                            [then]
                                [message]
                                    speaker=narrator
                                    message={CANNOT_TAKE_TEXT}+" "+_"You can still take the item for later use, though."
                                    image={IMAGE}
                                    for_side=$side_number
                                    # the above is used to prevent an AI side from
                                    # accidentally triggering this dialog
                    [option]
                        message={TAKE_IT_STRING}+" "+"for later use (on recruit/recall of a unit)"

                        [command]
                            [remove_item]
                                x,y={X},{Y}
                                image={IMAGE}
                            [/remove_item]

                            [set_variable]
                                name=item_{ID}_picked_up
                                value=yes
                            [/set_variable]
                            [set_variable]
                                name=item_{ID}_in_use
                                value=no
                            [/set_variable]
                        [/command]
                    [/option]

                    [option]
                        message={LEAVE_IT_STRING}

                        [command]
                            [allow_undo]
                            [/allow_undo]
                        [/command]
                    [/option]
                                [/message]
                            [/then]
                        [/if]
                    [/then]
                    [else]
                        #if player doesn't have a unit at the moment
                        [message]
                            speaker=narrator
                            message= _ "At the moment you do not have a unit in your army who could use this artifact. However the item will be picked up, so it can wait for a suitable unit to be recruited or recalled."
                            image={IMAGE}
                            for_side=$side_number
                        [/message]
                        #{OBJECT_WML}

                        [remove_item]
                            x,y={X},{Y}
                            image={IMAGE}
                        [/remove_item]

                        [set_variable]
                            name=item_{ID}_picked_up
                            value=yes
                        [/set_variable]
                        [set_variable]
                            name=item_{ID}_in_use
                            value=no
                        [/set_variable]
                    [/else]
                [/if]

                [allow_undo]
                [/allow_undo]
            [/else]
        [/if]
    [/event]
#enddef

#define ITEM_APPLIER
    [event]
        name=recruit,recall
        first_time_only=no

        [filter]
            side=1
        [/filter]

        [if]
            [variable]
                name=item_GCarpet_in_use
                equals=no
            [/variable]
            [and]
                [variable]
                    name=item_GCarpet_picked_up
                    equals=yes
                [/variable]
            [/and]
            [then]
                [if]
                    [have_unit]
                        type=EoMa_Carpet_Rider,EoMa_Carpet_Master
                        x,y=$x1,$y1
                    [/have_unit]
                    [then]
                        [message]
                            speaker=narrator
                            message={DESCR_CARPET}
                            image=items/carpet.png

                            [option]
                                message= _ "carpet^Take it"

                                [command]
                                    [object]
                                        name= _ "Golden Carpet"
                                        image=items/carpet.png
                                        duration=forever
                                        description= _ "Woven of golden threads, inspired by Abyssal winds. Everyone who possesses this ancient vehicle gains amazing speed and agility.
Speed increases by 50%"
                                        [effect]
                                            apply_to=movement
                                            increase=50%
                                        [/effect]
                                    [/object]
		[store_unit]
			[filter]
				id=$unit.id
			[/filter]
			variable=unit
		[/store_unit]
		[set_variables]
            name=unit.modifications.trait
            mode=append

            [value]
                id=gcarpet
                name= _ "golden carpet"
                description= _ "This unit flies on the ancient Golden Carpet.

Effects:
Speed increases by 50%"
            [/value]
        [/set_variables]
		[unstore_unit]
			variable=unit
			find_vacant=no
		[/unstore_unit]
                                    [set_variable]
                                        name=item_GCarpet_picked_up
                                        value=yes
                                    [/set_variable]
                                    [set_variable]
                                        name=item_GCarpet_in_use
                                        value=yes
                                    [/set_variable]
                                [/command]
                            [/option]

                            [option]
                                message= _ "carpet^Leave it for another unit"

                                [command]
                                    [allow_undo]
                                    [/allow_undo]
                                [/command]
                            [/option]
                        [/message]
                    [/then]
                [/if]
            [/then]
        [/if]

        [if]
            [variable]
                name=item_DCloak_in_use
                equals=no
            [/variable]
            [and]
                [variable]
                    name=item_DCloak_picked_up
                    equals=yes
                [/variable]
            [/and]
            [then]
                [if]
                    [have_unit]
                        type=EoMa_Camel_Rider,EoMa_Heavy_Camel_Rider,EoMa_Camel_Master
                        x,y=$x1,$y1
                    [/have_unit]
                    [then]
                        [message]
                            speaker=narrator
                            message={DESCR_CLOAK}
                            image=items/cloak.png

                            [option]
                                message= _ "cloak^Take it"

                                [command]
                                    [object]
                                        name= _ "Desert Cloak"
                                        image=items/cloak.png
                                        duration=forever
                                        description= _ "Marked with mysterious symbols, this cloak was enchanted a long time ago, but it still grants its owner good protection against fire.
Advances the unit
Grants 50% fire resistance"
                                        [effect]
                                            apply_to=resistance
                                            replace=true
                                            [resistance]
                                                fire=50
                                            [/resistance]
                                        [/effect]
                                        [then]
                                            {ADVANCE_UNIT x,y=$x1,$y1 "EoMa_Heavy_Camel_Rider"}
                                        [/then]
                                    [/object]
		[store_unit]
			[filter]
				id=$unit.id
			[/filter]
			variable=unit
		[/store_unit]
		[set_variables]
            name=unit.modifications.trait
            mode=append

            [value]
                id=dcloak
                name= _ "desert cloak"
                description= _ "This unit wears the famous Desert Cloak of ancients.

Effects:
Grants 50% fire resistance"
            [/value]
        [/set_variables]
		[unstore_unit]
			variable=unit
			find_vacant=no
		[/unstore_unit]
                                    [set_variable]
                                        name=item_DCloak_picked_up
                                        value=yes
                                    [/set_variable]
                                    [set_variable]
                                        name=item_DCloak_in_use
                                        value=yes
                                    [/set_variable]
                                [/command]
                            [/option]

                            [option]
                                message= _ "cloak^Leave it for another unit"

                                [command]
                                    [allow_undo]
                                    [/allow_undo]
                                [/command]
                            [/option]
                        [/message]
                    [/then]
                [/if]
            [/then]
        [/if]

        [if]
            [variable]
                name=item_Spear_in_use
                equals=no
            [/variable]
            [and]
                [variable]
                    name=item_Spear_picked_up
                    equals=yes
                [/variable]
            [/and]
            [then]
                [if]
                    [have_unit]
                        type=EoMa_Rhami,EoMa_RhamiKai
                        x,y=$x1,$y1
                    [/have_unit]
                    [then]
                        [message]
                            speaker=narrator
                            message={DESCR_SPEAR}
                            image=items/spear.png

                            [option]
                                message= _ "spear^Take it"

                                [command]
                                    [object]
                                        name= _ "Spear of Rhami"
                                        image=items/spear.png
                                        duration=forever
                                        description= _ "This weapon, forged from the light of the Abyss, is a part of the equipment used by magical entities called Rhami’kai. The Ancestors stole one of those spears and enhanced it magically.
Advances the unit
Increases the attack by 25%
Increases magical resistances by 10%"
                                        [effect]
                                            apply_to=attack
                                            name=trident
                                            increase_damage=25%
                                        [/effect]
                                        [effect]
                                            apply_to=attack
                                            name=trident2
                                            increase_damage=25%
                                        [/effect]
                                        [effect]
                                            apply_to=resistance
                                            [resistance]
                                                arcane=-10
                                                fire=-10
                                                cold=-10
                                            [/resistance]
                                        [/effect]
                                    [/object]
                                    [if]
                                        [have_unit]
                                            x,y=$x1,$y1
                                            type=EoMa_Rhami
                                        [/have_unit]
                                        [then]
                                            {ADVANCE_UNIT x,y=$x1,$y1 "EoMa_RhamiKai"}
                                        [/then]
                                    [/if]
		[store_unit]
			[filter]
				id=$unit.id
			[/filter]
			variable=unit
		[/store_unit]
		[set_variables]
            name=unit.modifications.trait
            mode=append

            [value]
                id=spearrhami
                name= _ "spear of rhami"
                description= _ "This unit is holding a powerful spear of abysmal origin.

Effects:
Increases the attack by 25%
Increases magic resistance by 10%"
            [/value]
        [/set_variables]
		[unstore_unit]
			variable=unit
			find_vacant=no
		[/unstore_unit]				    
                                    [set_variable]
                                        name=item_Spear_picked_up
                                        value=yes
                                    [/set_variable]
                                    [set_variable]
                                        name=item_Spear_in_use
                                        value=yes
                                    [/set_variable]
                                [/command]
                            [/option]

                            [option]
                                message= _ "spear^Leave it for another unit"

                                [command]
                                    [allow_undo]
                                    [/allow_undo]
                                [/command]
                            [/option]
                        [/message]
                    [/then]
                [/if]
            [/then]
        [/if]

        [if]
            [variable]
                name=item_Collar_in_use
                equals=no
            [/variable]
            [and]
                [variable]
                    name=item_Collar_picked_up
                    equals=yes
                [/variable]
            [/and]
            [then]
                [if]
                    [have_unit]
                        race=eoma_magical
                        x,y=$x1,$y1
                    [/have_unit]
                    [then]
                        [message]
                            speaker=narrator
                            message={DESCR_COLLAR}
                            image=items/collar.png

                            [option]
                                message= _ "collar^Take it"

                                [command]
                                    [object]
                                        name= _ "Collar of Recall"
                                        image=items/collar.png
                                        duration=forever
                                        description= _ "A legendary artifact, a masterpiece made by the Ancestors. In olden times a magical collar was made, which when placed upon a magical being, could recall it after death.
The unit is recalled back to the leader
After each recall the unit is fully healed
The unit can be recalled only 3 times. After that it dies for sure."
                                    [/object]
                                    [set_variables]
                                        name=unit.modifications.trait
                                        mode=append

                                        [value]
                                            id=collar
                                            name= _ "collar"
                                            description= _ "After death the unit is recalled back to leader. Activates only 3 times."
                                        [/value]
                                    [/set_variables]
                                    {VARIABLE unit.status.collar yes}
                                    {VARIABLE unit.status.firstrecall yes}
                                    {VARIABLE unit.status.secondrecall yes}
                                    {VARIABLE unit.status.thirdrecall yes}

                                    [unstore_unit]
                                        variable=unit
                                        find_vacant=no
                                    [/unstore_unit]

                                    [set_variable]
                                        name=item_Collar_picked_up
                                        value=yes
                                    [/set_variable]
                                    [set_variable]
                                        name=item_Collar_in_use
                                        value=yes
                                    [/set_variable]
                                [/command]
                            [/option]

                            [option]
                                message= _ "collar^Leave it for another unit"

                                [command]
                                    [allow_undo]
                                    [/allow_undo]
                                [/command]
                            [/option]
                        [/message]
                    [/then]
                [/if]
            [/then]
        [/if]

        [if]
            [variable]
                name=item_Amulet_Elem_in_use
                equals=no
            [/variable]
            [and]
                [variable]
                    name=item_Amulet_Elem_picked_up
                    equals=yes
                [/variable]
            [/and]
            [then]
                [if]
                    [have_unit]
                        type=EoMa_Water_Elemental,EoMa_Fire_Elemental,EoMa_Air_Elemental,EoMa_Earth_Elemental,EoMa_Water_Avatar,EoMa_Fire_Avatar,EoMa_Air_Avatar,EoMa_Earth_Avatar,EoMa_Water_God,EoMa_Fire_God,EoMa_Air_God,EoMa_Earth_God
                        x,y=$x1,$y1
                    [/have_unit]
                    [then]
                        [message]
                            speaker=narrator
                            message={DESCR_AMULET}
                            image=items/necklace.png

                            [option]
                                message= _ "amulet^Take it"

                                [command]
                                    [object]
                                        name= _ "Amulet of Metamorph"
                                        image=items/necklace.png
                                        duration=forever
                                        description= _ "The Ancestors were fascinated with elementals — entities made of pure energy. They also dreamed about creating a creature from a mix of all four known elements. Unfortunately they failed. Yet at the end an unique amulet was created, capable of transforming one element into another one. This is one of the most powerful relics made by the Ancestors.
The elemental unit can turn into other elemental
(use right-click on the unit to activate)"
                                        [effect]
                                            apply_to=new_ability
                                            [abilities]
                                                {ABILITY_AMULET_METAMORPH}
                                            [/abilities]
                                        [/effect]
                                        [then]
                                            [store_unit]
                                                [filter]
                                                    x,y=$x1,$y1
                                                [/filter]
                                                variable=modified
                                            [/store_unit]
                                            {VARIABLE modified.status.amulet_elem yes}
		[set_variables]
            name=unit.modifications.trait
            mode=append

            [value]
                id=metamorph
                name= _ "metamorph"
                description= _ "This elemental wears the Amulet of Metamorph.

Effects:
The elemental unit can turn into another elemental (use right-click on the unit to activate)"
            [/value]
        [/set_variables]
                                            [unstore_unit]
                                                variable=modified
                                                find_vacant=no
                                            [/unstore_unit]
                                            {CLEAR_VARIABLE modified}
                                            {METAMORPH_ALL}
                                        [/then]
                                    [/object]

                                    [set_variable]
                                        name=item_Amulet_Elem_picked_up
                                        value=yes
                                    [/set_variable]
                                    [set_variable]
                                        name=item_Amulet_Elem_in_use
                                        value=yes
                                    [/set_variable]
                                [/command]
                            [/option]

                            [option]
                                message= _ "amulet^Leave it for another unit"

                                [command]
                                    [allow_undo]
                                    [/allow_undo]
                                [/command]
                            [/option]
                        [/message]
                    [/then]
                [/if]
            [/then]
        [/if]
        [if]
            [variable]
                name=item_Cuirass_in_use
                equals=no
            [/variable]
            [and]
                [variable]
                    name=item_Cuirass_picked_up
                    equals=yes
                [/variable]
            [/and]
            [then]
                [if]
                    [have_unit]
                        race=eoma_summoner
                        x,y=$x1,$y1
                    [/have_unit]
                    [then]
                        [message]
                            speaker=narrator
                            message={DESCR_ARMOR}
                            image=items/armor.png

                            [option]
                                message= _ "armor^Take it"

                                [command]
        [object]
            name= _ "Cuirass of the Ancients"
            image=items/armor.png
            duration=forever
            description= _ "Richly decorated plates, solid workmanship and magical symbols: this must be the legendary armor of Ka-Gattans.

- Increases physical resistances by 25%
- Increases fire and cold resistances by 20%
- Decreases arcane resistance by 15%"
            [effect]
                apply_to=resistance
                [resistance]
                    blade=-25
                    pierce=-25
                    impact=-25
                    fire=-20
                    cold=-20
                    arcane=15
                [/resistance]
            [/effect]
        [/object]

                                    [set_variable]
                                        name=item_Cuirass_picked_up
                                        value=yes
                                    [/set_variable]
                                    [set_variable]
                                        name=item_Cuirass_in_use
                                        value=yes
                                    [/set_variable]
                                [/command]
                            [/option]

                            [option]
                                message= _ "armor^Leave it for another unit"

                                [command]
                                    [allow_undo]
                                    [/allow_undo]
                                [/command]
                            [/option]
                        [/message]
                    [/then]
                [/if]
            [/then]
        [/if]
        [if]
            [variable]
                name=item_Staff_in_use
                equals=no
            [/variable]
            [and]
                [variable]
                    name=item_Staff_picked_up
                    equals=yes
                [/variable]
            [/and]
            [then]
                [if]
                    [have_unit]
                        type=EoMa_Novice_Summoner,EoMa_Dispeller,EoMa_Banisher
                        x,y=$x1,$y1
                    [/have_unit]
                    [then]
                        [message]
                            speaker=narrator
                            message={DESCR_STAFF}
                            image=items/staff.png

                            [option]
                                message= _ "staff^Take it"

                                [command]
        [object]
            name= _ "Banishment Staff"
            image=items/staff.png
            duration=forever
            description= _ "- Advances the unit
- the banishment attack never misses
- the staff/frozen gate attacks deal +2 damage 
- increases magical resistances by 10%"
            [effect]
                apply_to=attack
                name=banishment
                [set_specials]
                    mode=append
                    {WEAPON_SPECIAL_EOMA_ALWAYSHITS}
                [/set_specials]
            [/effect]
            [effect]
                apply_to=attack
                name=staff
                set_icon=attacks/staff-magic.png
                increase_damage=2
            [/effect]
            [effect]
                apply_to=attack
                name=frozen gate
                increase_damage=2
            [/effect]
        [/object]
        [if]
            [have_unit]
                x,y=$x1,$y1
                type=EoMa_Novice_Summoner
            [/have_unit]
            [then]
                {ADVANCE_UNIT x,y=$x1,$y1 "EoMa_Dispeller"}
            [/then]
            [else]
                [if]
                    [have_unit]
                        x,y=$x1,$y1
                        type=EoMa_Dispeller
                    [/have_unit]
                    [then]
                        {ADVANCE_UNIT x,y=$x1,$y1 "EoMa_Banisher"}
                    [/then]
                [/if]
            [/else]
        [/if]
		[store_unit]
			[filter]
				id=$unit.id
			[/filter]
			variable=unit
		[/store_unit]
		[set_variables]
            name=unit.modifications.trait
            mode=append

            [value]
                id=staffbanisher
                name= _ "banishment staff"
                description= _ "This unit is holding a powerful staff which once belonging to the first Master of Banishers.

Effects:
- the banishment attack never misses
- the staff/frozen gate attacks deal +2 damage 
- increases magical resistances by 10%"
            [/value]
        [/set_variables]
		[unstore_unit]
			variable=unit
			find_vacant=no
		[/unstore_unit]

                                    [set_variable]
                                        name=item_Staff_picked_up
                                        value=yes
                                    [/set_variable]
                                    [set_variable]
                                        name=item_Staff_in_use
                                        value=yes
                                    [/set_variable]
                                [/command]
                            [/option]

                            [option]
                                message= _ "staff^Leave it for another unit"

                                [command]
                                    [allow_undo]
                                    [/allow_undo]
                                [/command]
                            [/option]
                        [/message]
                    [/then]
                [/if]
            [/then]
        [/if]
        [if]
            [variable]
                name=item_regenring_in_use
                equals=no
            [/variable]
            [and]
                [variable]
                    name=item_regenring_picked_up
                    equals=yes
                [/variable]
            [/and]
            [then]
                [if]
                    [have_unit]
                        race=eoma_summoner
                        x,y=$x1,$y1
                    [/have_unit]
                    [then]
                        [message]
                            speaker=narrator
                            message={DESCR_RING}
                            image=items/ring-red.png

                            [option]
                                message= _ "ring^Take it"

                                [command]
		[object]
            name= _ "Ring of Regeneration"
            image=items/ring-red.png
            duration=forever
            description= _ "This mysterius ring is richly decorated with magical symbols making it somehow connected to the Abyss. The bearer of this relic may benefit from strange energies flowing into his body, healing him effectively.
- Grants regeneration"
            [effect]
                apply_to=new_ability
                [abilities]
                    {ABILITY_EOMA_REGENERATES}
                [/abilities]
            [/effect]
        [/object]
		[store_unit]
			[filter]
				id=$unit.id
			[/filter]
			variable=unit
		[/store_unit]
		[set_variables]
            name=unit.modifications.trait
            mode=append

            [value]
                id=regenring
                name= _ "ring of regeneration"
                description= _ "This unit wears the Ring of Regeneration.

Effects:
Grants regeneration"
            [/value]
        [/set_variables]
		[unstore_unit]
			variable=unit
			find_vacant=no
		[/unstore_unit]
                                     [set_variable]
                                        name=item_regenring_picked_up
                                        value=yes
                                    [/set_variable]
                                    [set_variable]
                                        name=item_regenring_in_use
                                        value=yes
                                    [/set_variable]
                                [/command]
                            [/option]

                            [option]
                                message= _ "ring^Leave it for another unit"

                                [command]
                                    [allow_undo]
                                    [/allow_undo]
                                [/command]
                            [/option]
                        [/message]
                    [/then]
                [/if]
            [/then]
        [/if]
        [if]
            [variable]
                name=item_Cap_in_use
                equals=no
            [/variable]
            [and]
                [variable]
                    name=item_Cap_picked_up
                    equals=yes
                [/variable]
            [/and]
            [then]
                [if]
                    [have_unit]
                        type=EoMa_Novice_Summoner,EoMa_Summoner,TLU_Grand_Summoner,EoMa_Summons_Master,TLU_Mehir_Commander,EoMa_Heavy_Summoner,EoMa_Neutral_Summoner
                        x,y=$x1,$y1
                    [/have_unit]
                    [then]
                        [message]
                            speaker=narrator
                            message={DESCR_CAP}
                            image=items/cap.png

                            [option]
                                message= _ "cap^Take it"

                                [command]
        [object]
            name= _ "Cap of Power"
            image=items/cap.png
            duration=forever
            description= _ "Increases magical power by 20%
Decreases experience points needed for advancement by 25%"
            [effect]
                apply_to=attack
                name=scroll
                increase_damage=20%
            [/effect]
            [effect]
                apply_to=attack
                name=magic arrow
                increase_damage=20%
            [/effect]
            [effect]
                apply_to=attack
                name=circle of destruction
                increase_damage=20%
            [/effect]
            [effect]
                apply_to=attack
                name=ema
                increase_damage=20%
            [/effect]
            [effect]
                apply_to=attack
                name=circlebalance
                increase_damage=20%
            [/effect]
            [effect]
                apply_to=attack
                name=incantation of power
                increase_damage=20%
            [/effect]
            [effect]
                apply_to=max_experience
                increase=-25%
            [/effect]
        [/object]
		[store_unit]
			[filter]
				id=$unit.id
			[/filter]
			variable=unit
		[/store_unit]
        [set_variables]
            name=unit.modifications.trait
            mode=append

            [value]
                id=capofpower
                name= _ "cap of power"
                description= _ "This unit wears a magical cap, which enhances its magical power.

Effects:
Increases magical power by 20%
Decreases experience points needed for advancement by 25%"
            [/value]
        [/set_variables]
		[unstore_unit]
			variable=unit
			find_vacant=no
		[/unstore_unit]
                                    [set_variable]
                                        name=item_Cap_picked_up
                                        value=yes
                                    [/set_variable]
                                    [set_variable]
                                        name=item_Cap_in_use
                                        value=yes
                                    [/set_variable]
                                [/command]
                            [/option]

                            [option]
                                message= _ "cap^Leave it for another unit"

                                [command]
                                    [allow_undo]
                                    [/allow_undo]
                                [/command]
                            [/option]
                        [/message]
                    [/then]
                [/if]
            [/then]
        [/if]
        [if]
            [variable]
                name=item_Sphere_in_use
                equals=no
            [/variable]
            [and]
                [variable]
                    name=item_Sphere_picked_up
                    equals=yes
                [/variable]
            [/and]
            [then]
                [if]
                    [have_unit]
                        x,y=$x1,$y1
                    [/have_unit]
                    [then]
                        [message]
                            speaker=narrator
                            message={DESCR_SPHERE}
                            image=items/ball-magenta.png

                            [option]
                                message= _ "sphere^Take it"

                                [command]
        [object]
            name= _ "Reficul's sphere"
            image=items/ball-magenta.png
            duration=forever
            description= _ "Increases magical and physical resistances by 15%"
            [effect]
                apply_to=halo
                halo=halo/elven/elven-shield-halo-[60,80,100,80,60]pct.png~GS()~BLEND(255,64,0,0.75)~SCALE(220,220):[200*2,450,200*2]
            [/effect]
            [effect]
                apply_to=resistance
                replace=false
                [resistance]
                    arcane=-15
                    blade=-15
                    fire=-15
                    cold=-15
                    pierce=-15
                    impact=-15
                [/resistance]
            [/effect]
        [/object]
		[store_unit]
			[filter]
				id=$unit.id
			[/filter]
			variable=unit
		[/store_unit]
        [set_variables]
            name=unit.modifications.trait
            mode=append
            [value]
                id=sphereofreficul
                name= _ "reficul's sphere"
                description= _ "This unit wears a sphere once belonging to Reficul.

Effects:
Resitances to physical and magical attacks are increased by 15%"
            [/value]
        [/set_variables]
		[unstore_unit]
			variable=unit
			find_vacant=no
		[/unstore_unit]
                                    [set_variable]
                                        name=item_Sphere_picked_up
                                        value=yes
                                    [/set_variable]
                                    [set_variable]
                                        name=item_Sphere_in_use
                                        value=yes
                                    [/set_variable]
                                [/command]
                            [/option]

                            [option]
                                message= _ "sphere^Leave it for another unit"

                                [command]
                                    [allow_undo]
                                    [/allow_undo]
                                [/command]
                            [/option]
                        [/message]
                    [/then]
                [/if]
            [/then]
        [/if]
    [/event]
#enddef
 